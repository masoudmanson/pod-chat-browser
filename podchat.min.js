(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],2:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],3:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],4:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":2,"./encode":3}],5:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":1,timers:5}],6:[function(require,module,exports){window.PodChat=require("./src/chat.js")},{"./src/chat.js":46}],7:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./enc-base64"),require("./md5"),require("./evpkdf"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var BlockCipher=C_lib.BlockCipher;var C_algo=C.algo;var SBOX=[];var INV_SBOX=[];var SUB_MIX_0=[];var SUB_MIX_1=[];var SUB_MIX_2=[];var SUB_MIX_3=[];var INV_SUB_MIX_0=[];var INV_SUB_MIX_1=[];var INV_SUB_MIX_2=[];var INV_SUB_MIX_3=[];(function(){var d=[];for(var i=0;i<256;i++){if(i<128){d[i]=i<<1}else{d[i]=i<<1^283}}var x=0;var xi=0;for(var i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^sx&255^99;SBOX[x]=sx;INV_SBOX[sx]=x;var x2=d[x];var x4=d[x2];var x8=d[x4];var t=d[sx]*257^sx*16843008;SUB_MIX_0[x]=t<<24|t>>>8;SUB_MIX_1[x]=t<<16|t>>>16;SUB_MIX_2[x]=t<<8|t>>>24;SUB_MIX_3[x]=t;var t=x8*16843009^x4*65537^x2*257^x*16843008;INV_SUB_MIX_0[sx]=t<<24|t>>>8;INV_SUB_MIX_1[sx]=t<<16|t>>>16;INV_SUB_MIX_2[sx]=t<<8|t>>>24;INV_SUB_MIX_3[sx]=t;if(!x){x=xi=1}else{x=x2^d[d[d[x8^x2]]];xi^=d[d[xi]]}}})();var RCON=[0,1,2,4,8,16,32,64,128,27,54];var AES=C_algo.AES=BlockCipher.extend({_doReset:function(){if(this._nRounds&&this._keyPriorReset===this._key){return}var key=this._keyPriorReset=this._key;var keyWords=key.words;var keySize=key.sigBytes/4;var nRounds=this._nRounds=keySize+6;var ksRows=(nRounds+1)*4;var keySchedule=this._keySchedule=[];for(var ksRow=0;ksRow<ksRows;ksRow++){if(ksRow<keySize){keySchedule[ksRow]=keyWords[ksRow]}else{var t=keySchedule[ksRow-1];if(!(ksRow%keySize)){t=t<<8|t>>>24;t=SBOX[t>>>24]<<24|SBOX[t>>>16&255]<<16|SBOX[t>>>8&255]<<8|SBOX[t&255];t^=RCON[ksRow/keySize|0]<<24}else if(keySize>6&&ksRow%keySize==4){t=SBOX[t>>>24]<<24|SBOX[t>>>16&255]<<16|SBOX[t>>>8&255]<<8|SBOX[t&255]}keySchedule[ksRow]=keySchedule[ksRow-keySize]^t}}var invKeySchedule=this._invKeySchedule=[];for(var invKsRow=0;invKsRow<ksRows;invKsRow++){var ksRow=ksRows-invKsRow;if(invKsRow%4){var t=keySchedule[ksRow]}else{var t=keySchedule[ksRow-4]}if(invKsRow<4||ksRow<=4){invKeySchedule[invKsRow]=t}else{invKeySchedule[invKsRow]=INV_SUB_MIX_0[SBOX[t>>>24]]^INV_SUB_MIX_1[SBOX[t>>>16&255]]^INV_SUB_MIX_2[SBOX[t>>>8&255]]^INV_SUB_MIX_3[SBOX[t&255]]}}},encryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._keySchedule,SUB_MIX_0,SUB_MIX_1,SUB_MIX_2,SUB_MIX_3,SBOX)},decryptBlock:function(M,offset){var t=M[offset+1];M[offset+1]=M[offset+3];M[offset+3]=t;this._doCryptBlock(M,offset,this._invKeySchedule,INV_SUB_MIX_0,INV_SUB_MIX_1,INV_SUB_MIX_2,INV_SUB_MIX_3,INV_SBOX);var t=M[offset+1];M[offset+1]=M[offset+3];M[offset+3]=t},_doCryptBlock:function(M,offset,keySchedule,SUB_MIX_0,SUB_MIX_1,SUB_MIX_2,SUB_MIX_3,SBOX){var nRounds=this._nRounds;var s0=M[offset]^keySchedule[0];var s1=M[offset+1]^keySchedule[1];var s2=M[offset+2]^keySchedule[2];var s3=M[offset+3]^keySchedule[3];var ksRow=4;for(var round=1;round<nRounds;round++){var t0=SUB_MIX_0[s0>>>24]^SUB_MIX_1[s1>>>16&255]^SUB_MIX_2[s2>>>8&255]^SUB_MIX_3[s3&255]^keySchedule[ksRow++];var t1=SUB_MIX_0[s1>>>24]^SUB_MIX_1[s2>>>16&255]^SUB_MIX_2[s3>>>8&255]^SUB_MIX_3[s0&255]^keySchedule[ksRow++];var t2=SUB_MIX_0[s2>>>24]^SUB_MIX_1[s3>>>16&255]^SUB_MIX_2[s0>>>8&255]^SUB_MIX_3[s1&255]^keySchedule[ksRow++];var t3=SUB_MIX_0[s3>>>24]^SUB_MIX_1[s0>>>16&255]^SUB_MIX_2[s1>>>8&255]^SUB_MIX_3[s2&255]^keySchedule[ksRow++];s0=t0;s1=t1;s2=t2;s3=t3}var t0=(SBOX[s0>>>24]<<24|SBOX[s1>>>16&255]<<16|SBOX[s2>>>8&255]<<8|SBOX[s3&255])^keySchedule[ksRow++];var t1=(SBOX[s1>>>24]<<24|SBOX[s2>>>16&255]<<16|SBOX[s3>>>8&255]<<8|SBOX[s0&255])^keySchedule[ksRow++];var t2=(SBOX[s2>>>24]<<24|SBOX[s3>>>16&255]<<16|SBOX[s0>>>8&255]<<8|SBOX[s1&255])^keySchedule[ksRow++];var t3=(SBOX[s3>>>24]<<24|SBOX[s0>>>16&255]<<16|SBOX[s1>>>8&255]<<8|SBOX[s2&255])^keySchedule[ksRow++];M[offset]=t0;M[offset+1]=t1;M[offset+2]=t2;M[offset+3]=t3},keySize:256/32});C.AES=BlockCipher._createHelper(AES)})();return CryptoJS.AES})},{"./cipher-core":8,"./core":9,"./enc-base64":10,"./evpkdf":12,"./md5":17}],8:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./evpkdf"))}else if(typeof define==="function"&&define.amd){define(["./core","./evpkdf"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.lib.Cipher||function(undefined){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var WordArray=C_lib.WordArray;var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm;var C_enc=C.enc;var Utf8=C_enc.Utf8;var Base64=C_enc.Base64;var C_algo=C.algo;var EvpKDF=C_algo.EvpKDF;var Cipher=C_lib.Cipher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),createEncryptor:function(key,cfg){return this.create(this._ENC_XFORM_MODE,key,cfg)},createDecryptor:function(key,cfg){return this.create(this._DEC_XFORM_MODE,key,cfg)},init:function(xformMode,key,cfg){this.cfg=this.cfg.extend(cfg);this._xformMode=xformMode;this._key=key;this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset()},process:function(dataUpdate){this._append(dataUpdate);return this._process()},finalize:function(dataUpdate){if(dataUpdate){this._append(dataUpdate)}var finalProcessedData=this._doFinalize();return finalProcessedData},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(key){if(typeof key=="string"){return PasswordBasedCipher}else{return SerializableCipher}}return function(cipher){return{encrypt:function(message,key,cfg){return selectCipherStrategy(key).encrypt(cipher,message,key,cfg)},decrypt:function(ciphertext,key,cfg){return selectCipherStrategy(key).decrypt(cipher,ciphertext,key,cfg)}}}}()});var StreamCipher=C_lib.StreamCipher=Cipher.extend({_doFinalize:function(){var finalProcessedBlocks=this._process(!!"flush");return finalProcessedBlocks},blockSize:1});var C_mode=C.mode={};var BlockCipherMode=C_lib.BlockCipherMode=Base.extend({createEncryptor:function(cipher,iv){return this.Encryptor.create(cipher,iv)},createDecryptor:function(cipher,iv){return this.Decryptor.create(cipher,iv)},init:function(cipher,iv){this._cipher=cipher;this._iv=iv}});var CBC=C_mode.CBC=function(){var CBC=BlockCipherMode.extend();CBC.Encryptor=CBC.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;xorBlock.call(this,words,offset,blockSize);cipher.encryptBlock(words,offset);this._prevBlock=words.slice(offset,offset+blockSize)}});CBC.Decryptor=CBC.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;var thisBlock=words.slice(offset,offset+blockSize);cipher.decryptBlock(words,offset);xorBlock.call(this,words,offset,blockSize);this._prevBlock=thisBlock}});function xorBlock(words,offset,blockSize){var iv=this._iv;if(iv){var block=iv;this._iv=undefined}else{var block=this._prevBlock}for(var i=0;i<blockSize;i++){words[offset+i]^=block[i]}}return CBC}();var C_pad=C.pad={};var Pkcs7=C_pad.Pkcs7={pad:function(data,blockSize){var blockSizeBytes=blockSize*4;var nPaddingBytes=blockSizeBytes-data.sigBytes%blockSizeBytes;var paddingWord=nPaddingBytes<<24|nPaddingBytes<<16|nPaddingBytes<<8|nPaddingBytes;var paddingWords=[];for(var i=0;i<nPaddingBytes;i+=4){paddingWords.push(paddingWord)}var padding=WordArray.create(paddingWords,nPaddingBytes);data.concat(padding)},unpad:function(data){var nPaddingBytes=data.words[data.sigBytes-1>>>2]&255;data.sigBytes-=nPaddingBytes}};var BlockCipher=C_lib.BlockCipher=Cipher.extend({cfg:Cipher.cfg.extend({mode:CBC,padding:Pkcs7}),reset:function(){Cipher.reset.call(this);var cfg=this.cfg;var iv=cfg.iv;var mode=cfg.mode;if(this._xformMode==this._ENC_XFORM_MODE){var modeCreator=mode.createEncryptor}else{var modeCreator=mode.createDecryptor;this._minBufferSize=1}if(this._mode&&this._mode.__creator==modeCreator){this._mode.init(this,iv&&iv.words)}else{this._mode=modeCreator.call(mode,this,iv&&iv.words);this._mode.__creator=modeCreator}},_doProcessBlock:function(words,offset){this._mode.processBlock(words,offset)},_doFinalize:function(){var padding=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){padding.pad(this._data,this.blockSize);var finalProcessedBlocks=this._process(!!"flush")}else{var finalProcessedBlocks=this._process(!!"flush");padding.unpad(finalProcessedBlocks)}return finalProcessedBlocks},blockSize:128/32});var CipherParams=C_lib.CipherParams=Base.extend({init:function(cipherParams){this.mixIn(cipherParams)},toString:function(formatter){return(formatter||this.formatter).stringify(this)}});var C_format=C.format={};var OpenSSLFormatter=C_format.OpenSSL={stringify:function(cipherParams){var ciphertext=cipherParams.ciphertext;var salt=cipherParams.salt;if(salt){var wordArray=WordArray.create([1398893684,1701076831]).concat(salt).concat(ciphertext)}else{var wordArray=ciphertext}return wordArray.toString(Base64)},parse:function(openSSLStr){var ciphertext=Base64.parse(openSSLStr);var ciphertextWords=ciphertext.words;if(ciphertextWords[0]==1398893684&&ciphertextWords[1]==1701076831){var salt=WordArray.create(ciphertextWords.slice(2,4));ciphertextWords.splice(0,4);ciphertext.sigBytes-=16}return CipherParams.create({ciphertext:ciphertext,salt:salt})}};var SerializableCipher=C_lib.SerializableCipher=Base.extend({cfg:Base.extend({format:OpenSSLFormatter}),encrypt:function(cipher,message,key,cfg){cfg=this.cfg.extend(cfg);var encryptor=cipher.createEncryptor(key,cfg);var ciphertext=encryptor.finalize(message);var cipherCfg=encryptor.cfg;return CipherParams.create({ciphertext:ciphertext,key:key,iv:cipherCfg.iv,algorithm:cipher,mode:cipherCfg.mode,padding:cipherCfg.padding,blockSize:cipher.blockSize,formatter:cfg.format})},decrypt:function(cipher,ciphertext,key,cfg){cfg=this.cfg.extend(cfg);ciphertext=this._parse(ciphertext,cfg.format);var plaintext=cipher.createDecryptor(key,cfg).finalize(ciphertext.ciphertext);return plaintext},_parse:function(ciphertext,format){if(typeof ciphertext=="string"){return format.parse(ciphertext,this)}else{return ciphertext}}});var C_kdf=C.kdf={};var OpenSSLKdf=C_kdf.OpenSSL={execute:function(password,keySize,ivSize,salt){if(!salt){salt=WordArray.random(64/8)}var key=EvpKDF.create({keySize:keySize+ivSize}).compute(password,salt);var iv=WordArray.create(key.words.slice(keySize),ivSize*4);key.sigBytes=keySize*4;return CipherParams.create({key:key,iv:iv,salt:salt})}};var PasswordBasedCipher=C_lib.PasswordBasedCipher=SerializableCipher.extend({cfg:SerializableCipher.cfg.extend({kdf:OpenSSLKdf}),encrypt:function(cipher,message,password,cfg){cfg=this.cfg.extend(cfg);var derivedParams=cfg.kdf.execute(password,cipher.keySize,cipher.ivSize);cfg.iv=derivedParams.iv;var ciphertext=SerializableCipher.encrypt.call(this,cipher,message,derivedParams.key,cfg);ciphertext.mixIn(derivedParams);return ciphertext},decrypt:function(cipher,ciphertext,password,cfg){cfg=this.cfg.extend(cfg);ciphertext=this._parse(ciphertext,cfg.format);var derivedParams=cfg.kdf.execute(password,cipher.keySize,cipher.ivSize,ciphertext.salt);cfg.iv=derivedParams.iv;var plaintext=SerializableCipher.decrypt.call(this,cipher,ciphertext,derivedParams.key,cfg);return plaintext}})}()})},{"./core":9,"./evpkdf":12}],9:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{root.CryptoJS=factory()}})(this,function(){var CryptoJS=CryptoJS||function(Math,undefined){var create=Object.create||function(){function F(){}return function(obj){var subtype;F.prototype=obj;subtype=new F;F.prototype=null;return subtype}}();var C={};var C_lib=C.lib={};var Base=C_lib.Base=function(){return{extend:function(overrides){var subtype=create(this);if(overrides){subtype.mixIn(overrides)}if(!subtype.hasOwnProperty("init")||this.init===subtype.init){subtype.init=function(){subtype.$super.init.apply(this,arguments)}}subtype.init.prototype=subtype;subtype.$super=this;return subtype},create:function(){var instance=this.extend();instance.init.apply(instance,arguments);return instance},init:function(){},mixIn:function(properties){for(var propertyName in properties){if(properties.hasOwnProperty(propertyName)){this[propertyName]=properties[propertyName]}}if(properties.hasOwnProperty("toString")){this.toString=properties.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[];if(sigBytes!=undefined){this.sigBytes=sigBytes}else{this.sigBytes=words.length*4}},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words;var thatWords=wordArray.words;var thisSigBytes=this.sigBytes;var thatSigBytes=wordArray.sigBytes;this.clamp();if(thisSigBytes%4){for(var i=0;i<thatSigBytes;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}}else{for(var i=0;i<thatSigBytes;i+=4){thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2]}}this.sigBytes+=thatSigBytes;return this},clamp:function(){var words=this.words;var sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8;words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);clone.words=this.words.slice(0);return clone},random:function(nBytes){var words=[];var r=function(m_w){var m_w=m_w;var m_z=987654321;var mask=4294967295;return function(){m_z=36969*(m_z&65535)+(m_z>>16)&mask;m_w=18e3*(m_w&65535)+(m_w>>16)&mask;var result=(m_z<<16)+m_w&mask;result/=4294967296;result+=.5;return result*(Math.random()>.5?1:-1)}};for(var i=0,rcache;i<nBytes;i+=4){var _r=r((rcache||Math.random())*4294967296);rcache=_r()*987654071;words.push(_r()*4294967296|0)}return new WordArray.init(words,nBytes)}});var C_enc=C.enc={};var Hex=C_enc.Hex={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var hexChars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16));hexChars.push((bite&15).toString(16))}return hexChars.join("")},parse:function(hexStr){var hexStrLength=hexStr.length;var words=[];for(var i=0;i<hexStrLength;i+=2){words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4}return new WordArray.init(words,hexStrLength/2)}};var Latin1=C_enc.Latin1={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var latin1Chars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){var latin1StrLength=latin1Str.length;var words=[];for(var i=0;i<latin1StrLength;i++){words[i>>>2]|=(latin1Str.charCodeAt(i)&255)<<24-i%4*8}return new WordArray.init(words,latin1StrLength)}};var Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}};var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init;this._nDataBytes=0},_append:function(data){if(typeof data=="string"){data=Utf8.parse(data)}this._data.concat(data);this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data;var dataWords=data.words;var dataSigBytes=data.sigBytes;var blockSize=this.blockSize;var blockSizeBytes=blockSize*4;var nBlocksReady=dataSigBytes/blockSizeBytes;if(doFlush){nBlocksReady=Math.ceil(nBlocksReady)}else{nBlocksReady=Math.max((nBlocksReady|0)-this._minBufferSize,0)}var nWordsReady=nBlocksReady*blockSize;var nBytesReady=Math.min(nWordsReady*4,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize){this._doProcessBlock(dataWords,offset)}var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);clone._data=this._data.clone();return clone},_minBufferSize:0});var Hasher=C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg);this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset()},update:function(messageUpdate){this._append(messageUpdate);this._process();return this},finalize:function(messageUpdate){if(messageUpdate){this._append(messageUpdate)}var hash=this._doFinalize();return hash},blockSize:512/32,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}});var C_algo=C.algo={};return C}(Math);return CryptoJS})},{}],10:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var C_enc=C.enc;var Base64=C_enc.Base64={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var map=this._map;wordArray.clamp();var base64Chars=[];for(var i=0;i<sigBytes;i+=3){var byte1=words[i>>>2]>>>24-i%4*8&255;var byte2=words[i+1>>>2]>>>24-(i+1)%4*8&255;var byte3=words[i+2>>>2]>>>24-(i+2)%4*8&255;var triplet=byte1<<16|byte2<<8|byte3;for(var j=0;j<4&&i+j*.75<sigBytes;j++){base64Chars.push(map.charAt(triplet>>>6*(3-j)&63))}}var paddingChar=map.charAt(64);if(paddingChar){while(base64Chars.length%4){base64Chars.push(paddingChar)}}return base64Chars.join("")},parse:function(base64Str){var base64StrLength=base64Str.length;var map=this._map;var reverseMap=this._reverseMap;if(!reverseMap){reverseMap=this._reverseMap=[];for(var j=0;j<map.length;j++){reverseMap[map.charCodeAt(j)]=j}}var paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);if(paddingIndex!==-1){base64StrLength=paddingIndex}}return parseLoop(base64Str,base64StrLength,reverseMap)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function parseLoop(base64Str,base64StrLength,reverseMap){var words=[];var nBytes=0;for(var i=0;i<base64StrLength;i++){if(i%4){var bits1=reverseMap[base64Str.charCodeAt(i-1)]<<i%4*2;var bits2=reverseMap[base64Str.charCodeAt(i)]>>>6-i%4*2;words[nBytes>>>2]|=(bits1|bits2)<<24-nBytes%4*8;nBytes++}}return WordArray.create(words,nBytes)}})();return CryptoJS.enc.Base64})},{"./core":9}],11:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var C_enc=C.enc;var Utf16BE=C_enc.Utf16=C_enc.Utf16BE={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var utf16Chars=[];for(var i=0;i<sigBytes;i+=2){var codePoint=words[i>>>2]>>>16-i%4*8&65535;utf16Chars.push(String.fromCharCode(codePoint))}return utf16Chars.join("")},parse:function(utf16Str){var utf16StrLength=utf16Str.length;var words=[];for(var i=0;i<utf16StrLength;i++){words[i>>>1]|=utf16Str.charCodeAt(i)<<16-i%2*16}return WordArray.create(words,utf16StrLength*2)}};C_enc.Utf16LE={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var utf16Chars=[];for(var i=0;i<sigBytes;i+=2){var codePoint=swapEndian(words[i>>>2]>>>16-i%4*8&65535);utf16Chars.push(String.fromCharCode(codePoint))}return utf16Chars.join("")},parse:function(utf16Str){var utf16StrLength=utf16Str.length;var words=[];for(var i=0;i<utf16StrLength;i++){words[i>>>1]|=swapEndian(utf16Str.charCodeAt(i)<<16-i%2*16)}return WordArray.create(words,utf16StrLength*2)}};function swapEndian(word){return word<<8&4278255360|word>>>8&16711935}})();return CryptoJS.enc.Utf16})},{"./core":9}],12:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./sha1"),require("./hmac"))}else if(typeof define==="function"&&define.amd){define(["./core","./sha1","./hmac"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var WordArray=C_lib.WordArray;var C_algo=C.algo;var MD5=C_algo.MD5;var EvpKDF=C_algo.EvpKDF=Base.extend({cfg:Base.extend({keySize:128/32,hasher:MD5,iterations:1}),init:function(cfg){this.cfg=this.cfg.extend(cfg)},compute:function(password,salt){var cfg=this.cfg;var hasher=cfg.hasher.create();var derivedKey=WordArray.create();var derivedKeyWords=derivedKey.words;var keySize=cfg.keySize;var iterations=cfg.iterations;while(derivedKeyWords.length<keySize){if(block){hasher.update(block)}var block=hasher.update(password).finalize(salt);hasher.reset();for(var i=1;i<iterations;i++){block=hasher.finalize(block);hasher.reset()}derivedKey.concat(block)}derivedKey.sigBytes=keySize*4;return derivedKey}});C.EvpKDF=function(password,salt,cfg){return EvpKDF.create(cfg).compute(password,salt)}})();return CryptoJS.EvpKDF})},{"./core":9,"./hmac":14,"./sha1":33}],13:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(undefined){var C=CryptoJS;var C_lib=C.lib;var CipherParams=C_lib.CipherParams;var C_enc=C.enc;var Hex=C_enc.Hex;var C_format=C.format;var HexFormatter=C_format.Hex={stringify:function(cipherParams){return cipherParams.ciphertext.toString(Hex)},parse:function(input){var ciphertext=Hex.parse(input);return CipherParams.create({ciphertext:ciphertext})}}})();return CryptoJS.format.Hex})},{"./cipher-core":8,"./core":9}],14:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var C_enc=C.enc;var Utf8=C_enc.Utf8;var C_algo=C.algo;var HMAC=C_algo.HMAC=Base.extend({init:function(hasher,key){hasher=this._hasher=new hasher.init;if(typeof key=="string"){key=Utf8.parse(key)}var hasherBlockSize=hasher.blockSize;var hasherBlockSizeBytes=hasherBlockSize*4;if(key.sigBytes>hasherBlockSizeBytes){key=hasher.finalize(key)}key.clamp();var oKey=this._oKey=key.clone();var iKey=this._iKey=key.clone();var oKeyWords=oKey.words;var iKeyWords=iKey.words;for(var i=0;i<hasherBlockSize;i++){oKeyWords[i]^=1549556828;iKeyWords[i]^=909522486}oKey.sigBytes=iKey.sigBytes=hasherBlockSizeBytes;this.reset()},reset:function(){var hasher=this._hasher;hasher.reset();hasher.update(this._iKey)},update:function(messageUpdate){this._hasher.update(messageUpdate);return this},finalize:function(messageUpdate){var hasher=this._hasher;var innerHash=hasher.finalize(messageUpdate);hasher.reset();var hmac=hasher.finalize(this._oKey.clone().concat(innerHash));return hmac}})})()})},{"./core":9}],15:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./x64-core"),require("./lib-typedarrays"),require("./enc-utf16"),require("./enc-base64"),require("./md5"),require("./sha1"),require("./sha256"),require("./sha224"),require("./sha512"),require("./sha384"),require("./sha3"),require("./ripemd160"),require("./hmac"),require("./pbkdf2"),require("./evpkdf"),require("./cipher-core"),require("./mode-cfb"),require("./mode-ctr"),require("./mode-ctr-gladman"),require("./mode-ofb"),require("./mode-ecb"),require("./pad-ansix923"),require("./pad-iso10126"),require("./pad-iso97971"),require("./pad-zeropadding"),require("./pad-nopadding"),require("./format-hex"),require("./aes"),require("./tripledes"),require("./rc4"),require("./rabbit"),require("./rabbit-legacy"))}else if(typeof define==="function"&&define.amd){define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy"],factory)}else{root.CryptoJS=factory(root.CryptoJS)}})(this,function(CryptoJS){return CryptoJS})},{"./aes":7,"./cipher-core":8,"./core":9,"./enc-base64":10,"./enc-utf16":11,"./evpkdf":12,"./format-hex":13,"./hmac":14,"./lib-typedarrays":16,"./md5":17,"./mode-cfb":18,"./mode-ctr":20,"./mode-ctr-gladman":19,"./mode-ecb":21,"./mode-ofb":22,"./pad-ansix923":23,"./pad-iso10126":24,"./pad-iso97971":25,"./pad-nopadding":26,"./pad-zeropadding":27,"./pbkdf2":28,"./rabbit":30,"./rabbit-legacy":29,"./rc4":31,"./ripemd160":32,"./sha1":33,"./sha224":34,"./sha256":35,"./sha3":36,"./sha384":37,"./sha512":38,"./tripledes":39,"./x64-core":40}],16:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){if(typeof ArrayBuffer!="function"){return}var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var superInit=WordArray.init;var subInit=WordArray.init=function(typedArray){if(typedArray instanceof ArrayBuffer){typedArray=new Uint8Array(typedArray)}if(typedArray instanceof Int8Array||typeof Uint8ClampedArray!=="undefined"&&typedArray instanceof Uint8ClampedArray||typedArray instanceof Int16Array||typedArray instanceof Uint16Array||typedArray instanceof Int32Array||typedArray instanceof Uint32Array||typedArray instanceof Float32Array||typedArray instanceof Float64Array){typedArray=new Uint8Array(typedArray.buffer,typedArray.byteOffset,typedArray.byteLength)}if(typedArray instanceof Uint8Array){var typedArrayByteLength=typedArray.byteLength;var words=[];for(var i=0;i<typedArrayByteLength;i++){words[i>>>2]|=typedArray[i]<<24-i%4*8}superInit.call(this,words,typedArrayByteLength)}else{superInit.apply(this,arguments)}};subInit.prototype=WordArray})();return CryptoJS.lib.WordArray})},{"./core":9}],17:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(Math){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var T=[];(function(){for(var i=0;i<64;i++){T[i]=Math.abs(Math.sin(i+1))*4294967296|0}})();var MD5=C_algo.MD5=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(M,offset){for(var i=0;i<16;i++){var offset_i=offset+i;var M_offset_i=M[offset_i];M[offset_i]=(M_offset_i<<8|M_offset_i>>>24)&16711935|(M_offset_i<<24|M_offset_i>>>8)&4278255360}var H=this._hash.words;var M_offset_0=M[offset+0];var M_offset_1=M[offset+1];var M_offset_2=M[offset+2];var M_offset_3=M[offset+3];var M_offset_4=M[offset+4];var M_offset_5=M[offset+5];var M_offset_6=M[offset+6];var M_offset_7=M[offset+7];var M_offset_8=M[offset+8];var M_offset_9=M[offset+9];var M_offset_10=M[offset+10];var M_offset_11=M[offset+11];var M_offset_12=M[offset+12];var M_offset_13=M[offset+13];var M_offset_14=M[offset+14];var M_offset_15=M[offset+15];var a=H[0];var b=H[1];var c=H[2];var d=H[3];a=FF(a,b,c,d,M_offset_0,7,T[0]);d=FF(d,a,b,c,M_offset_1,12,T[1]);c=FF(c,d,a,b,M_offset_2,17,T[2]);b=FF(b,c,d,a,M_offset_3,22,T[3]);a=FF(a,b,c,d,M_offset_4,7,T[4]);d=FF(d,a,b,c,M_offset_5,12,T[5]);c=FF(c,d,a,b,M_offset_6,17,T[6]);b=FF(b,c,d,a,M_offset_7,22,T[7]);a=FF(a,b,c,d,M_offset_8,7,T[8]);d=FF(d,a,b,c,M_offset_9,12,T[9]);c=FF(c,d,a,b,M_offset_10,17,T[10]);b=FF(b,c,d,a,M_offset_11,22,T[11]);a=FF(a,b,c,d,M_offset_12,7,T[12]);d=FF(d,a,b,c,M_offset_13,12,T[13]);c=FF(c,d,a,b,M_offset_14,17,T[14]);b=FF(b,c,d,a,M_offset_15,22,T[15]);a=GG(a,b,c,d,M_offset_1,5,T[16]);d=GG(d,a,b,c,M_offset_6,9,T[17]);c=GG(c,d,a,b,M_offset_11,14,T[18]);b=GG(b,c,d,a,M_offset_0,20,T[19]);a=GG(a,b,c,d,M_offset_5,5,T[20]);d=GG(d,a,b,c,M_offset_10,9,T[21]);c=GG(c,d,a,b,M_offset_15,14,T[22]);b=GG(b,c,d,a,M_offset_4,20,T[23]);a=GG(a,b,c,d,M_offset_9,5,T[24]);d=GG(d,a,b,c,M_offset_14,9,T[25]);c=GG(c,d,a,b,M_offset_3,14,T[26]);b=GG(b,c,d,a,M_offset_8,20,T[27]);a=GG(a,b,c,d,M_offset_13,5,T[28]);d=GG(d,a,b,c,M_offset_2,9,T[29]);c=GG(c,d,a,b,M_offset_7,14,T[30]);b=GG(b,c,d,a,M_offset_12,20,T[31]);a=HH(a,b,c,d,M_offset_5,4,T[32]);d=HH(d,a,b,c,M_offset_8,11,T[33]);c=HH(c,d,a,b,M_offset_11,16,T[34]);b=HH(b,c,d,a,M_offset_14,23,T[35]);a=HH(a,b,c,d,M_offset_1,4,T[36]);d=HH(d,a,b,c,M_offset_4,11,T[37]);c=HH(c,d,a,b,M_offset_7,16,T[38]);b=HH(b,c,d,a,M_offset_10,23,T[39]);a=HH(a,b,c,d,M_offset_13,4,T[40]);d=HH(d,a,b,c,M_offset_0,11,T[41]);c=HH(c,d,a,b,M_offset_3,16,T[42]);b=HH(b,c,d,a,M_offset_6,23,T[43]);a=HH(a,b,c,d,M_offset_9,4,T[44]);d=HH(d,a,b,c,M_offset_12,11,T[45]);c=HH(c,d,a,b,M_offset_15,16,T[46]);b=HH(b,c,d,a,M_offset_2,23,T[47]);a=II(a,b,c,d,M_offset_0,6,T[48]);d=II(d,a,b,c,M_offset_7,10,T[49]);c=II(c,d,a,b,M_offset_14,15,T[50]);b=II(b,c,d,a,M_offset_5,21,T[51]);a=II(a,b,c,d,M_offset_12,6,T[52]);d=II(d,a,b,c,M_offset_3,10,T[53]);c=II(c,d,a,b,M_offset_10,15,T[54]);b=II(b,c,d,a,M_offset_1,21,T[55]);a=II(a,b,c,d,M_offset_8,6,T[56]);d=II(d,a,b,c,M_offset_15,10,T[57]);c=II(c,d,a,b,M_offset_6,15,T[58]);b=II(b,c,d,a,M_offset_13,21,T[59]);a=II(a,b,c,d,M_offset_4,6,T[60]);d=II(d,a,b,c,M_offset_11,10,T[61]);c=II(c,d,a,b,M_offset_2,15,T[62]);b=II(b,c,d,a,M_offset_9,21,T[63]);H[0]=H[0]+a|0;H[1]=H[1]+b|0;H[2]=H[2]+c|0;H[3]=H[3]+d|0},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;var nBitsTotalH=Math.floor(nBitsTotal/4294967296);var nBitsTotalL=nBitsTotal;dataWords[(nBitsLeft+64>>>9<<4)+15]=(nBitsTotalH<<8|nBitsTotalH>>>24)&16711935|(nBitsTotalH<<24|nBitsTotalH>>>8)&4278255360;dataWords[(nBitsLeft+64>>>9<<4)+14]=(nBitsTotalL<<8|nBitsTotalL>>>24)&16711935|(nBitsTotalL<<24|nBitsTotalL>>>8)&4278255360;data.sigBytes=(dataWords.length+1)*4;this._process();var hash=this._hash;var H=hash.words;for(var i=0;i<4;i++){var H_i=H[i];H[i]=(H_i<<8|H_i>>>24)&16711935|(H_i<<24|H_i>>>8)&4278255360}return hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone}});function FF(a,b,c,d,x,s,t){var n=a+(b&c|~b&d)+x+t;return(n<<s|n>>>32-s)+b}function GG(a,b,c,d,x,s,t){var n=a+(b&d|c&~d)+x+t;return(n<<s|n>>>32-s)+b}function HH(a,b,c,d,x,s,t){var n=a+(b^c^d)+x+t;return(n<<s|n>>>32-s)+b}function II(a,b,c,d,x,s,t){var n=a+(c^(b|~d))+x+t;return(n<<s|n>>>32-s)+b}C.MD5=Hasher._createHelper(MD5);C.HmacMD5=Hasher._createHmacHelper(MD5)})(Math);return CryptoJS.MD5})},{"./core":9}],18:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.mode.CFB=function(){var CFB=CryptoJS.lib.BlockCipherMode.extend();CFB.Encryptor=CFB.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;generateKeystreamAndEncrypt.call(this,words,offset,blockSize,cipher);this._prevBlock=words.slice(offset,offset+blockSize)}});CFB.Decryptor=CFB.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;var thisBlock=words.slice(offset,offset+blockSize);generateKeystreamAndEncrypt.call(this,words,offset,blockSize,cipher);this._prevBlock=thisBlock}});function generateKeystreamAndEncrypt(words,offset,blockSize,cipher){var iv=this._iv;if(iv){var keystream=iv.slice(0);this._iv=undefined}else{var keystream=this._prevBlock}cipher.encryptBlock(keystream,0);for(var i=0;i<blockSize;i++){words[offset+i]^=keystream[i]}}return CFB}();return CryptoJS.mode.CFB})},{"./cipher-core":8,"./core":9}],19:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.mode.CTRGladman=function(){var CTRGladman=CryptoJS.lib.BlockCipherMode.extend();function incWord(word){if((word>>24&255)===255){var b1=word>>16&255;var b2=word>>8&255;var b3=word&255;if(b1===255){b1=0;if(b2===255){b2=0;if(b3===255){b3=0}else{++b3}}else{++b2}}else{++b1}word=0;word+=b1<<16;word+=b2<<8;word+=b3}else{word+=1<<24}return word}function incCounter(counter){if((counter[0]=incWord(counter[0]))===0){counter[1]=incWord(counter[1])}return counter}var Encryptor=CTRGladman.Encryptor=CTRGladman.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;var iv=this._iv;var counter=this._counter;if(iv){counter=this._counter=iv.slice(0);this._iv=undefined}incCounter(counter);var keystream=counter.slice(0);cipher.encryptBlock(keystream,0);for(var i=0;i<blockSize;i++){words[offset+i]^=keystream[i]}}});CTRGladman.Decryptor=Encryptor;return CTRGladman}();return CryptoJS.mode.CTRGladman})},{"./cipher-core":8,"./core":9}],20:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.mode.CTR=function(){var CTR=CryptoJS.lib.BlockCipherMode.extend();var Encryptor=CTR.Encryptor=CTR.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;var iv=this._iv;var counter=this._counter;if(iv){counter=this._counter=iv.slice(0);this._iv=undefined}var keystream=counter.slice(0);cipher.encryptBlock(keystream,0);counter[blockSize-1]=counter[blockSize-1]+1|0;for(var i=0;i<blockSize;i++){words[offset+i]^=keystream[i]}}});CTR.Decryptor=Encryptor;return CTR}();return CryptoJS.mode.CTR})},{"./cipher-core":8,"./core":9}],21:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.mode.ECB=function(){var ECB=CryptoJS.lib.BlockCipherMode.extend();ECB.Encryptor=ECB.extend({processBlock:function(words,offset){this._cipher.encryptBlock(words,offset)}});ECB.Decryptor=ECB.extend({processBlock:function(words,offset){this._cipher.decryptBlock(words,offset)}});return ECB}();return CryptoJS.mode.ECB})},{"./cipher-core":8,"./core":9}],22:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.mode.OFB=function(){var OFB=CryptoJS.lib.BlockCipherMode.extend();var Encryptor=OFB.Encryptor=OFB.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;var iv=this._iv;var keystream=this._keystream;if(iv){keystream=this._keystream=iv.slice(0);this._iv=undefined}cipher.encryptBlock(keystream,0);for(var i=0;i<blockSize;i++){words[offset+i]^=keystream[i]}}});OFB.Decryptor=Encryptor;return OFB}();return CryptoJS.mode.OFB})},{"./cipher-core":8,"./core":9}],23:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.pad.AnsiX923={pad:function(data,blockSize){var dataSigBytes=data.sigBytes;var blockSizeBytes=blockSize*4;var nPaddingBytes=blockSizeBytes-dataSigBytes%blockSizeBytes;var lastBytePos=dataSigBytes+nPaddingBytes-1;data.clamp();data.words[lastBytePos>>>2]|=nPaddingBytes<<24-lastBytePos%4*8;data.sigBytes+=nPaddingBytes},unpad:function(data){var nPaddingBytes=data.words[data.sigBytes-1>>>2]&255;data.sigBytes-=nPaddingBytes}};return CryptoJS.pad.Ansix923})},{"./cipher-core":8,"./core":9}],24:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.pad.Iso10126={pad:function(data,blockSize){var blockSizeBytes=blockSize*4;var nPaddingBytes=blockSizeBytes-data.sigBytes%blockSizeBytes;data.concat(CryptoJS.lib.WordArray.random(nPaddingBytes-1)).concat(CryptoJS.lib.WordArray.create([nPaddingBytes<<24],1))},unpad:function(data){var nPaddingBytes=data.words[data.sigBytes-1>>>2]&255;data.sigBytes-=nPaddingBytes}};return CryptoJS.pad.Iso10126})},{"./cipher-core":8,"./core":9}],25:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.pad.Iso97971={pad:function(data,blockSize){data.concat(CryptoJS.lib.WordArray.create([2147483648],1));CryptoJS.pad.ZeroPadding.pad(data,blockSize)},unpad:function(data){CryptoJS.pad.ZeroPadding.unpad(data);data.sigBytes--}};return CryptoJS.pad.Iso97971})},{"./cipher-core":8,"./core":9}],26:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}};return CryptoJS.pad.NoPadding})},{"./cipher-core":8,"./core":9}],27:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){CryptoJS.pad.ZeroPadding={pad:function(data,blockSize){var blockSizeBytes=blockSize*4;data.clamp();data.sigBytes+=blockSizeBytes-(data.sigBytes%blockSizeBytes||blockSizeBytes)},unpad:function(data){var dataWords=data.words;var i=data.sigBytes-1;while(!(dataWords[i>>>2]>>>24-i%4*8&255)){i--}data.sigBytes=i+1}};return CryptoJS.pad.ZeroPadding})},{"./cipher-core":8,"./core":9}],28:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./sha1"),require("./hmac"))}else if(typeof define==="function"&&define.amd){define(["./core","./sha1","./hmac"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var WordArray=C_lib.WordArray;var C_algo=C.algo;var SHA1=C_algo.SHA1;var HMAC=C_algo.HMAC;var PBKDF2=C_algo.PBKDF2=Base.extend({cfg:Base.extend({keySize:128/32,hasher:SHA1,iterations:1}),init:function(cfg){this.cfg=this.cfg.extend(cfg)},compute:function(password,salt){var cfg=this.cfg;var hmac=HMAC.create(cfg.hasher,password);var derivedKey=WordArray.create();var blockIndex=WordArray.create([1]);var derivedKeyWords=derivedKey.words;var blockIndexWords=blockIndex.words;var keySize=cfg.keySize;var iterations=cfg.iterations;while(derivedKeyWords.length<keySize){var block=hmac.update(salt).finalize(blockIndex);hmac.reset();var blockWords=block.words;var blockWordsLength=blockWords.length;var intermediate=block;for(var i=1;i<iterations;i++){intermediate=hmac.finalize(intermediate);hmac.reset();var intermediateWords=intermediate.words;for(var j=0;j<blockWordsLength;j++){blockWords[j]^=intermediateWords[j]}}derivedKey.concat(block);blockIndexWords[0]++}derivedKey.sigBytes=keySize*4;return derivedKey}});C.PBKDF2=function(password,salt,cfg){return PBKDF2.create(cfg).compute(password,salt)}})();return CryptoJS.PBKDF2})},{"./core":9,"./hmac":14,"./sha1":33}],29:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./enc-base64"),require("./md5"),require("./evpkdf"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var StreamCipher=C_lib.StreamCipher;var C_algo=C.algo;var S=[];var C_=[];var G=[];var RabbitLegacy=C_algo.RabbitLegacy=StreamCipher.extend({_doReset:function(){var K=this._key.words;var iv=this.cfg.iv;var X=this._X=[K[0],K[3]<<16|K[2]>>>16,K[1],K[0]<<16|K[3]>>>16,K[2],K[1]<<16|K[0]>>>16,K[3],K[2]<<16|K[1]>>>16];var C=this._C=[K[2]<<16|K[2]>>>16,K[0]&4294901760|K[1]&65535,K[3]<<16|K[3]>>>16,K[1]&4294901760|K[2]&65535,K[0]<<16|K[0]>>>16,K[2]&4294901760|K[3]&65535,K[1]<<16|K[1]>>>16,K[3]&4294901760|K[0]&65535];this._b=0;for(var i=0;i<4;i++){nextState.call(this)}for(var i=0;i<8;i++){C[i]^=X[i+4&7]}if(iv){var IV=iv.words;var IV_0=IV[0];var IV_1=IV[1];var i0=(IV_0<<8|IV_0>>>24)&16711935|(IV_0<<24|IV_0>>>8)&4278255360;var i2=(IV_1<<8|IV_1>>>24)&16711935|(IV_1<<24|IV_1>>>8)&4278255360;var i1=i0>>>16|i2&4294901760;var i3=i2<<16|i0&65535;C[0]^=i0;C[1]^=i1;C[2]^=i2;C[3]^=i3;C[4]^=i0;C[5]^=i1;C[6]^=i2;C[7]^=i3;for(var i=0;i<4;i++){nextState.call(this)}}},_doProcessBlock:function(M,offset){var X=this._X;nextState.call(this);S[0]=X[0]^X[5]>>>16^X[3]<<16;S[1]=X[2]^X[7]>>>16^X[5]<<16;S[2]=X[4]^X[1]>>>16^X[7]<<16;S[3]=X[6]^X[3]>>>16^X[1]<<16;for(var i=0;i<4;i++){S[i]=(S[i]<<8|S[i]>>>24)&16711935|(S[i]<<24|S[i]>>>8)&4278255360;M[offset+i]^=S[i]}},blockSize:128/32,ivSize:64/32});function nextState(){var X=this._X;var C=this._C;for(var i=0;i<8;i++){C_[i]=C[i]}C[0]=C[0]+1295307597+this._b|0;C[1]=C[1]+3545052371+(C[0]>>>0<C_[0]>>>0?1:0)|0;C[2]=C[2]+886263092+(C[1]>>>0<C_[1]>>>0?1:0)|0;C[3]=C[3]+1295307597+(C[2]>>>0<C_[2]>>>0?1:0)|0;C[4]=C[4]+3545052371+(C[3]>>>0<C_[3]>>>0?1:0)|0;C[5]=C[5]+886263092+(C[4]>>>0<C_[4]>>>0?1:0)|0;C[6]=C[6]+1295307597+(C[5]>>>0<C_[5]>>>0?1:0)|0;C[7]=C[7]+3545052371+(C[6]>>>0<C_[6]>>>0?1:0)|0;this._b=C[7]>>>0<C_[7]>>>0?1:0;for(var i=0;i<8;i++){var gx=X[i]+C[i];var ga=gx&65535;var gb=gx>>>16;var gh=((ga*ga>>>17)+ga*gb>>>15)+gb*gb;var gl=((gx&4294901760)*gx|0)+((gx&65535)*gx|0);G[i]=gh^gl}X[0]=G[0]+(G[7]<<16|G[7]>>>16)+(G[6]<<16|G[6]>>>16)|0;X[1]=G[1]+(G[0]<<8|G[0]>>>24)+G[7]|0;X[2]=G[2]+(G[1]<<16|G[1]>>>16)+(G[0]<<16|G[0]>>>16)|0;X[3]=G[3]+(G[2]<<8|G[2]>>>24)+G[1]|0;X[4]=G[4]+(G[3]<<16|G[3]>>>16)+(G[2]<<16|G[2]>>>16)|0;X[5]=G[5]+(G[4]<<8|G[4]>>>24)+G[3]|0;X[6]=G[6]+(G[5]<<16|G[5]>>>16)+(G[4]<<16|G[4]>>>16)|0;X[7]=G[7]+(G[6]<<8|G[6]>>>24)+G[5]|0}C.RabbitLegacy=StreamCipher._createHelper(RabbitLegacy)})();return CryptoJS.RabbitLegacy})},{"./cipher-core":8,"./core":9,"./enc-base64":10,"./evpkdf":12,"./md5":17}],30:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./enc-base64"),require("./md5"),require("./evpkdf"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var StreamCipher=C_lib.StreamCipher;var C_algo=C.algo;var S=[];var C_=[];var G=[];var Rabbit=C_algo.Rabbit=StreamCipher.extend({_doReset:function(){var K=this._key.words;var iv=this.cfg.iv;for(var i=0;i<4;i++){K[i]=(K[i]<<8|K[i]>>>24)&16711935|(K[i]<<24|K[i]>>>8)&4278255360}var X=this._X=[K[0],K[3]<<16|K[2]>>>16,K[1],K[0]<<16|K[3]>>>16,K[2],K[1]<<16|K[0]>>>16,K[3],K[2]<<16|K[1]>>>16];var C=this._C=[K[2]<<16|K[2]>>>16,K[0]&4294901760|K[1]&65535,K[3]<<16|K[3]>>>16,K[1]&4294901760|K[2]&65535,K[0]<<16|K[0]>>>16,K[2]&4294901760|K[3]&65535,K[1]<<16|K[1]>>>16,K[3]&4294901760|K[0]&65535];this._b=0;for(var i=0;i<4;i++){nextState.call(this)}for(var i=0;i<8;i++){C[i]^=X[i+4&7]}if(iv){var IV=iv.words;var IV_0=IV[0];var IV_1=IV[1];var i0=(IV_0<<8|IV_0>>>24)&16711935|(IV_0<<24|IV_0>>>8)&4278255360;var i2=(IV_1<<8|IV_1>>>24)&16711935|(IV_1<<24|IV_1>>>8)&4278255360;var i1=i0>>>16|i2&4294901760;var i3=i2<<16|i0&65535;C[0]^=i0;C[1]^=i1;C[2]^=i2;C[3]^=i3;C[4]^=i0;C[5]^=i1;C[6]^=i2;C[7]^=i3;for(var i=0;i<4;i++){nextState.call(this)}}},_doProcessBlock:function(M,offset){var X=this._X;nextState.call(this);S[0]=X[0]^X[5]>>>16^X[3]<<16;S[1]=X[2]^X[7]>>>16^X[5]<<16;S[2]=X[4]^X[1]>>>16^X[7]<<16;S[3]=X[6]^X[3]>>>16^X[1]<<16;for(var i=0;i<4;i++){S[i]=(S[i]<<8|S[i]>>>24)&16711935|(S[i]<<24|S[i]>>>8)&4278255360;M[offset+i]^=S[i]}},blockSize:128/32,ivSize:64/32});function nextState(){var X=this._X;var C=this._C;for(var i=0;i<8;i++){C_[i]=C[i]}C[0]=C[0]+1295307597+this._b|0;C[1]=C[1]+3545052371+(C[0]>>>0<C_[0]>>>0?1:0)|0;C[2]=C[2]+886263092+(C[1]>>>0<C_[1]>>>0?1:0)|0;C[3]=C[3]+1295307597+(C[2]>>>0<C_[2]>>>0?1:0)|0;C[4]=C[4]+3545052371+(C[3]>>>0<C_[3]>>>0?1:0)|0;C[5]=C[5]+886263092+(C[4]>>>0<C_[4]>>>0?1:0)|0;C[6]=C[6]+1295307597+(C[5]>>>0<C_[5]>>>0?1:0)|0;C[7]=C[7]+3545052371+(C[6]>>>0<C_[6]>>>0?1:0)|0;this._b=C[7]>>>0<C_[7]>>>0?1:0;for(var i=0;i<8;i++){var gx=X[i]+C[i];var ga=gx&65535;var gb=gx>>>16;var gh=((ga*ga>>>17)+ga*gb>>>15)+gb*gb;var gl=((gx&4294901760)*gx|0)+((gx&65535)*gx|0);G[i]=gh^gl}X[0]=G[0]+(G[7]<<16|G[7]>>>16)+(G[6]<<16|G[6]>>>16)|0;X[1]=G[1]+(G[0]<<8|G[0]>>>24)+G[7]|0;X[2]=G[2]+(G[1]<<16|G[1]>>>16)+(G[0]<<16|G[0]>>>16)|0;X[3]=G[3]+(G[2]<<8|G[2]>>>24)+G[1]|0;X[4]=G[4]+(G[3]<<16|G[3]>>>16)+(G[2]<<16|G[2]>>>16)|0;X[5]=G[5]+(G[4]<<8|G[4]>>>24)+G[3]|0;X[6]=G[6]+(G[5]<<16|G[5]>>>16)+(G[4]<<16|G[4]>>>16)|0;X[7]=G[7]+(G[6]<<8|G[6]>>>24)+G[5]|0}C.Rabbit=StreamCipher._createHelper(Rabbit)})();return CryptoJS.Rabbit})},{"./cipher-core":8,"./core":9,"./enc-base64":10,"./evpkdf":12,"./md5":17}],31:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./enc-base64"),require("./md5"),require("./evpkdf"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var StreamCipher=C_lib.StreamCipher;var C_algo=C.algo;var RC4=C_algo.RC4=StreamCipher.extend({_doReset:function(){var key=this._key;var keyWords=key.words;var keySigBytes=key.sigBytes;var S=this._S=[];for(var i=0;i<256;i++){S[i]=i}for(var i=0,j=0;i<256;i++){var keyByteIndex=i%keySigBytes;var keyByte=keyWords[keyByteIndex>>>2]>>>24-keyByteIndex%4*8&255;j=(j+S[i]+keyByte)%256;var t=S[i];S[i]=S[j];S[j]=t}this._i=this._j=0},_doProcessBlock:function(M,offset){M[offset]^=generateKeystreamWord.call(this)},keySize:256/32,ivSize:0});function generateKeystreamWord(){var S=this._S;var i=this._i;var j=this._j;var keystreamWord=0;for(var n=0;n<4;n++){i=(i+1)%256;j=(j+S[i])%256;var t=S[i];S[i]=S[j];S[j]=t;keystreamWord|=S[(S[i]+S[j])%256]<<24-n*8}this._i=i;this._j=j;return keystreamWord}C.RC4=StreamCipher._createHelper(RC4);var RC4Drop=C_algo.RC4Drop=RC4.extend({cfg:RC4.cfg.extend({drop:192}),_doReset:function(){RC4._doReset.call(this);for(var i=this.cfg.drop;i>0;i--){generateKeystreamWord.call(this)}}});C.RC4Drop=StreamCipher._createHelper(RC4Drop)})();return CryptoJS.RC4})},{"./cipher-core":8,"./core":9,"./enc-base64":10,"./evpkdf":12,"./md5":17}],32:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(Math){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var _zl=WordArray.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]);var _zr=WordArray.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]);var _sl=WordArray.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]);var _sr=WordArray.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]);var _hl=WordArray.create([0,1518500249,1859775393,2400959708,2840853838]);var _hr=WordArray.create([1352829926,1548603684,1836072691,2053994217,0]);var RIPEMD160=C_algo.RIPEMD160=Hasher.extend({_doReset:function(){this._hash=WordArray.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){for(var i=0;i<16;i++){var offset_i=offset+i;var M_offset_i=M[offset_i];M[offset_i]=(M_offset_i<<8|M_offset_i>>>24)&16711935|(M_offset_i<<24|M_offset_i>>>8)&4278255360}var H=this._hash.words;var hl=_hl.words;var hr=_hr.words;var zl=_zl.words;var zr=_zr.words;var sl=_sl.words;var sr=_sr.words;var al,bl,cl,dl,el;var ar,br,cr,dr,er;ar=al=H[0];br=bl=H[1];cr=cl=H[2];dr=dl=H[3];er=el=H[4];var t;for(var i=0;i<80;i+=1){t=al+M[offset+zl[i]]|0;if(i<16){t+=f1(bl,cl,dl)+hl[0]}else if(i<32){t+=f2(bl,cl,dl)+hl[1]}else if(i<48){t+=f3(bl,cl,dl)+hl[2]}else if(i<64){t+=f4(bl,cl,dl)+hl[3]}else{t+=f5(bl,cl,dl)+hl[4]}t=t|0;t=rotl(t,sl[i]);t=t+el|0;al=el;el=dl;dl=rotl(cl,10);cl=bl;bl=t;t=ar+M[offset+zr[i]]|0;if(i<16){t+=f5(br,cr,dr)+hr[0]}else if(i<32){t+=f4(br,cr,dr)+hr[1]}else if(i<48){t+=f3(br,cr,dr)+hr[2]}else if(i<64){t+=f2(br,cr,dr)+hr[3]}else{t+=f1(br,cr,dr)+hr[4]}t=t|0;t=rotl(t,sr[i]);t=t+er|0;ar=er;er=dr;dr=rotl(cr,10);cr=br;br=t}t=H[1]+cl+dr|0;H[1]=H[2]+dl+er|0;H[2]=H[3]+el+ar|0;H[3]=H[4]+al+br|0;H[4]=H[0]+bl+cr|0;H[0]=t},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;dataWords[(nBitsLeft+64>>>9<<4)+14]=(nBitsTotal<<8|nBitsTotal>>>24)&16711935|(nBitsTotal<<24|nBitsTotal>>>8)&4278255360;data.sigBytes=(dataWords.length+1)*4;this._process();var hash=this._hash;var H=hash.words;for(var i=0;i<5;i++){var H_i=H[i];H[i]=(H_i<<8|H_i>>>24)&16711935|(H_i<<24|H_i>>>8)&4278255360}return hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone}});function f1(x,y,z){return x^y^z}function f2(x,y,z){return x&y|~x&z}function f3(x,y,z){return(x|~y)^z}function f4(x,y,z){return x&z|y&~z}function f5(x,y,z){return x^(y|~z)}function rotl(x,n){return x<<n|x>>>32-n}C.RIPEMD160=Hasher._createHelper(RIPEMD160);C.HmacRIPEMD160=Hasher._createHmacHelper(RIPEMD160)})(Math);return CryptoJS.RIPEMD160})},{"./core":9}],33:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var W=[];var SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){var H=this._hash.words;var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];for(var i=0;i<80;i++){if(i<16){W[i]=M[offset+i]|0}else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=n<<1|n>>>31}var t=(a<<5|a>>>27)+e+W[i];if(i<20){t+=(b&c|~b&d)+1518500249}else if(i<40){t+=(b^c^d)+1859775393}else if(i<60){t+=(b&c|b&d|c&d)-1894007588}else{t+=(b^c^d)-899497514}e=d;d=c;c=b<<30|b>>>2;b=a;a=t}H[0]=H[0]+a|0;H[1]=H[1]+b|0;H[2]=H[2]+c|0;H[3]=H[3]+d|0;H[4]=H[4]+e|0},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296);dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();return this._hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone}});C.SHA1=Hasher._createHelper(SHA1);C.HmacSHA1=Hasher._createHmacHelper(SHA1)})();return CryptoJS.SHA1})},{"./core":9}],34:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./sha256"))}else if(typeof define==="function"&&define.amd){define(["./core","./sha256"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var C_algo=C.algo;var SHA256=C_algo.SHA256;var SHA224=C_algo.SHA224=SHA256.extend({_doReset:function(){this._hash=new WordArray.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var hash=SHA256._doFinalize.call(this);hash.sigBytes-=4;return hash}});C.SHA224=SHA256._createHelper(SHA224);C.HmacSHA224=SHA256._createHmacHelper(SHA224)})();return CryptoJS.SHA224})},{"./core":9,"./sha256":35}],35:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(Math){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var H=[];var K=[];(function(){function isPrime(n){var sqrtN=Math.sqrt(n);for(var factor=2;factor<=sqrtN;factor++){if(!(n%factor)){return false}}return true}function getFractionalBits(n){return(n-(n|0))*4294967296|0}var n=2;var nPrime=0;while(nPrime<64){if(isPrime(n)){if(nPrime<8){H[nPrime]=getFractionalBits(Math.pow(n,1/2))}K[nPrime]=getFractionalBits(Math.pow(n,1/3));nPrime++}n++}})();var W=[];var SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){var H=this._hash.words;var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];var f=H[5];var g=H[6];var h=H[7];for(var i=0;i<64;i++){if(i<16){W[i]=M[offset+i]|0}else{var gamma0x=W[i-15];var gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3;var gamma1x=W[i-2];var gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var ch=e&f^~e&g;var maj=a&b^a&c^b&c;var sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22);var sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25);var t1=h+sigma1+ch+K[i]+W[i];var t2=sigma0+maj;h=g;g=f;f=e;e=d+t1|0;d=c;c=b;b=a;a=t1+t2|0}H[0]=H[0]+a|0;H[1]=H[1]+b|0;H[2]=H[2]+c|0;H[3]=H[3]+d|0;H[4]=H[4]+e|0;H[5]=H[5]+f|0;H[6]=H[6]+g|0;H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296);dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();return this._hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone}});C.SHA256=Hasher._createHelper(SHA256);C.HmacSHA256=Hasher._createHmacHelper(SHA256)})(Math);return CryptoJS.SHA256})},{"./core":9}],36:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./x64-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./x64-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(Math){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_x64=C.x64;var X64Word=C_x64.Word;var C_algo=C.algo;var RHO_OFFSETS=[];var PI_INDEXES=[];var ROUND_CONSTANTS=[];(function(){var x=1,y=0;for(var t=0;t<24;t++){RHO_OFFSETS[x+5*y]=(t+1)*(t+2)/2%64;var newX=y%5;var newY=(2*x+3*y)%5;x=newX;y=newY}for(var x=0;x<5;x++){for(var y=0;y<5;y++){PI_INDEXES[x+5*y]=y+(2*x+3*y)%5*5}}var LFSR=1;for(var i=0;i<24;i++){var roundConstantMsw=0;var roundConstantLsw=0;for(var j=0;j<7;j++){if(LFSR&1){var bitPosition=(1<<j)-1;if(bitPosition<32){roundConstantLsw^=1<<bitPosition}else{roundConstantMsw^=1<<bitPosition-32}}if(LFSR&128){LFSR=LFSR<<1^113}else{LFSR<<=1}}ROUND_CONSTANTS[i]=X64Word.create(roundConstantMsw,roundConstantLsw)}})();var T=[];(function(){for(var i=0;i<25;i++){T[i]=X64Word.create()}})();var SHA3=C_algo.SHA3=Hasher.extend({cfg:Hasher.cfg.extend({outputLength:512}),_doReset:function(){var state=this._state=[];for(var i=0;i<25;i++){state[i]=new X64Word.init}this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(M,offset){var state=this._state;var nBlockSizeLanes=this.blockSize/2;for(var i=0;i<nBlockSizeLanes;i++){var M2i=M[offset+2*i];var M2i1=M[offset+2*i+1];M2i=(M2i<<8|M2i>>>24)&16711935|(M2i<<24|M2i>>>8)&4278255360;M2i1=(M2i1<<8|M2i1>>>24)&16711935|(M2i1<<24|M2i1>>>8)&4278255360;var lane=state[i];lane.high^=M2i1;lane.low^=M2i}for(var round=0;round<24;round++){for(var x=0;x<5;x++){var tMsw=0,tLsw=0;for(var y=0;y<5;y++){var lane=state[x+5*y];tMsw^=lane.high;tLsw^=lane.low}var Tx=T[x];Tx.high=tMsw;Tx.low=tLsw}for(var x=0;x<5;x++){var Tx4=T[(x+4)%5];var Tx1=T[(x+1)%5];var Tx1Msw=Tx1.high;var Tx1Lsw=Tx1.low;var tMsw=Tx4.high^(Tx1Msw<<1|Tx1Lsw>>>31);var tLsw=Tx4.low^(Tx1Lsw<<1|Tx1Msw>>>31);for(var y=0;y<5;y++){var lane=state[x+5*y];lane.high^=tMsw;lane.low^=tLsw}}for(var laneIndex=1;laneIndex<25;laneIndex++){var lane=state[laneIndex];var laneMsw=lane.high;var laneLsw=lane.low;var rhoOffset=RHO_OFFSETS[laneIndex];if(rhoOffset<32){var tMsw=laneMsw<<rhoOffset|laneLsw>>>32-rhoOffset;var tLsw=laneLsw<<rhoOffset|laneMsw>>>32-rhoOffset}else{var tMsw=laneLsw<<rhoOffset-32|laneMsw>>>64-rhoOffset;var tLsw=laneMsw<<rhoOffset-32|laneLsw>>>64-rhoOffset}var TPiLane=T[PI_INDEXES[laneIndex]];TPiLane.high=tMsw;TPiLane.low=tLsw}var T0=T[0];var state0=state[0];T0.high=state0.high;T0.low=state0.low;for(var x=0;x<5;x++){for(var y=0;y<5;y++){var laneIndex=x+5*y;var lane=state[laneIndex];var TLane=T[laneIndex];var Tx1Lane=T[(x+1)%5+5*y];var Tx2Lane=T[(x+2)%5+5*y];lane.high=TLane.high^~Tx1Lane.high&Tx2Lane.high;lane.low=TLane.low^~Tx1Lane.low&Tx2Lane.low}}var lane=state[0];var roundConstant=ROUND_CONSTANTS[round];lane.high^=roundConstant.high;lane.low^=roundConstant.low}},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;var blockSizeBits=this.blockSize*32;dataWords[nBitsLeft>>>5]|=1<<24-nBitsLeft%32;dataWords[(Math.ceil((nBitsLeft+1)/blockSizeBits)*blockSizeBits>>>5)-1]|=128;data.sigBytes=dataWords.length*4;this._process();var state=this._state;var outputLengthBytes=this.cfg.outputLength/8;var outputLengthLanes=outputLengthBytes/8;var hashWords=[];for(var i=0;i<outputLengthLanes;i++){var lane=state[i];var laneMsw=lane.high;var laneLsw=lane.low;laneMsw=(laneMsw<<8|laneMsw>>>24)&16711935|(laneMsw<<24|laneMsw>>>8)&4278255360;laneLsw=(laneLsw<<8|laneLsw>>>24)&16711935|(laneLsw<<24|laneLsw>>>8)&4278255360;hashWords.push(laneLsw);hashWords.push(laneMsw)}return new WordArray.init(hashWords,outputLengthBytes)},clone:function(){var clone=Hasher.clone.call(this);var state=clone._state=this._state.slice(0);for(var i=0;i<25;i++){state[i]=state[i].clone()}return clone}});C.SHA3=Hasher._createHelper(SHA3);C.HmacSHA3=Hasher._createHmacHelper(SHA3)})(Math);return CryptoJS.SHA3})},{"./core":9,"./x64-core":40}],37:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./x64-core"),require("./sha512"))}else if(typeof define==="function"&&define.amd){define(["./core","./x64-core","./sha512"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_x64=C.x64;var X64Word=C_x64.Word;var X64WordArray=C_x64.WordArray;var C_algo=C.algo;var SHA512=C_algo.SHA512;var SHA384=C_algo.SHA384=SHA512.extend({_doReset:function(){this._hash=new X64WordArray.init([new X64Word.init(3418070365,3238371032),new X64Word.init(1654270250,914150663),new X64Word.init(2438529370,812702999),new X64Word.init(355462360,4144912697),new X64Word.init(1731405415,4290775857),new X64Word.init(2394180231,1750603025),new X64Word.init(3675008525,1694076839),new X64Word.init(1203062813,3204075428)])},_doFinalize:function(){var hash=SHA512._doFinalize.call(this);hash.sigBytes-=16;return hash}});C.SHA384=SHA512._createHelper(SHA384);C.HmacSHA384=SHA512._createHmacHelper(SHA384)})();return CryptoJS.SHA384})},{"./core":9,"./sha512":38,"./x64-core":40}],38:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./x64-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./x64-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var Hasher=C_lib.Hasher;var C_x64=C.x64;var X64Word=C_x64.Word;var X64WordArray=C_x64.WordArray;var C_algo=C.algo;function X64Word_create(){return X64Word.create.apply(X64Word,arguments)}var K=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)];var W=[];(function(){for(var i=0;i<80;i++){W[i]=X64Word_create()}})();var SHA512=C_algo.SHA512=Hasher.extend({_doReset:function(){this._hash=new X64WordArray.init([new X64Word.init(1779033703,4089235720),new X64Word.init(3144134277,2227873595),new X64Word.init(1013904242,4271175723),new X64Word.init(2773480762,1595750129),new X64Word.init(1359893119,2917565137),new X64Word.init(2600822924,725511199),new X64Word.init(528734635,4215389547),new X64Word.init(1541459225,327033209)])},_doProcessBlock:function(M,offset){var H=this._hash.words;var H0=H[0];var H1=H[1];var H2=H[2];var H3=H[3];var H4=H[4];var H5=H[5];var H6=H[6];var H7=H[7];var H0h=H0.high;var H0l=H0.low;var H1h=H1.high;var H1l=H1.low;var H2h=H2.high;var H2l=H2.low;var H3h=H3.high;var H3l=H3.low;var H4h=H4.high;var H4l=H4.low;var H5h=H5.high;var H5l=H5.low;var H6h=H6.high;var H6l=H6.low;var H7h=H7.high;var H7l=H7.low;var ah=H0h;var al=H0l;var bh=H1h;var bl=H1l;var ch=H2h;var cl=H2l;var dh=H3h;var dl=H3l;var eh=H4h;var el=H4l;var fh=H5h;var fl=H5l;var gh=H6h;var gl=H6l;var hh=H7h;var hl=H7l;for(var i=0;i<80;i++){var Wi=W[i];if(i<16){var Wih=Wi.high=M[offset+i*2]|0;var Wil=Wi.low=M[offset+i*2+1]|0}else{var gamma0x=W[i-15];var gamma0xh=gamma0x.high;var gamma0xl=gamma0x.low;var gamma0h=(gamma0xh>>>1|gamma0xl<<31)^(gamma0xh>>>8|gamma0xl<<24)^gamma0xh>>>7;var gamma0l=(gamma0xl>>>1|gamma0xh<<31)^(gamma0xl>>>8|gamma0xh<<24)^(gamma0xl>>>7|gamma0xh<<25);var gamma1x=W[i-2];var gamma1xh=gamma1x.high;var gamma1xl=gamma1x.low;var gamma1h=(gamma1xh>>>19|gamma1xl<<13)^(gamma1xh<<3|gamma1xl>>>29)^gamma1xh>>>6;var gamma1l=(gamma1xl>>>19|gamma1xh<<13)^(gamma1xl<<3|gamma1xh>>>29)^(gamma1xl>>>6|gamma1xh<<26);var Wi7=W[i-7];var Wi7h=Wi7.high;var Wi7l=Wi7.low;var Wi16=W[i-16];var Wi16h=Wi16.high;var Wi16l=Wi16.low;var Wil=gamma0l+Wi7l;var Wih=gamma0h+Wi7h+(Wil>>>0<gamma0l>>>0?1:0);var Wil=Wil+gamma1l;var Wih=Wih+gamma1h+(Wil>>>0<gamma1l>>>0?1:0);var Wil=Wil+Wi16l;var Wih=Wih+Wi16h+(Wil>>>0<Wi16l>>>0?1:0);Wi.high=Wih;Wi.low=Wil}var chh=eh&fh^~eh&gh;var chl=el&fl^~el&gl;var majh=ah&bh^ah&ch^bh&ch;var majl=al&bl^al&cl^bl&cl;var sigma0h=(ah>>>28|al<<4)^(ah<<30|al>>>2)^(ah<<25|al>>>7);var sigma0l=(al>>>28|ah<<4)^(al<<30|ah>>>2)^(al<<25|ah>>>7);var sigma1h=(eh>>>14|el<<18)^(eh>>>18|el<<14)^(eh<<23|el>>>9);var sigma1l=(el>>>14|eh<<18)^(el>>>18|eh<<14)^(el<<23|eh>>>9);var Ki=K[i];var Kih=Ki.high;var Kil=Ki.low;var t1l=hl+sigma1l;var t1h=hh+sigma1h+(t1l>>>0<hl>>>0?1:0);var t1l=t1l+chl;var t1h=t1h+chh+(t1l>>>0<chl>>>0?1:0);var t1l=t1l+Kil;var t1h=t1h+Kih+(t1l>>>0<Kil>>>0?1:0);var t1l=t1l+Wil;var t1h=t1h+Wih+(t1l>>>0<Wil>>>0?1:0);var t2l=sigma0l+majl;var t2h=sigma0h+majh+(t2l>>>0<sigma0l>>>0?1:0);hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;el=dl+t1l|0;eh=dh+t1h+(el>>>0<dl>>>0?1:0)|0;dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;al=t1l+t2l|0;ah=t1h+t2h+(al>>>0<t1l>>>0?1:0)|0}H0l=H0.low=H0l+al;H0.high=H0h+ah+(H0l>>>0<al>>>0?1:0);H1l=H1.low=H1l+bl;H1.high=H1h+bh+(H1l>>>0<bl>>>0?1:0);H2l=H2.low=H2l+cl;H2.high=H2h+ch+(H2l>>>0<cl>>>0?1:0);H3l=H3.low=H3l+dl;H3.high=H3h+dh+(H3l>>>0<dl>>>0?1:0);H4l=H4.low=H4l+el;H4.high=H4h+eh+(H4l>>>0<el>>>0?1:0);H5l=H5.low=H5l+fl;H5.high=H5h+fh+(H5l>>>0<fl>>>0?1:0);H6l=H6.low=H6l+gl;H6.high=H6h+gh+(H6l>>>0<gl>>>0?1:0);H7l=H7.low=H7l+hl;H7.high=H7h+hh+(H7l>>>0<hl>>>0?1:0)},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;dataWords[(nBitsLeft+128>>>10<<5)+30]=Math.floor(nBitsTotal/4294967296);dataWords[(nBitsLeft+128>>>10<<5)+31]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();var hash=this._hash.toX32();return hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone},blockSize:1024/32});C.SHA512=Hasher._createHelper(SHA512);C.HmacSHA512=Hasher._createHmacHelper(SHA512)})();return CryptoJS.SHA512})},{"./core":9,"./x64-core":40}],39:[function(require,module,exports){(function(root,factory,undef){if(typeof exports==="object"){module.exports=exports=factory(require("./core"),require("./enc-base64"),require("./md5"),require("./evpkdf"),require("./cipher-core"))}else if(typeof define==="function"&&define.amd){define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var BlockCipher=C_lib.BlockCipher;var C_algo=C.algo;var PC1=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4];var PC2=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32];var BIT_SHIFTS=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28];var SBOX_P=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}];var SBOX_MASK=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679];var DES=C_algo.DES=BlockCipher.extend({_doReset:function(){var key=this._key;var keyWords=key.words;var keyBits=[];for(var i=0;i<56;i++){var keyBitPos=PC1[i]-1;keyBits[i]=keyWords[keyBitPos>>>5]>>>31-keyBitPos%32&1}var subKeys=this._subKeys=[];for(var nSubKey=0;nSubKey<16;nSubKey++){var subKey=subKeys[nSubKey]=[];var bitShift=BIT_SHIFTS[nSubKey];for(var i=0;i<24;i++){subKey[i/6|0]|=keyBits[(PC2[i]-1+bitShift)%28]<<31-i%6;subKey[4+(i/6|0)]|=keyBits[28+(PC2[i+24]-1+bitShift)%28]<<31-i%6}subKey[0]=subKey[0]<<1|subKey[0]>>>31;for(var i=1;i<7;i++){subKey[i]=subKey[i]>>>(i-1)*4+3}subKey[7]=subKey[7]<<5|subKey[7]>>>27}var invSubKeys=this._invSubKeys=[];for(var i=0;i<16;i++){invSubKeys[i]=subKeys[15-i]}},encryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._subKeys)},decryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._invSubKeys)},_doCryptBlock:function(M,offset,subKeys){this._lBlock=M[offset];this._rBlock=M[offset+1];exchangeLR.call(this,4,252645135);exchangeLR.call(this,16,65535);exchangeRL.call(this,2,858993459);exchangeRL.call(this,8,16711935);exchangeLR.call(this,1,1431655765);for(var round=0;round<16;round++){var subKey=subKeys[round];var lBlock=this._lBlock;var rBlock=this._rBlock;var f=0;for(var i=0;i<8;i++){f|=SBOX_P[i][((rBlock^subKey[i])&SBOX_MASK[i])>>>0]}this._lBlock=rBlock;this._rBlock=lBlock^f}var t=this._lBlock;this._lBlock=this._rBlock;this._rBlock=t;exchangeLR.call(this,1,1431655765);exchangeRL.call(this,8,16711935);exchangeRL.call(this,2,858993459);exchangeLR.call(this,16,65535);exchangeLR.call(this,4,252645135);M[offset]=this._lBlock;M[offset+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function exchangeLR(offset,mask){var t=(this._lBlock>>>offset^this._rBlock)&mask;this._rBlock^=t;this._lBlock^=t<<offset}function exchangeRL(offset,mask){var t=(this._rBlock>>>offset^this._lBlock)&mask;this._lBlock^=t;this._rBlock^=t<<offset}C.DES=BlockCipher._createHelper(DES);var TripleDES=C_algo.TripleDES=BlockCipher.extend({_doReset:function(){var key=this._key;var keyWords=key.words;this._des1=DES.createEncryptor(WordArray.create(keyWords.slice(0,2)));this._des2=DES.createEncryptor(WordArray.create(keyWords.slice(2,4)));this._des3=DES.createEncryptor(WordArray.create(keyWords.slice(4,6)))},encryptBlock:function(M,offset){this._des1.encryptBlock(M,offset);this._des2.decryptBlock(M,offset);this._des3.encryptBlock(M,offset)},decryptBlock:function(M,offset){this._des3.decryptBlock(M,offset);this._des2.encryptBlock(M,offset);this._des1.decryptBlock(M,offset)},keySize:192/32,ivSize:64/32,blockSize:64/32});C.TripleDES=BlockCipher._createHelper(TripleDES)})();return CryptoJS.TripleDES})},{"./cipher-core":8,"./core":9,"./enc-base64":10,"./evpkdf":12,"./md5":17}],40:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(undefined){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var X32WordArray=C_lib.WordArray;var C_x64=C.x64={};var X64Word=C_x64.Word=Base.extend({init:function(high,low){this.high=high;this.low=low}});var X64WordArray=C_x64.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[];if(sigBytes!=undefined){this.sigBytes=sigBytes}else{this.sigBytes=words.length*8}},toX32:function(){var x64Words=this.words;var x64WordsLength=x64Words.length;var x32Words=[];for(var i=0;i<x64WordsLength;i++){var x64Word=x64Words[i];x32Words.push(x64Word.high);x32Words.push(x64Word.low)}return X32WordArray.create(x32Words,this.sigBytes)},clone:function(){var clone=Base.clone.call(this);var words=clone.words=this.words.slice(0);var wordsLength=words.length;for(var i=0;i<wordsLength;i++){words[i]=words[i].clone()}return clone}})})();return CryptoJS})},{"./core":9}],41:[function(require,module,exports){(function(global,setImmediate){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.Dexie=factory()})(this,function(){"use strict";var keys=Object.keys;var isArray=Array.isArray;var _global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:global;function extend(obj,extension){if(typeof extension!=="object")return obj;keys(extension).forEach(function(key){obj[key]=extension[key]});return obj}var getProto=Object.getPrototypeOf;var _hasOwn={}.hasOwnProperty;function hasOwn(obj,prop){return _hasOwn.call(obj,prop)}function props(proto,extension){if(typeof extension==="function")extension=extension(getProto(proto));keys(extension).forEach(function(key){setProp(proto,key,extension[key])})}var defineProperty=Object.defineProperty;function setProp(obj,prop,functionOrGetSet,options){defineProperty(obj,prop,extend(functionOrGetSet&&hasOwn(functionOrGetSet,"get")&&typeof functionOrGetSet.get==="function"?{get:functionOrGetSet.get,set:functionOrGetSet.set,configurable:true}:{value:functionOrGetSet,configurable:true,writable:true},options))}function derive(Child){return{from:function(Parent){Child.prototype=Object.create(Parent.prototype);setProp(Child.prototype,"constructor",Child);return{extend:props.bind(null,Child.prototype)}}}}var getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;function getPropertyDescriptor(obj,prop){var pd=getOwnPropertyDescriptor(obj,prop),proto;return pd||(proto=getProto(obj))&&getPropertyDescriptor(proto,prop)}var _slice=[].slice;function slice(args,start,end){return _slice.call(args,start,end)}function override(origFunc,overridedFactory){return overridedFactory(origFunc)}function assert(b){if(!b)throw new Error("Assertion Failed")}function asap(fn){if(_global.setImmediate)setImmediate(fn);else setTimeout(fn,0)}function arrayToObject(array,extractor){return array.reduce(function(result,item,i){var nameAndValue=extractor(item,i);if(nameAndValue)result[nameAndValue[0]]=nameAndValue[1];return result},{})}function trycatcher(fn,reject){return function(){try{fn.apply(this,arguments)}catch(e){reject(e)}}}function tryCatch(fn,onerror,args){try{fn.apply(null,args)}catch(ex){onerror&&onerror(ex)}}function getByKeyPath(obj,keyPath){if(hasOwn(obj,keyPath))return obj[keyPath];if(!keyPath)return obj;if(typeof keyPath!=="string"){var rv=[];for(var i=0,l=keyPath.length;i<l;++i){var val=getByKeyPath(obj,keyPath[i]);rv.push(val)}return rv}var period=keyPath.indexOf(".");if(period!==-1){var innerObj=obj[keyPath.substr(0,period)];return innerObj===undefined?undefined:getByKeyPath(innerObj,keyPath.substr(period+1))}return undefined}function setByKeyPath(obj,keyPath,value){if(!obj||keyPath===undefined)return;if("isFrozen"in Object&&Object.isFrozen(obj))return;if(typeof keyPath!=="string"&&"length"in keyPath){assert(typeof value!=="string"&&"length"in value);for(var i=0,l=keyPath.length;i<l;++i){setByKeyPath(obj,keyPath[i],value[i])}}else{var period=keyPath.indexOf(".");if(period!==-1){var currentKeyPath=keyPath.substr(0,period);var remainingKeyPath=keyPath.substr(period+1);if(remainingKeyPath==="")if(value===undefined)delete obj[currentKeyPath];else obj[currentKeyPath]=value;else{var innerObj=obj[currentKeyPath];if(!innerObj)innerObj=obj[currentKeyPath]={};setByKeyPath(innerObj,remainingKeyPath,value)}}else{if(value===undefined)delete obj[keyPath];else obj[keyPath]=value}}}function delByKeyPath(obj,keyPath){if(typeof keyPath==="string")setByKeyPath(obj,keyPath,undefined);else if("length"in keyPath)[].map.call(keyPath,function(kp){setByKeyPath(obj,kp,undefined)})}function shallowClone(obj){var rv={};for(var m in obj){if(hasOwn(obj,m))rv[m]=obj[m]}return rv}var concat=[].concat;function flatten(a){return concat.apply([],a)}var intrinsicTypes="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(flatten([8,16,32,64].map(function(num){return["Int","Uint","Float"].map(function(t){return t+num+"Array"})}))).filter(function(t){return _global[t]}).map(function(t){return _global[t]});function deepClone(any){if(!any||typeof any!=="object")return any;var rv;if(isArray(any)){rv=[];for(var i=0,l=any.length;i<l;++i){rv.push(deepClone(any[i]))}}else if(intrinsicTypes.indexOf(any.constructor)>=0){rv=any}else{rv=any.constructor?Object.create(any.constructor.prototype):{};for(var prop in any){if(hasOwn(any,prop)){rv[prop]=deepClone(any[prop])}}}return rv}function getObjectDiff(a,b,rv,prfx){rv=rv||{};prfx=prfx||"";keys(a).forEach(function(prop){if(!hasOwn(b,prop))rv[prfx+prop]=undefined;else{var ap=a[prop],bp=b[prop];if(typeof ap==="object"&&typeof bp==="object"&&ap&&bp&&""+ap.constructor===""+bp.constructor)getObjectDiff(ap,bp,rv,prfx+prop+".");else if(ap!==bp)rv[prfx+prop]=b[prop]}});keys(b).forEach(function(prop){if(!hasOwn(a,prop)){rv[prfx+prop]=b[prop]}});return rv}var iteratorSymbol=typeof Symbol!=="undefined"&&Symbol.iterator;var getIteratorOf=iteratorSymbol?function(x){var i;return x!=null&&(i=x[iteratorSymbol])&&i.apply(x)}:function(){return null};var NO_CHAR_ARRAY={};function getArrayOf(arrayLike){var i,a,x,it;if(arguments.length===1){if(isArray(arrayLike))return arrayLike.slice();if(this===NO_CHAR_ARRAY&&typeof arrayLike==="string")return[arrayLike];if(it=getIteratorOf(arrayLike)){a=[];while(x=it.next(),!x.done)a.push(x.value);return a}if(arrayLike==null)return[arrayLike];i=arrayLike.length;if(typeof i==="number"){a=new Array(i);while(i--)a[i]=arrayLike[i];return a}return[arrayLike]}i=arguments.length;a=new Array(i);while(i--)a[i]=arguments[i];return a}var debug=typeof location!=="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function setDebug(value,filter){debug=value;libraryFilter=filter}var libraryFilter=function(){return true};var NEEDS_THROW_FOR_STACK=!new Error("").stack;function getErrorWithStack(){"use strict";if(NEEDS_THROW_FOR_STACK)try{getErrorWithStack.arguments;throw new Error}catch(e){return e}return new Error}function prettyStack(exception,numIgnoredFrames){var stack=exception.stack;if(!stack)return"";numIgnoredFrames=numIgnoredFrames||0;if(stack.indexOf(exception.name)===0)numIgnoredFrames+=(exception.name+exception.message).split("\n").length;return stack.split("\n").slice(numIgnoredFrames).filter(libraryFilter).map(function(frame){return"\n"+frame}).join("")}function deprecated(what,fn){return function(){console.warn(what+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+prettyStack(getErrorWithStack(),1));return fn.apply(this,arguments)}}var dexieErrorNames=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"];var idbDomErrorNames=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"];var errorList=dexieErrorNames.concat(idbDomErrorNames);var defaultTexts={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function DexieError(name,msg){this._e=getErrorWithStack();this.name=name;this.message=msg}derive(DexieError).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+prettyStack(this._e,2))}},toString:function(){return this.name+": "+this.message}});function getMultiErrorMessage(msg,failures){return msg+". Errors: "+failures.map(function(f){return f.toString()}).filter(function(v,i,s){return s.indexOf(v)===i}).join("\n")}function ModifyError(msg,failures,successCount,failedKeys){this._e=getErrorWithStack();this.failures=failures;this.failedKeys=failedKeys;this.successCount=successCount}derive(ModifyError).from(DexieError);function BulkError(msg,failures){this._e=getErrorWithStack();this.name="BulkError";this.failures=failures;this.message=getMultiErrorMessage(msg,failures)}derive(BulkError).from(DexieError);var errnames=errorList.reduce(function(obj,name){return obj[name]=name+"Error",obj},{});var BaseException=DexieError;var exceptions=errorList.reduce(function(obj,name){var fullName=name+"Error";function DexieError(msgOrInner,inner){this._e=getErrorWithStack();this.name=fullName;if(!msgOrInner){this.message=defaultTexts[name]||fullName;this.inner=null}else if(typeof msgOrInner==="string"){this.message=msgOrInner;this.inner=inner||null}else if(typeof msgOrInner==="object"){this.message=msgOrInner.name+" "+msgOrInner.message;this.inner=msgOrInner}}derive(DexieError).from(BaseException);obj[name]=DexieError;return obj},{});exceptions.Syntax=SyntaxError;exceptions.Type=TypeError;exceptions.Range=RangeError;var exceptionMap=idbDomErrorNames.reduce(function(obj,name){obj[name+"Error"]=exceptions[name];return obj},{});function mapError(domError,message){if(!domError||domError instanceof DexieError||domError instanceof TypeError||domError instanceof SyntaxError||!domError.name||!exceptionMap[domError.name])return domError;var rv=new exceptionMap[domError.name](message||domError.message,domError);if("stack"in domError){setProp(rv,"stack",{get:function(){return this.inner.stack}})}return rv}var fullNameExceptions=errorList.reduce(function(obj,name){if(["Syntax","Type","Range"].indexOf(name)===-1)obj[name+"Error"]=exceptions[name];return obj},{});fullNameExceptions.ModifyError=ModifyError;fullNameExceptions.DexieError=DexieError;fullNameExceptions.BulkError=BulkError;function nop(){}function mirror(val){return val}function pureFunctionChain(f1,f2){if(f1==null||f1===mirror)return f2;return function(val){return f2(f1(val))}}function callBoth(on1,on2){return function(){on1.apply(this,arguments);on2.apply(this,arguments)}}function hookCreatingChain(f1,f2){if(f1===nop)return f2;return function(){var res=f1.apply(this,arguments);if(res!==undefined)arguments[0]=res;var onsuccess=this.onsuccess,onerror=this.onerror;this.onsuccess=null;this.onerror=null;var res2=f2.apply(this,arguments);if(onsuccess)this.onsuccess=this.onsuccess?callBoth(onsuccess,this.onsuccess):onsuccess;if(onerror)this.onerror=this.onerror?callBoth(onerror,this.onerror):onerror;return res2!==undefined?res2:res}}function hookDeletingChain(f1,f2){if(f1===nop)return f2;return function(){f1.apply(this,arguments);var onsuccess=this.onsuccess,onerror=this.onerror;this.onsuccess=this.onerror=null;f2.apply(this,arguments);if(onsuccess)this.onsuccess=this.onsuccess?callBoth(onsuccess,this.onsuccess):onsuccess;if(onerror)this.onerror=this.onerror?callBoth(onerror,this.onerror):onerror}}function hookUpdatingChain(f1,f2){if(f1===nop)return f2;return function(modifications){var res=f1.apply(this,arguments);extend(modifications,res);var onsuccess=this.onsuccess,onerror=this.onerror;this.onsuccess=null;this.onerror=null;var res2=f2.apply(this,arguments);if(onsuccess)this.onsuccess=this.onsuccess?callBoth(onsuccess,this.onsuccess):onsuccess;if(onerror)this.onerror=this.onerror?callBoth(onerror,this.onerror):onerror;return res===undefined?res2===undefined?undefined:res2:extend(res,res2)}}function reverseStoppableEventChain(f1,f2){if(f1===nop)return f2;return function(){if(f2.apply(this,arguments)===false)return false;return f1.apply(this,arguments)}}function promisableChain(f1,f2){if(f1===nop)return f2;return function(){var res=f1.apply(this,arguments);if(res&&typeof res.then==="function"){var thiz=this,i=arguments.length,args=new Array(i);while(i--)args[i]=arguments[i];return res.then(function(){return f2.apply(thiz,args)})}return f2.apply(this,arguments)}}var INTERNAL={};var LONG_STACKS_CLIP_LIMIT=100;var MAX_LONG_STACKS=20;var ZONE_ECHO_LIMIT=7;var nativePromiseInstanceAndProto=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(e){var P=_global.Promise;return P?[P.resolve(),P.prototype,P.resolve()]:[]}}();var resolvedNativePromise=nativePromiseInstanceAndProto[0];var nativePromiseProto=nativePromiseInstanceAndProto[1];var resolvedGlobalPromise=nativePromiseInstanceAndProto[2];var nativePromiseThen=nativePromiseProto&&nativePromiseProto.then;var NativePromise=resolvedNativePromise&&resolvedNativePromise.constructor;var AsyncFunction=nativePromiseInstanceAndProto[3];var patchGlobalPromise=!!resolvedGlobalPromise;var stack_being_generated=false;var schedulePhysicalTick=resolvedGlobalPromise?function(){resolvedGlobalPromise.then(physicalTick)}:_global.setImmediate?setImmediate.bind(null,physicalTick):_global.MutationObserver?function(){var hiddenDiv=document.createElement("div");new MutationObserver(function(){physicalTick();hiddenDiv=null}).observe(hiddenDiv,{attributes:true});hiddenDiv.setAttribute("i","1")}:function(){setTimeout(physicalTick,0)};var asap$1=function(callback,args){microtickQueue.push([callback,args]);if(needsNewPhysicalTick){schedulePhysicalTick();needsNewPhysicalTick=false}};var isOutsideMicroTick=true;var needsNewPhysicalTick=true;var unhandledErrors=[];var rejectingErrors=[];var currentFulfiller=null;var rejectionMapper=mirror;var globalPSD={id:"global",global:true,ref:0,unhandleds:[],onunhandled:globalError,pgp:false,env:{},finalize:function(){this.unhandleds.forEach(function(uh){try{globalError(uh[0],uh[1])}catch(e){}})}};var PSD=globalPSD;var microtickQueue=[];var numScheduledCalls=0;var tickFinalizers=[];function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");this._listeners=[];this.onuncatched=nop;this._lib=false;var psd=this._PSD=PSD;if(debug){this._stackHolder=getErrorWithStack();this._prev=null;this._numPrev=0}if(typeof fn!=="function"){if(fn!==INTERNAL)throw new TypeError("Not a function");this._state=arguments[1];this._value=arguments[2];if(this._state===false)handleRejection(this,this._value);return}this._state=null;this._value=null;++psd.ref;executePromiseTask(this,fn)}var thenProp={get:function(){var psd=PSD,microTaskId=totalEchoes;function then(onFulfilled,onRejected){var _this=this;var possibleAwait=!psd.global&&(psd!==PSD||microTaskId!==totalEchoes);if(possibleAwait)decrementExpectedAwaits();var rv=new Promise(function(resolve,reject){propagateToListener(_this,new Listener(nativeAwaitCompatibleWrap(onFulfilled,psd,possibleAwait),nativeAwaitCompatibleWrap(onRejected,psd,possibleAwait),resolve,reject,psd))});debug&&linkToPreviousPromise(rv,this);return rv}then.prototype=INTERNAL;return then},set:function(value){setProp(this,"then",value&&value.prototype===INTERNAL?thenProp:{get:function(){return value},set:thenProp.set})}};props(Promise.prototype,{then:thenProp,_then:function(onFulfilled,onRejected){propagateToListener(this,new Listener(null,null,onFulfilled,onRejected,PSD))},catch:function(onRejected){if(arguments.length===1)return this.then(null,onRejected);var type=arguments[0],handler=arguments[1];return typeof type==="function"?this.then(null,function(err){return err instanceof type?handler(err):PromiseReject(err)}):this.then(null,function(err){return err&&err.name===type?handler(err):PromiseReject(err)})},finally:function(onFinally){return this.then(function(value){onFinally();return value},function(err){onFinally();return PromiseReject(err)})},stack:{get:function(){if(this._stack)return this._stack;try{stack_being_generated=true;var stacks=getStack(this,[],MAX_LONG_STACKS);var stack=stacks.join("\nFrom previous: ");if(this._state!==null)this._stack=stack;return stack}finally{stack_being_generated=false}}},timeout:function(ms,msg){var _this=this;return ms<Infinity?new Promise(function(resolve,reject){var handle=setTimeout(function(){return reject(new exceptions.Timeout(msg))},ms);_this.then(resolve,reject).finally(clearTimeout.bind(null,handle))}):this}});if(typeof Symbol!=="undefined"&&Symbol.toStringTag)setProp(Promise.prototype,Symbol.toStringTag,"Promise");globalPSD.env=snapShot();function Listener(onFulfilled,onRejected,resolve,reject,zone){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.resolve=resolve;this.reject=reject;this.psd=zone}props(Promise,{all:function(){var values=getArrayOf.apply(null,arguments).map(onPossibleParallellAsync);return new Promise(function(resolve,reject){if(values.length===0)resolve([]);var remaining=values.length;values.forEach(function(a,i){return Promise.resolve(a).then(function(x){values[i]=x;if(!--remaining)resolve(values)},reject)})})},resolve:function(value){if(value instanceof Promise)return value;if(value&&typeof value.then==="function")return new Promise(function(resolve,reject){value.then(resolve,reject)});var rv=new Promise(INTERNAL,true,value);linkToPreviousPromise(rv,currentFulfiller);return rv},reject:PromiseReject,race:function(){var values=getArrayOf.apply(null,arguments).map(onPossibleParallellAsync);return new Promise(function(resolve,reject){values.map(function(value){return Promise.resolve(value).then(resolve,reject)})})},PSD:{get:function(){return PSD},set:function(value){return PSD=value}},newPSD:newScope,usePSD:usePSD,scheduler:{get:function(){return asap$1},set:function(value){asap$1=value}},rejectionMapper:{get:function(){return rejectionMapper},set:function(value){rejectionMapper=value}},follow:function(fn,zoneProps){return new Promise(function(resolve,reject){return newScope(function(resolve,reject){var psd=PSD;psd.unhandleds=[];psd.onunhandled=reject;psd.finalize=callBoth(function(){var _this=this;run_at_end_of_this_or_next_physical_tick(function(){_this.unhandleds.length===0?resolve():reject(_this.unhandleds[0])})},psd.finalize);fn()},zoneProps,resolve,reject)})}});function executePromiseTask(promise,fn){try{fn(function(value){if(promise._state!==null)return;if(value===promise)throw new TypeError("A promise cannot be resolved with itself.");var shouldExecuteTick=promise._lib&&beginMicroTickScope();if(value&&typeof value.then==="function"){executePromiseTask(promise,function(resolve,reject){value instanceof Promise?value._then(resolve,reject):value.then(resolve,reject)})}else{promise._state=true;promise._value=value;propagateAllListeners(promise)}if(shouldExecuteTick)endMicroTickScope()},handleRejection.bind(null,promise))}catch(ex){handleRejection(promise,ex)}}function handleRejection(promise,reason){rejectingErrors.push(reason);if(promise._state!==null)return;var shouldExecuteTick=promise._lib&&beginMicroTickScope();reason=rejectionMapper(reason);promise._state=false;promise._value=reason;debug&&reason!==null&&typeof reason==="object"&&!reason._promise&&tryCatch(function(){var origProp=getPropertyDescriptor(reason,"stack");reason._promise=promise;setProp(reason,"stack",{get:function(){return stack_being_generated?origProp&&(origProp.get?origProp.get.apply(reason):origProp.value):promise.stack}})});addPossiblyUnhandledError(promise);propagateAllListeners(promise);if(shouldExecuteTick)endMicroTickScope()}function propagateAllListeners(promise){var listeners=promise._listeners;promise._listeners=[];for(var i=0,len=listeners.length;i<len;++i){propagateToListener(promise,listeners[i])}var psd=promise._PSD;--psd.ref||psd.finalize();if(numScheduledCalls===0){++numScheduledCalls;asap$1(function(){if(--numScheduledCalls===0)finalizePhysicalTick()},[])}}function propagateToListener(promise,listener){if(promise._state===null){promise._listeners.push(listener);return}var cb=promise._state?listener.onFulfilled:listener.onRejected;if(cb===null){return(promise._state?listener.resolve:listener.reject)(promise._value)}++listener.psd.ref;++numScheduledCalls;asap$1(callListener,[cb,promise,listener])}function callListener(cb,promise,listener){try{currentFulfiller=promise;var ret,value=promise._value;if(promise._state){ret=cb(value)}else{if(rejectingErrors.length)rejectingErrors=[];ret=cb(value);if(rejectingErrors.indexOf(value)===-1)markErrorAsHandled(promise)}listener.resolve(ret)}catch(e){listener.reject(e)}finally{currentFulfiller=null;if(--numScheduledCalls===0)finalizePhysicalTick();--listener.psd.ref||listener.psd.finalize()}}function getStack(promise,stacks,limit){if(stacks.length===limit)return stacks;var stack="";if(promise._state===false){var failure=promise._value,errorName,message;if(failure!=null){errorName=failure.name||"Error";message=failure.message||failure;stack=prettyStack(failure,0)}else{errorName=failure;message=""}stacks.push(errorName+(message?": "+message:"")+stack)}if(debug){stack=prettyStack(promise._stackHolder,2);if(stack&&stacks.indexOf(stack)===-1)stacks.push(stack);if(promise._prev)getStack(promise._prev,stacks,limit)}return stacks}function linkToPreviousPromise(promise,prev){var numPrev=prev?prev._numPrev+1:0;if(numPrev<LONG_STACKS_CLIP_LIMIT){promise._prev=prev;promise._numPrev=numPrev}}function physicalTick(){beginMicroTickScope()&&endMicroTickScope()}function beginMicroTickScope(){var wasRootExec=isOutsideMicroTick;isOutsideMicroTick=false;needsNewPhysicalTick=false;return wasRootExec}function endMicroTickScope(){var callbacks,i,l;do{while(microtickQueue.length>0){callbacks=microtickQueue;microtickQueue=[];l=callbacks.length;for(i=0;i<l;++i){var item=callbacks[i];item[0].apply(null,item[1])}}}while(microtickQueue.length>0);isOutsideMicroTick=true;needsNewPhysicalTick=true}function finalizePhysicalTick(){var unhandledErrs=unhandledErrors;unhandledErrors=[];unhandledErrs.forEach(function(p){p._PSD.onunhandled.call(null,p._value,p)});var finalizers=tickFinalizers.slice(0);var i=finalizers.length;while(i)finalizers[--i]()}function run_at_end_of_this_or_next_physical_tick(fn){function finalizer(){fn();tickFinalizers.splice(tickFinalizers.indexOf(finalizer),1)}tickFinalizers.push(finalizer);++numScheduledCalls;asap$1(function(){if(--numScheduledCalls===0)finalizePhysicalTick()},[])}function addPossiblyUnhandledError(promise){if(!unhandledErrors.some(function(p){return p._value===promise._value}))unhandledErrors.push(promise)}function markErrorAsHandled(promise){var i=unhandledErrors.length;while(i)if(unhandledErrors[--i]._value===promise._value){unhandledErrors.splice(i,1);return}}function PromiseReject(reason){return new Promise(INTERNAL,false,reason)}function wrap(fn,errorCatcher){var psd=PSD;return function(){var wasRootExec=beginMicroTickScope(),outerScope=PSD;try{switchToZone(psd,true);return fn.apply(this,arguments)}catch(e){errorCatcher&&errorCatcher(e)}finally{switchToZone(outerScope,false);if(wasRootExec)endMicroTickScope()}}}var task={awaits:0,echoes:0,id:0};var taskCounter=0;var zoneStack=[];var zoneEchoes=0;var totalEchoes=0;var zone_id_counter=0;function newScope(fn,props$$1,a1,a2){var parent=PSD,psd=Object.create(parent);psd.parent=parent;psd.ref=0;psd.global=false;psd.id=++zone_id_counter;var globalEnv=globalPSD.env;psd.env=patchGlobalPromise?{Promise:Promise,PromiseProp:{value:Promise,configurable:true,writable:true},all:Promise.all,race:Promise.race,resolve:Promise.resolve,reject:Promise.reject,nthen:getPatchedPromiseThen(globalEnv.nthen,psd),gthen:getPatchedPromiseThen(globalEnv.gthen,psd)}:{};if(props$$1)extend(psd,props$$1);++parent.ref;psd.finalize=function(){--this.parent.ref||this.parent.finalize()};var rv=usePSD(psd,fn,a1,a2);if(psd.ref===0)psd.finalize();return rv}function incrementExpectedAwaits(){if(!task.id)task.id=++taskCounter;++task.awaits;task.echoes+=ZONE_ECHO_LIMIT;return task.id}function decrementExpectedAwaits(sourceTaskId){if(!task.awaits||sourceTaskId&&sourceTaskId!==task.id)return;if(--task.awaits===0)task.id=0;task.echoes=task.awaits*ZONE_ECHO_LIMIT}function onPossibleParallellAsync(possiblePromise){if(task.echoes&&possiblePromise&&possiblePromise.constructor===NativePromise){incrementExpectedAwaits();return possiblePromise.then(function(x){decrementExpectedAwaits();return x},function(e){decrementExpectedAwaits();return rejection(e)})}return possiblePromise}function zoneEnterEcho(targetZone){++totalEchoes;if(!task.echoes||--task.echoes===0){task.echoes=task.id=0}zoneStack.push(PSD);switchToZone(targetZone,true)}function zoneLeaveEcho(){var zone=zoneStack[zoneStack.length-1];zoneStack.pop();switchToZone(zone,false)}function switchToZone(targetZone,bEnteringZone){var currentZone=PSD;if(bEnteringZone?task.echoes&&(!zoneEchoes++||targetZone!==PSD):zoneEchoes&&(!--zoneEchoes||targetZone!==PSD)){enqueueNativeMicroTask(bEnteringZone?zoneEnterEcho.bind(null,targetZone):zoneLeaveEcho)}if(targetZone===PSD)return;PSD=targetZone;if(currentZone===globalPSD)globalPSD.env=snapShot();if(patchGlobalPromise){var GlobalPromise=globalPSD.env.Promise;var targetEnv=targetZone.env;nativePromiseProto.then=targetEnv.nthen;GlobalPromise.prototype.then=targetEnv.gthen;if(currentZone.global||targetZone.global){Object.defineProperty(_global,"Promise",targetEnv.PromiseProp);GlobalPromise.all=targetEnv.all;GlobalPromise.race=targetEnv.race;GlobalPromise.resolve=targetEnv.resolve;GlobalPromise.reject=targetEnv.reject}}}function snapShot(){var GlobalPromise=_global.Promise;return patchGlobalPromise?{Promise:GlobalPromise,PromiseProp:Object.getOwnPropertyDescriptor(_global,"Promise"),all:GlobalPromise.all,race:GlobalPromise.race,resolve:GlobalPromise.resolve,reject:GlobalPromise.reject,nthen:nativePromiseProto.then,gthen:GlobalPromise.prototype.then}:{}}function usePSD(psd,fn,a1,a2,a3){var outerScope=PSD;try{switchToZone(psd,true);return fn(a1,a2,a3)}finally{switchToZone(outerScope,false)}}function enqueueNativeMicroTask(job){nativePromiseThen.call(resolvedNativePromise,job)}function nativeAwaitCompatibleWrap(fn,zone,possibleAwait){return typeof fn!=="function"?fn:function(){var outerZone=PSD;if(possibleAwait)incrementExpectedAwaits();switchToZone(zone,true);try{return fn.apply(this,arguments)}finally{switchToZone(outerZone,false)}}}function getPatchedPromiseThen(origThen,zone){return function(onResolved,onRejected){return origThen.call(this,nativeAwaitCompatibleWrap(onResolved,zone,false),nativeAwaitCompatibleWrap(onRejected,zone,false))}}var UNHANDLEDREJECTION="unhandledrejection";function globalError(err,promise){var rv;try{rv=promise.onuncatched(err)}catch(e){}if(rv!==false)try{var event,eventData={promise:promise,reason:err};if(_global.document&&document.createEvent){event=document.createEvent("Event");event.initEvent(UNHANDLEDREJECTION,true,true);extend(event,eventData)}else if(_global.CustomEvent){event=new CustomEvent(UNHANDLEDREJECTION,{detail:eventData});extend(event,eventData)}if(event&&_global.dispatchEvent){dispatchEvent(event);if(!_global.PromiseRejectionEvent&&_global.onunhandledrejection)try{_global.onunhandledrejection(event)}catch(_){}}if(!event.defaultPrevented){console.warn("Unhandled rejection: "+(err.stack||err))}}catch(e){}}var rejection=Promise.reject;function Events(ctx){var evs={};var rv=function(eventName,subscriber){if(subscriber){var i=arguments.length,args=new Array(i-1);while(--i)args[i-1]=arguments[i];evs[eventName].subscribe.apply(null,args);return ctx}else if(typeof eventName==="string"){return evs[eventName]}};rv.addEventType=add;for(var i=1,l=arguments.length;i<l;++i){add(arguments[i])}return rv;function add(eventName,chainFunction,defaultFunction){if(typeof eventName==="object")return addConfiguredEvents(eventName);if(!chainFunction)chainFunction=reverseStoppableEventChain;if(!defaultFunction)defaultFunction=nop;var context={subscribers:[],fire:defaultFunction,subscribe:function(cb){if(context.subscribers.indexOf(cb)===-1){context.subscribers.push(cb);context.fire=chainFunction(context.fire,cb)}},unsubscribe:function(cb){context.subscribers=context.subscribers.filter(function(fn){return fn!==cb});context.fire=context.subscribers.reduce(chainFunction,defaultFunction)}};evs[eventName]=rv[eventName]=context;return context}function addConfiguredEvents(cfg){keys(cfg).forEach(function(eventName){var args=cfg[eventName];if(isArray(args)){add(eventName,cfg[eventName][0],cfg[eventName][1])}else if(args==="asap"){var context=add(eventName,mirror,function fire(){var i=arguments.length,args=new Array(i);while(i--)args[i]=arguments[i];context.subscribers.forEach(function(fn){asap(function fireEvent(){fn.apply(null,args)})})})}else throw new exceptions.InvalidArgument("Invalid event config")})}}var DEXIE_VERSION="2.0.4";var maxString=String.fromCharCode(65535);var maxKey=function(){try{IDBKeyRange.only([[]]);return[[]]}catch(e){return maxString}}();var minKey=-Infinity;var INVALID_KEY_ARGUMENT="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.";var STRING_EXPECTED="String expected.";var connections=[];var isIEOrEdge=typeof navigator!=="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent);var hasIEDeleteObjectStoreBug=isIEOrEdge;var hangsOnDeleteLargeKeyRange=isIEOrEdge;var dexieStackFrameFilter=function(frame){return!/(dexie\.js|dexie\.min\.js)/.test(frame)};var dbNamesDB;setDebug(debug,dexieStackFrameFilter);function Dexie(dbName,options){var deps=Dexie.dependencies;var opts=extend({addons:Dexie.addons,autoOpen:true,indexedDB:deps.indexedDB,IDBKeyRange:deps.IDBKeyRange},options);var addons=opts.addons,autoOpen=opts.autoOpen,indexedDB=opts.indexedDB,IDBKeyRange=opts.IDBKeyRange;var globalSchema=this._dbSchema={};var versions=[];var dbStoreNames=[];var allTables={};var idbdb=null;var dbOpenError=null;var isBeingOpened=false;var onReadyBeingFired=null;var openComplete=false;var READONLY="readonly",READWRITE="readwrite";var db=this;var dbReadyResolve,dbReadyPromise=new Promise(function(resolve){dbReadyResolve=resolve}),cancelOpen,openCanceller=new Promise(function(_,reject){cancelOpen=reject});var autoSchema=true;var hasNativeGetDatabaseNames=!!getNativeGetDatabaseNamesFn(indexedDB),hasGetAll;function init(){db.on("versionchange",function(ev){if(ev.newVersion>0)console.warn("Another connection wants to upgrade database '"+db.name+"'. Closing db now to resume the upgrade.");else console.warn("Another connection wants to delete database '"+db.name+"'. Closing db now to resume the delete request.");db.close()});db.on("blocked",function(ev){if(!ev.newVersion||ev.newVersion<ev.oldVersion)console.warn("Dexie.delete('"+db.name+"') was blocked");else console.warn("Upgrade '"+db.name+"' blocked by other connection holding version "+ev.oldVersion/10)})}this.version=function(versionNumber){if(idbdb||isBeingOpened)throw new exceptions.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,versionNumber);var versionInstance=versions.filter(function(v){return v._cfg.version===versionNumber})[0];if(versionInstance)return versionInstance;versionInstance=new Version(versionNumber);versions.push(versionInstance);versions.sort(lowerVersionFirst);autoSchema=false;return versionInstance};function Version(versionNumber){this._cfg={version:versionNumber,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}extend(Version.prototype,{stores:function(stores){this._cfg.storesSource=this._cfg.storesSource?extend(this._cfg.storesSource,stores):stores;var storesSpec={};versions.forEach(function(version){extend(storesSpec,version._cfg.storesSource)});var dbschema=this._cfg.dbschema={};this._parseStoresSpec(storesSpec,dbschema);globalSchema=db._dbSchema=dbschema;removeTablesApi([allTables,db,Transaction.prototype]);setApiOnPlace([allTables,db,Transaction.prototype,this._cfg.tables],keys(dbschema),dbschema);dbStoreNames=keys(dbschema);return this},upgrade:function(upgradeFunction){this._cfg.contentUpgrade=upgradeFunction;return this},_parseStoresSpec:function(stores,outSchema){keys(stores).forEach(function(tableName){if(stores[tableName]!==null){var instanceTemplate={};var indexes=parseIndexSyntax(stores[tableName]);var primKey=indexes.shift();if(primKey.multi)throw new exceptions.Schema("Primary key cannot be multi-valued");if(primKey.keyPath)setByKeyPath(instanceTemplate,primKey.keyPath,primKey.auto?0:primKey.keyPath);indexes.forEach(function(idx){if(idx.auto)throw new exceptions.Schema("Only primary key can be marked as autoIncrement (++)");if(!idx.keyPath)throw new exceptions.Schema("Index must have a name and cannot be an empty string");setByKeyPath(instanceTemplate,idx.keyPath,idx.compound?idx.keyPath.map(function(){return""}):"")});outSchema[tableName]=new TableSchema(tableName,primKey,indexes,instanceTemplate)}})}});function runUpgraders(oldVersion,idbtrans,reject){var trans=db._createTransaction(READWRITE,dbStoreNames,globalSchema);trans.create(idbtrans);trans._completion.catch(reject);var rejectTransaction=trans._reject.bind(trans);newScope(function(){PSD.trans=trans;if(oldVersion===0){keys(globalSchema).forEach(function(tableName){createTable(idbtrans,tableName,globalSchema[tableName].primKey,globalSchema[tableName].indexes)});Promise.follow(function(){return db.on.populate.fire(trans)}).catch(rejectTransaction)}else updateTablesAndIndexes(oldVersion,trans,idbtrans).catch(rejectTransaction)})}function updateTablesAndIndexes(oldVersion,trans,idbtrans){var queue=[];var oldVersionStruct=versions.filter(function(version){return version._cfg.version===oldVersion})[0];if(!oldVersionStruct)throw new exceptions.Upgrade("Dexie specification of currently installed DB version is missing");globalSchema=db._dbSchema=oldVersionStruct._cfg.dbschema;var anyContentUpgraderHasRun=false;var versToRun=versions.filter(function(v){return v._cfg.version>oldVersion});versToRun.forEach(function(version){queue.push(function(){var oldSchema=globalSchema;var newSchema=version._cfg.dbschema;adjustToExistingIndexNames(oldSchema,idbtrans);adjustToExistingIndexNames(newSchema,idbtrans);globalSchema=db._dbSchema=newSchema;var diff=getSchemaDiff(oldSchema,newSchema);diff.add.forEach(function(tuple){createTable(idbtrans,tuple[0],tuple[1].primKey,tuple[1].indexes)});diff.change.forEach(function(change){if(change.recreate){throw new exceptions.Upgrade("Not yet support for changing primary key")}else{var store=idbtrans.objectStore(change.name);change.add.forEach(function(idx){addIndex(store,idx)});change.change.forEach(function(idx){store.deleteIndex(idx.name);addIndex(store,idx)});change.del.forEach(function(idxName){store.deleteIndex(idxName)})}});if(version._cfg.contentUpgrade){anyContentUpgraderHasRun=true;return Promise.follow(function(){version._cfg.contentUpgrade(trans)})}});queue.push(function(idbtrans){if(!anyContentUpgraderHasRun||!hasIEDeleteObjectStoreBug){var newSchema=version._cfg.dbschema;deleteRemovedTables(newSchema,idbtrans)}})});function runQueue(){return queue.length?Promise.resolve(queue.shift()(trans.idbtrans)).then(runQueue):Promise.resolve()}return runQueue().then(function(){createMissingTables(globalSchema,idbtrans)})}function getSchemaDiff(oldSchema,newSchema){var diff={del:[],add:[],change:[]};for(var table in oldSchema){if(!newSchema[table])diff.del.push(table)}for(table in newSchema){var oldDef=oldSchema[table],newDef=newSchema[table];if(!oldDef){diff.add.push([table,newDef])}else{var change={name:table,def:newDef,recreate:false,del:[],add:[],change:[]};if(oldDef.primKey.src!==newDef.primKey.src){change.recreate=true;diff.change.push(change)}else{var oldIndexes=oldDef.idxByName;var newIndexes=newDef.idxByName;for(var idxName in oldIndexes){if(!newIndexes[idxName])change.del.push(idxName)}for(idxName in newIndexes){var oldIdx=oldIndexes[idxName],newIdx=newIndexes[idxName];if(!oldIdx)change.add.push(newIdx);else if(oldIdx.src!==newIdx.src)change.change.push(newIdx)}if(change.del.length>0||change.add.length>0||change.change.length>0){diff.change.push(change)}}}}return diff}function createTable(idbtrans,tableName,primKey,indexes){var store=idbtrans.db.createObjectStore(tableName,primKey.keyPath?{keyPath:primKey.keyPath,autoIncrement:primKey.auto}:{autoIncrement:primKey.auto});indexes.forEach(function(idx){addIndex(store,idx)});return store}function createMissingTables(newSchema,idbtrans){keys(newSchema).forEach(function(tableName){if(!idbtrans.db.objectStoreNames.contains(tableName)){createTable(idbtrans,tableName,newSchema[tableName].primKey,newSchema[tableName].indexes)}})}function deleteRemovedTables(newSchema,idbtrans){for(var i=0;i<idbtrans.db.objectStoreNames.length;++i){var storeName=idbtrans.db.objectStoreNames[i];if(newSchema[storeName]==null){idbtrans.db.deleteObjectStore(storeName)}}}function addIndex(store,idx){store.createIndex(idx.name,idx.keyPath,{unique:idx.unique,multiEntry:idx.multi})}this._allTables=allTables;this._createTransaction=function(mode,storeNames,dbschema,parentTransaction){return new Transaction(mode,storeNames,dbschema,parentTransaction)};function tempTransaction(mode,storeNames,fn){if(!openComplete&&!PSD.letThrough){if(!isBeingOpened){if(!autoOpen)return rejection(new exceptions.DatabaseClosed);db.open().catch(nop)}return dbReadyPromise.then(function(){return tempTransaction(mode,storeNames,fn)})}else{var trans=db._createTransaction(mode,storeNames,globalSchema);try{trans.create()}catch(ex){return rejection(ex)}return trans._promise(mode,function(resolve,reject){return newScope(function(){PSD.trans=trans;return fn(resolve,reject,trans)})}).then(function(result){return trans._completion.then(function(){return result})})}}this._whenReady=function(fn){return openComplete||PSD.letThrough?fn():new Promise(function(resolve,reject){if(!isBeingOpened){if(!autoOpen){reject(new exceptions.DatabaseClosed);return}db.open().catch(nop)}dbReadyPromise.then(resolve,reject)}).then(fn)};this.verno=0;this.open=function(){if(isBeingOpened||idbdb)return dbReadyPromise.then(function(){return dbOpenError?rejection(dbOpenError):db});debug&&(openCanceller._stackHolder=getErrorWithStack());isBeingOpened=true;dbOpenError=null;openComplete=false;var resolveDbReady=dbReadyResolve,upgradeTransaction=null;return Promise.race([openCanceller,new Promise(function(resolve,reject){if(!indexedDB)throw new exceptions.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL "+"(not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var req=autoSchema?indexedDB.open(dbName):indexedDB.open(dbName,Math.round(db.verno*10));if(!req)throw new exceptions.MissingAPI("IndexedDB API not available");req.onerror=eventRejectHandler(reject);req.onblocked=wrap(fireOnBlocked);req.onupgradeneeded=wrap(function(e){upgradeTransaction=req.transaction;if(autoSchema&&!db._allowEmptyDB){req.onerror=preventDefault;upgradeTransaction.abort();req.result.close();var delreq=indexedDB.deleteDatabase(dbName);delreq.onsuccess=delreq.onerror=wrap(function(){reject(new exceptions.NoSuchDatabase("Database "+dbName+" doesnt exist"))})}else{upgradeTransaction.onerror=eventRejectHandler(reject);var oldVer=e.oldVersion>Math.pow(2,62)?0:e.oldVersion;runUpgraders(oldVer/10,upgradeTransaction,reject,req)}},reject);req.onsuccess=wrap(function(){upgradeTransaction=null;idbdb=req.result;connections.push(db);if(autoSchema)readGlobalSchema();else if(idbdb.objectStoreNames.length>0){try{adjustToExistingIndexNames(globalSchema,idbdb.transaction(safariMultiStoreFix(idbdb.objectStoreNames),READONLY))}catch(e){}}idbdb.onversionchange=wrap(function(ev){db._vcFired=true;db.on("versionchange").fire(ev)});if(!hasNativeGetDatabaseNames&&dbName!=="__dbnames"){dbNamesDB.dbnames.put({name:dbName}).catch(nop)}resolve()},reject)})]).then(function(){onReadyBeingFired=[];return Promise.resolve(Dexie.vip(db.on.ready.fire)).then(function fireRemainders(){if(onReadyBeingFired.length>0){var remainders=onReadyBeingFired.reduce(promisableChain,nop);onReadyBeingFired=[];return Promise.resolve(Dexie.vip(remainders)).then(fireRemainders)}})}).finally(function(){onReadyBeingFired=null}).then(function(){isBeingOpened=false;return db}).catch(function(err){try{upgradeTransaction&&upgradeTransaction.abort()}catch(e){}isBeingOpened=false;db.close();dbOpenError=err;return rejection(dbOpenError)}).finally(function(){openComplete=true;resolveDbReady()})};this.close=function(){var idx=connections.indexOf(db);if(idx>=0)connections.splice(idx,1);if(idbdb){try{idbdb.close()}catch(e){}idbdb=null}autoOpen=false;dbOpenError=new exceptions.DatabaseClosed;if(isBeingOpened)cancelOpen(dbOpenError);dbReadyPromise=new Promise(function(resolve){dbReadyResolve=resolve});openCanceller=new Promise(function(_,reject){cancelOpen=reject})};this.delete=function(){var hasArguments=arguments.length>0;return new Promise(function(resolve,reject){if(hasArguments)throw new exceptions.InvalidArgument("Arguments not allowed in db.delete()");if(isBeingOpened){dbReadyPromise.then(doDelete)}else{doDelete()}function doDelete(){db.close();var req=indexedDB.deleteDatabase(dbName);req.onsuccess=wrap(function(){if(!hasNativeGetDatabaseNames){dbNamesDB.dbnames.delete(dbName).catch(nop)}resolve()});req.onerror=eventRejectHandler(reject);req.onblocked=fireOnBlocked}})};this.backendDB=function(){return idbdb};this.isOpen=function(){return idbdb!==null};this.hasBeenClosed=function(){return dbOpenError&&dbOpenError instanceof exceptions.DatabaseClosed};this.hasFailed=function(){return dbOpenError!==null};this.dynamicallyOpened=function(){return autoSchema};this.name=dbName;props(this,{tables:{get:function(){return keys(allTables).map(function(name){return allTables[name]})}}});this.on=Events(this,"populate","blocked","versionchange",{ready:[promisableChain,nop]});this.on.ready.subscribe=override(this.on.ready.subscribe,function(subscribe){return function(subscriber,bSticky){Dexie.vip(function(){if(openComplete){if(!dbOpenError)Promise.resolve().then(subscriber);if(bSticky)subscribe(subscriber)}else if(onReadyBeingFired){onReadyBeingFired.push(subscriber);if(bSticky)subscribe(subscriber)}else{subscribe(subscriber);if(!bSticky)subscribe(function unsubscribe(){db.on.ready.unsubscribe(subscriber);db.on.ready.unsubscribe(unsubscribe)})}})}});this.transaction=function(){var args=extractTransactionArgs.apply(this,arguments);return this._transaction.apply(this,args)};function extractTransactionArgs(mode,_tableArgs_,scopeFunc){var i=arguments.length;if(i<2)throw new exceptions.InvalidArgument("Too few arguments");var args=new Array(i-1);while(--i)args[i-1]=arguments[i];scopeFunc=args.pop();var tables=flatten(args);return[mode,tables,scopeFunc]}this._transaction=function(mode,tables,scopeFunc){var parentTransaction=PSD.trans;if(!parentTransaction||parentTransaction.db!==db||mode.indexOf("!")!==-1)parentTransaction=null;var onlyIfCompatible=mode.indexOf("?")!==-1;mode=mode.replace("!","").replace("?","");try{var storeNames=tables.map(function(table){var storeName=table instanceof Table?table.name:table;if(typeof storeName!=="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return storeName});if(mode=="r"||mode==READONLY)mode=READONLY;else if(mode=="rw"||mode==READWRITE)mode=READWRITE;else throw new exceptions.InvalidArgument("Invalid transaction mode: "+mode);if(parentTransaction){if(parentTransaction.mode===READONLY&&mode===READWRITE){if(onlyIfCompatible){parentTransaction=null}else throw new exceptions.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")}if(parentTransaction){storeNames.forEach(function(storeName){if(parentTransaction&&parentTransaction.storeNames.indexOf(storeName)===-1){if(onlyIfCompatible){parentTransaction=null}else throw new exceptions.SubTransaction("Table "+storeName+" not included in parent transaction.")}})}if(onlyIfCompatible&&parentTransaction&&!parentTransaction.active){parentTransaction=null}}}catch(e){return parentTransaction?parentTransaction._promise(null,function(_,reject){reject(e)}):rejection(e)}return parentTransaction?parentTransaction._promise(mode,enterTransactionScope,"lock"):PSD.trans?usePSD(PSD.transless,function(){return db._whenReady(enterTransactionScope)}):db._whenReady(enterTransactionScope);function enterTransactionScope(){return Promise.resolve().then(function(){var transless=PSD.transless||PSD;var trans=db._createTransaction(mode,storeNames,globalSchema,parentTransaction);var zoneProps={trans:trans,transless:transless};if(parentTransaction){trans.idbtrans=parentTransaction.idbtrans}else{trans.create()}if(scopeFunc.constructor===AsyncFunction){incrementExpectedAwaits()}var returnValue;var promiseFollowed=Promise.follow(function(){returnValue=scopeFunc.call(trans,trans);if(returnValue){if(returnValue.constructor===NativePromise){var decrementor=decrementExpectedAwaits.bind(null,null);returnValue.then(decrementor,decrementor)}else if(typeof returnValue.next==="function"&&typeof returnValue.throw==="function"){returnValue=awaitIterator(returnValue)}}},zoneProps);return(returnValue&&typeof returnValue.then==="function"?Promise.resolve(returnValue).then(function(x){return trans.active?x:rejection(new exceptions.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):promiseFollowed.then(function(){return returnValue})).then(function(x){if(parentTransaction)trans._resolve();return trans._completion.then(function(){return x})}).catch(function(e){trans._reject(e);return rejection(e)})})}};this.table=function(tableName){if(!hasOwn(allTables,tableName)){throw new exceptions.InvalidTable("Table "+tableName+" does not exist")}return allTables[tableName]};function Table(name,tableSchema,optionalTrans){this.name=name;this.schema=tableSchema;this._tx=optionalTrans;this.hook=allTables[name]?allTables[name].hook:Events(null,{creating:[hookCreatingChain,nop],reading:[pureFunctionChain,mirror],updating:[hookUpdatingChain,nop],deleting:[hookDeletingChain,nop]})}function BulkErrorHandlerCatchAll(errorList,done,supportHooks){return(supportHooks?hookedEventRejectHandler:eventRejectHandler)(function(e){errorList.push(e);done&&done()})}function bulkDelete(idbstore,trans,keysOrTuples,hasDeleteHook,deletingHook){return new Promise(function(resolve,reject){var len=keysOrTuples.length,lastItem=len-1;if(len===0)return resolve();if(!hasDeleteHook){for(var i=0;i<len;++i){var req=idbstore.delete(keysOrTuples[i]);req.onerror=eventRejectHandler(reject);if(i===lastItem)req.onsuccess=wrap(function(){return resolve()})}}else{var hookCtx,errorHandler=hookedEventRejectHandler(reject),successHandler=hookedEventSuccessHandler(null);tryCatch(function(){for(var i=0;i<len;++i){hookCtx={onsuccess:null,onerror:null};var tuple=keysOrTuples[i];deletingHook.call(hookCtx,tuple[0],tuple[1],trans);var req=idbstore.delete(tuple[0]);req._hookCtx=hookCtx;req.onerror=errorHandler;if(i===lastItem)req.onsuccess=hookedEventSuccessHandler(resolve);else req.onsuccess=successHandler}},function(err){hookCtx.onerror&&hookCtx.onerror(err);throw err})}})}props(Table.prototype,{_trans:function getTransaction(mode,fn,writeLocked){var trans=this._tx||PSD.trans;return trans&&trans.db===db?trans===PSD.trans?trans._promise(mode,fn,writeLocked):newScope(function(){return trans._promise(mode,fn,writeLocked)},{trans:trans,transless:PSD.transless||PSD}):tempTransaction(mode,[this.name],fn)},_idbstore:function getIDBObjectStore(mode,fn,writeLocked){var tableName=this.name;function supplyIdbStore(resolve,reject,trans){if(trans.storeNames.indexOf(tableName)===-1)throw new exceptions.NotFound("Table"+tableName+" not part of transaction");return fn(resolve,reject,trans.idbtrans.objectStore(tableName),trans)}return this._trans(mode,supplyIdbStore,writeLocked)},get:function(keyOrCrit,cb){if(keyOrCrit&&keyOrCrit.constructor===Object)return this.where(keyOrCrit).first(cb);var self=this;return this._idbstore(READONLY,function(resolve,reject,idbstore){var req=idbstore.get(keyOrCrit);req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(){resolve(self.hook.reading.fire(req.result))},reject)}).then(cb)},where:function(indexOrCrit){if(typeof indexOrCrit==="string")return new WhereClause(this,indexOrCrit);if(isArray(indexOrCrit))return new WhereClause(this,"["+indexOrCrit.join("+")+"]");var keyPaths=keys(indexOrCrit);if(keyPaths.length===1)return this.where(keyPaths[0]).equals(indexOrCrit[keyPaths[0]]);var compoundIndex=this.schema.indexes.concat(this.schema.primKey).filter(function(ix){return ix.compound&&keyPaths.every(function(keyPath){return ix.keyPath.indexOf(keyPath)>=0})&&ix.keyPath.every(function(keyPath){return keyPaths.indexOf(keyPath)>=0})})[0];if(compoundIndex&&maxKey!==maxString)return this.where(compoundIndex.name).equals(compoundIndex.keyPath.map(function(kp){return indexOrCrit[kp]}));if(!compoundIndex)console.warn("The query "+JSON.stringify(indexOrCrit)+" on "+this.name+" would benefit of a "+("compound index ["+keyPaths.join("+")+"]"));var idxByName=this.schema.idxByName;var simpleIndex=keyPaths.reduce(function(r,keyPath){return[r[0]||idxByName[keyPath],r[0]||!idxByName[keyPath]?combine(r[1],function(x){return""+getByKeyPath(x,keyPath)==""+indexOrCrit[keyPath]}):r[1]]},[null,null]);var idx=simpleIndex[0];return idx?this.where(idx.name).equals(indexOrCrit[idx.keyPath]).filter(simpleIndex[1]):compoundIndex?this.filter(simpleIndex[1]):this.where(keyPaths).equals("")},count:function(cb){return this.toCollection().count(cb)},offset:function(offset){return this.toCollection().offset(offset)},limit:function(numRows){return this.toCollection().limit(numRows)},reverse:function(){return this.toCollection().reverse()},filter:function(filterFunction){return this.toCollection().and(filterFunction)},each:function(fn){return this.toCollection().each(fn)},toArray:function(cb){return this.toCollection().toArray(cb)},orderBy:function(index){return new Collection(new WhereClause(this,isArray(index)?"["+index.join("+")+"]":index))},toCollection:function(){return new Collection(new WhereClause(this))},mapToClass:function(constructor,structure){this.schema.mappedClass=constructor;var instanceTemplate=Object.create(constructor.prototype);if(structure){applyStructure(instanceTemplate,structure)}this.schema.instanceTemplate=instanceTemplate;var readHook=function(obj){if(!obj)return obj;var res=Object.create(constructor.prototype);for(var m in obj)if(hasOwn(obj,m))try{res[m]=obj[m]}catch(_){}return res};if(this.schema.readHook){this.hook.reading.unsubscribe(this.schema.readHook)}this.schema.readHook=readHook;this.hook("reading",readHook);return constructor},defineClass:function(structure){return this.mapToClass(Dexie.defineClass(structure),structure)},bulkDelete:function(keys$$1){if(this.hook.deleting.fire===nop){return this._idbstore(READWRITE,function(resolve,reject,idbstore,trans){resolve(bulkDelete(idbstore,trans,keys$$1,false,nop))})}else{return this.where(":id").anyOf(keys$$1).delete().then(function(){})}},bulkPut:function(objects,keys$$1){var _this=this;return this._idbstore(READWRITE,function(resolve,reject,idbstore){if(!idbstore.keyPath&&!_this.schema.primKey.auto&&!keys$$1)throw new exceptions.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(idbstore.keyPath&&keys$$1)throw new exceptions.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(keys$$1&&keys$$1.length!==objects.length)throw new exceptions.InvalidArgument("Arguments objects and keys must have the same length");if(objects.length===0)return resolve();var done=function(result){if(errorList.length===0)resolve(result);else reject(new BulkError(_this.name+".bulkPut(): "+errorList.length+" of "+numObjs+" operations failed",errorList))};var req,errorList=[],errorHandler,numObjs=objects.length,table=_this;if(_this.hook.creating.fire===nop&&_this.hook.updating.fire===nop){errorHandler=BulkErrorHandlerCatchAll(errorList);for(var i=0,l=objects.length;i<l;++i){req=keys$$1?idbstore.put(objects[i],keys$$1[i]):idbstore.put(objects[i]);req.onerror=errorHandler}req.onerror=BulkErrorHandlerCatchAll(errorList,done);req.onsuccess=eventSuccessHandler(done)}else{var effectiveKeys=keys$$1||idbstore.keyPath&&objects.map(function(o){return getByKeyPath(o,idbstore.keyPath)});var objectLookup=effectiveKeys&&arrayToObject(effectiveKeys,function(key,i){return key!=null&&[key,objects[i]]});var promise=!effectiveKeys?table.bulkAdd(objects):table.where(":id").anyOf(effectiveKeys.filter(function(key){return key!=null})).modify(function(){this.value=objectLookup[this.primKey];objectLookup[this.primKey]=null}).catch(ModifyError,function(e){errorList=e.failures}).then(function(){var objsToAdd=[],keysToAdd=keys$$1&&[];for(var i=effectiveKeys.length-1;i>=0;--i){var key=effectiveKeys[i];if(key==null||objectLookup[key]){objsToAdd.push(objects[i]);keys$$1&&keysToAdd.push(key);if(key!=null)objectLookup[key]=null}}objsToAdd.reverse();keys$$1&&keysToAdd.reverse();return table.bulkAdd(objsToAdd,keysToAdd)}).then(function(lastAddedKey){var lastEffectiveKey=effectiveKeys[effectiveKeys.length-1];return lastEffectiveKey!=null?lastEffectiveKey:lastAddedKey});promise.then(done).catch(BulkError,function(e){errorList=errorList.concat(e.failures);done()}).catch(reject)}},"locked")},bulkAdd:function(objects,keys$$1){var self=this,creatingHook=this.hook.creating.fire;return this._idbstore(READWRITE,function(resolve,reject,idbstore,trans){if(!idbstore.keyPath&&!self.schema.primKey.auto&&!keys$$1)throw new exceptions.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(idbstore.keyPath&&keys$$1)throw new exceptions.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(keys$$1&&keys$$1.length!==objects.length)throw new exceptions.InvalidArgument("Arguments objects and keys must have the same length");if(objects.length===0)return resolve();function done(result){if(errorList.length===0)resolve(result);else reject(new BulkError(self.name+".bulkAdd(): "+errorList.length+" of "+numObjs+" operations failed",errorList))}var req,errorList=[],errorHandler,successHandler,numObjs=objects.length;if(creatingHook!==nop){var keyPath=idbstore.keyPath,hookCtx;errorHandler=BulkErrorHandlerCatchAll(errorList,null,true);successHandler=hookedEventSuccessHandler(null);tryCatch(function(){for(var i=0,l=objects.length;i<l;++i){hookCtx={onerror:null,onsuccess:null};var key=keys$$1&&keys$$1[i];var obj=objects[i],effectiveKey=keys$$1?key:keyPath?getByKeyPath(obj,keyPath):undefined,keyToUse=creatingHook.call(hookCtx,effectiveKey,obj,trans);if(effectiveKey==null&&keyToUse!=null){if(keyPath){obj=deepClone(obj);setByKeyPath(obj,keyPath,keyToUse)}else{key=keyToUse}}req=key!=null?idbstore.add(obj,key):idbstore.add(obj);req._hookCtx=hookCtx;if(i<l-1){req.onerror=errorHandler;if(hookCtx.onsuccess)req.onsuccess=successHandler}}},function(err){hookCtx.onerror&&hookCtx.onerror(err);throw err});req.onerror=BulkErrorHandlerCatchAll(errorList,done,true);req.onsuccess=hookedEventSuccessHandler(done)}else{errorHandler=BulkErrorHandlerCatchAll(errorList);for(var i=0,l=objects.length;i<l;++i){req=keys$$1?idbstore.add(objects[i],keys$$1[i]):idbstore.add(objects[i]);req.onerror=errorHandler}req.onerror=BulkErrorHandlerCatchAll(errorList,done);req.onsuccess=eventSuccessHandler(done)}})},add:function(obj,key){var creatingHook=this.hook.creating.fire;return this._idbstore(READWRITE,function(resolve,reject,idbstore,trans){var hookCtx={onsuccess:null,onerror:null};if(creatingHook!==nop){var effectiveKey=key!=null?key:idbstore.keyPath?getByKeyPath(obj,idbstore.keyPath):undefined;var keyToUse=creatingHook.call(hookCtx,effectiveKey,obj,trans);if(effectiveKey==null&&keyToUse!=null){if(idbstore.keyPath)setByKeyPath(obj,idbstore.keyPath,keyToUse);else key=keyToUse}}try{var req=key!=null?idbstore.add(obj,key):idbstore.add(obj);req._hookCtx=hookCtx;req.onerror=hookedEventRejectHandler(reject);req.onsuccess=hookedEventSuccessHandler(function(result){var keyPath=idbstore.keyPath;if(keyPath)setByKeyPath(obj,keyPath,result);resolve(result)})}catch(e){if(hookCtx.onerror)hookCtx.onerror(e);throw e}})},put:function(obj,key){var _this=this;var creatingHook=this.hook.creating.fire,updatingHook=this.hook.updating.fire;if(creatingHook!==nop||updatingHook!==nop){var keyPath=this.schema.primKey.keyPath;var effectiveKey=key!==undefined?key:keyPath&&getByKeyPath(obj,keyPath);if(effectiveKey==null)return this.add(obj);obj=deepClone(obj);return this._trans(READWRITE,function(){return _this.where(":id").equals(effectiveKey).modify(function(){this.value=obj}).then(function(count){return count===0?_this.add(obj,key):effectiveKey})},"locked")}else{return this._idbstore(READWRITE,function(resolve,reject,idbstore){var req=key!==undefined?idbstore.put(obj,key):idbstore.put(obj);req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(ev){var keyPath=idbstore.keyPath;if(keyPath)setByKeyPath(obj,keyPath,ev.target.result);resolve(req.result)})})}},delete:function(key){if(this.hook.deleting.subscribers.length){return this.where(":id").equals(key).delete()}else{return this._idbstore(READWRITE,function(resolve,reject,idbstore){var req=idbstore.delete(key);req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(){resolve(req.result)})})}},clear:function(){if(this.hook.deleting.subscribers.length){return this.toCollection().delete()}else{return this._idbstore(READWRITE,function(resolve,reject,idbstore){var req=idbstore.clear();req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(){resolve(req.result)})})}},update:function(keyOrObject,modifications){if(typeof modifications!=="object"||isArray(modifications))throw new exceptions.InvalidArgument("Modifications must be an object.");if(typeof keyOrObject==="object"&&!isArray(keyOrObject)){keys(modifications).forEach(function(keyPath){setByKeyPath(keyOrObject,keyPath,modifications[keyPath])});var key=getByKeyPath(keyOrObject,this.schema.primKey.keyPath);if(key===undefined)return rejection(new exceptions.InvalidArgument("Given object does not contain its primary key"));return this.where(":id").equals(key).modify(modifications)}else{return this.where(":id").equals(keyOrObject).modify(modifications)}}});function Transaction(mode,storeNames,dbschema,parent){var _this=this;this.db=db;this.mode=mode;this.storeNames=storeNames;this.idbtrans=null;this.on=Events(this,"complete","error","abort");this.parent=parent||null;this.active=true;this._reculock=0;this._blockedFuncs=[];this._resolve=null;this._reject=null;this._waitingFor=null;this._waitingQueue=null;this._spinCount=0;this._completion=new Promise(function(resolve,reject){_this._resolve=resolve;_this._reject=reject});this._completion.then(function(){_this.active=false;_this.on.complete.fire()},function(e){var wasActive=_this.active;_this.active=false;_this.on.error.fire(e);_this.parent?_this.parent._reject(e):wasActive&&_this.idbtrans&&_this.idbtrans.abort();return rejection(e)})}props(Transaction.prototype,{_lock:function(){assert(!PSD.global);++this._reculock;if(this._reculock===1&&!PSD.global)PSD.lockOwnerFor=this;return this},_unlock:function(){assert(!PSD.global);if(--this._reculock===0){if(!PSD.global)PSD.lockOwnerFor=null;while(this._blockedFuncs.length>0&&!this._locked()){var fnAndPSD=this._blockedFuncs.shift();try{usePSD(fnAndPSD[1],fnAndPSD[0])}catch(e){}}}return this},_locked:function(){return this._reculock&&PSD.lockOwnerFor!==this},create:function(idbtrans){var _this=this;if(!this.mode)return this;assert(!this.idbtrans);if(!idbtrans&&!idbdb){switch(dbOpenError&&dbOpenError.name){case"DatabaseClosedError":throw new exceptions.DatabaseClosed(dbOpenError);case"MissingAPIError":throw new exceptions.MissingAPI(dbOpenError.message,dbOpenError);default:throw new exceptions.OpenFailed(dbOpenError)}}if(!this.active)throw new exceptions.TransactionInactive;assert(this._completion._state===null);idbtrans=this.idbtrans=idbtrans||idbdb.transaction(safariMultiStoreFix(this.storeNames),this.mode);idbtrans.onerror=wrap(function(ev){preventDefault(ev);_this._reject(idbtrans.error)});idbtrans.onabort=wrap(function(ev){preventDefault(ev);_this.active&&_this._reject(new exceptions.Abort(idbtrans.error));_this.active=false;_this.on("abort").fire(ev)});idbtrans.oncomplete=wrap(function(){_this.active=false;_this._resolve()});return this},_promise:function(mode,fn,bWriteLock){var _this=this;if(mode===READWRITE&&this.mode!==READWRITE)return rejection(new exceptions.ReadOnly("Transaction is readonly"));if(!this.active)return rejection(new exceptions.TransactionInactive);if(this._locked()){return new Promise(function(resolve,reject){_this._blockedFuncs.push([function(){_this._promise(mode,fn,bWriteLock).then(resolve,reject)},PSD])})}else if(bWriteLock){return newScope(function(){var p=new Promise(function(resolve,reject){_this._lock();var rv=fn(resolve,reject,_this);if(rv&&rv.then)rv.then(resolve,reject)});p.finally(function(){return _this._unlock()});p._lib=true;return p})}else{var p=new Promise(function(resolve,reject){var rv=fn(resolve,reject,_this);if(rv&&rv.then)rv.then(resolve,reject)});p._lib=true;return p}},_root:function(){return this.parent?this.parent._root():this},waitFor:function(promise){var root=this._root();promise=Promise.resolve(promise);if(root._waitingFor){root._waitingFor=root._waitingFor.then(function(){return promise})}else{root._waitingFor=promise;root._waitingQueue=[];var store=root.idbtrans.objectStore(root.storeNames[0]);(function spin(){++root._spinCount;while(root._waitingQueue.length)root._waitingQueue.shift()();if(root._waitingFor)store.get(-Infinity).onsuccess=spin})()}var currentWaitPromise=root._waitingFor;return new Promise(function(resolve,reject){promise.then(function(res){return root._waitingQueue.push(wrap(resolve.bind(null,res)))},function(err){return root._waitingQueue.push(wrap(reject.bind(null,err)))}).finally(function(){if(root._waitingFor===currentWaitPromise){root._waitingFor=null}})})},abort:function(){this.active&&this._reject(new exceptions.Abort);this.active=false},tables:{get:deprecated("Transaction.tables",function(){return allTables})},table:function(name){var table=db.table(name);return new Table(name,table.schema,this)}});function WhereClause(table,index,orCollection){this._ctx={table:table,index:index===":id"?null:index,or:orCollection}}props(WhereClause.prototype,function(){function fail(collectionOrWhereClause,err,T){var collection=collectionOrWhereClause instanceof WhereClause?new Collection(collectionOrWhereClause):collectionOrWhereClause;collection._ctx.error=T?new T(err):new TypeError(err);return collection}function emptyCollection(whereClause){return new Collection(whereClause,function(){return IDBKeyRange.only("")}).limit(0)}function upperFactory(dir){return dir==="next"?function(s){return s.toUpperCase()}:function(s){return s.toLowerCase()}}function lowerFactory(dir){return dir==="next"?function(s){return s.toLowerCase()}:function(s){return s.toUpperCase()}}function nextCasing(key,lowerKey,upperNeedle,lowerNeedle,cmp,dir){var length=Math.min(key.length,lowerNeedle.length);var llp=-1;for(var i=0;i<length;++i){var lwrKeyChar=lowerKey[i];if(lwrKeyChar!==lowerNeedle[i]){if(cmp(key[i],upperNeedle[i])<0)return key.substr(0,i)+upperNeedle[i]+upperNeedle.substr(i+1);if(cmp(key[i],lowerNeedle[i])<0)return key.substr(0,i)+lowerNeedle[i]+upperNeedle.substr(i+1);if(llp>=0)return key.substr(0,llp)+lowerKey[llp]+upperNeedle.substr(llp+1);return null}if(cmp(key[i],lwrKeyChar)<0)llp=i}if(length<lowerNeedle.length&&dir==="next")return key+upperNeedle.substr(key.length);if(length<key.length&&dir==="prev")return key.substr(0,upperNeedle.length);return llp<0?null:key.substr(0,llp)+lowerNeedle[llp]+upperNeedle.substr(llp+1)}function addIgnoreCaseAlgorithm(whereClause,match,needles,suffix){var upper,lower,compare,upperNeedles,lowerNeedles,direction,nextKeySuffix,needlesLen=needles.length;if(!needles.every(function(s){return typeof s==="string"})){return fail(whereClause,STRING_EXPECTED)}function initDirection(dir){upper=upperFactory(dir);lower=lowerFactory(dir);compare=dir==="next"?simpleCompare:simpleCompareReverse;var needleBounds=needles.map(function(needle){return{lower:lower(needle),upper:upper(needle)}}).sort(function(a,b){return compare(a.lower,b.lower)});upperNeedles=needleBounds.map(function(nb){return nb.upper});lowerNeedles=needleBounds.map(function(nb){return nb.lower});direction=dir;nextKeySuffix=dir==="next"?"":suffix}initDirection("next");var c=new Collection(whereClause,function(){return IDBKeyRange.bound(upperNeedles[0],lowerNeedles[needlesLen-1]+suffix)});c._ondirectionchange=function(direction){initDirection(direction)};var firstPossibleNeedle=0;c._addAlgorithm(function(cursor,advance,resolve){var key=cursor.key;if(typeof key!=="string")return false;var lowerKey=lower(key);if(match(lowerKey,lowerNeedles,firstPossibleNeedle)){return true}else{var lowestPossibleCasing=null;for(var i=firstPossibleNeedle;i<needlesLen;++i){var casing=nextCasing(key,lowerKey,upperNeedles[i],lowerNeedles[i],compare,direction);if(casing===null&&lowestPossibleCasing===null)firstPossibleNeedle=i+1;else if(lowestPossibleCasing===null||compare(lowestPossibleCasing,casing)>0){lowestPossibleCasing=casing}}if(lowestPossibleCasing!==null){advance(function(){cursor.continue(lowestPossibleCasing+nextKeySuffix)})}else{advance(resolve)}return false}});return c}return{between:function(lower,upper,includeLower,includeUpper){includeLower=includeLower!==false;includeUpper=includeUpper===true;try{if(cmp(lower,upper)>0||cmp(lower,upper)===0&&(includeLower||includeUpper)&&!(includeLower&&includeUpper))return emptyCollection(this);return new Collection(this,function(){return IDBKeyRange.bound(lower,upper,!includeLower,!includeUpper)})}catch(e){return fail(this,INVALID_KEY_ARGUMENT)}},equals:function(value){return new Collection(this,function(){return IDBKeyRange.only(value)})},above:function(value){return new Collection(this,function(){return IDBKeyRange.lowerBound(value,true)})},aboveOrEqual:function(value){return new Collection(this,function(){return IDBKeyRange.lowerBound(value)})},below:function(value){return new Collection(this,function(){return IDBKeyRange.upperBound(value,true)})},belowOrEqual:function(value){return new Collection(this,function(){return IDBKeyRange.upperBound(value)})},startsWith:function(str){if(typeof str!=="string")return fail(this,STRING_EXPECTED);return this.between(str,str+maxString,true,true)},startsWithIgnoreCase:function(str){if(str==="")return this.startsWith(str);return addIgnoreCaseAlgorithm(this,function(x,a){return x.indexOf(a[0])===0},[str],maxString)},equalsIgnoreCase:function(str){return addIgnoreCaseAlgorithm(this,function(x,a){return x===a[0]},[str],"")},anyOfIgnoreCase:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(set.length===0)return emptyCollection(this);return addIgnoreCaseAlgorithm(this,function(x,a){return a.indexOf(x)!==-1},set,"")},startsWithAnyOfIgnoreCase:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(set.length===0)return emptyCollection(this);return addIgnoreCaseAlgorithm(this,function(x,a){return a.some(function(n){return x.indexOf(n)===0})},set,maxString)},anyOf:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);var compare=ascending;try{set.sort(compare)}catch(e){return fail(this,INVALID_KEY_ARGUMENT)}if(set.length===0)return emptyCollection(this);var c=new Collection(this,function(){return IDBKeyRange.bound(set[0],set[set.length-1])});c._ondirectionchange=function(direction){compare=direction==="next"?ascending:descending;set.sort(compare)};var i=0;c._addAlgorithm(function(cursor,advance,resolve){var key=cursor.key;while(compare(key,set[i])>0){++i;if(i===set.length){advance(resolve);return false}}if(compare(key,set[i])===0){return true}else{advance(function(){cursor.continue(set[i])});return false}});return c},notEqual:function(value){return this.inAnyRange([[minKey,value],[value,maxKey]],{includeLowers:false,includeUppers:false})},noneOf:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(set.length===0)return new Collection(this);try{set.sort(ascending)}catch(e){return fail(this,INVALID_KEY_ARGUMENT)}var ranges=set.reduce(function(res,val){return res?res.concat([[res[res.length-1][1],val]]):[[minKey,val]]},null);ranges.push([set[set.length-1],maxKey]);return this.inAnyRange(ranges,{includeLowers:false,includeUppers:false})},inAnyRange:function(ranges,options){if(ranges.length===0)return emptyCollection(this);if(!ranges.every(function(range){return range[0]!==undefined&&range[1]!==undefined&&ascending(range[0],range[1])<=0})){return fail(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",exceptions.InvalidArgument)}var includeLowers=!options||options.includeLowers!==false;var includeUppers=options&&options.includeUppers===true;function addRange(ranges,newRange){for(var i=0,l=ranges.length;i<l;++i){var range=ranges[i];if(cmp(newRange[0],range[1])<0&&cmp(newRange[1],range[0])>0){range[0]=min(range[0],newRange[0]);range[1]=max(range[1],newRange[1]);break}}if(i===l)ranges.push(newRange);return ranges}var sortDirection=ascending;function rangeSorter(a,b){return sortDirection(a[0],b[0])}var set;try{set=ranges.reduce(addRange,[]);set.sort(rangeSorter)}catch(ex){return fail(this,INVALID_KEY_ARGUMENT)}var i=0;var keyIsBeyondCurrentEntry=includeUppers?function(key){return ascending(key,set[i][1])>0}:function(key){return ascending(key,set[i][1])>=0};var keyIsBeforeCurrentEntry=includeLowers?function(key){return descending(key,set[i][0])>0}:function(key){return descending(key,set[i][0])>=0};function keyWithinCurrentRange(key){return!keyIsBeyondCurrentEntry(key)&&!keyIsBeforeCurrentEntry(key)}var checkKey=keyIsBeyondCurrentEntry;var c=new Collection(this,function(){return IDBKeyRange.bound(set[0][0],set[set.length-1][1],!includeLowers,!includeUppers)});c._ondirectionchange=function(direction){if(direction==="next"){checkKey=keyIsBeyondCurrentEntry;sortDirection=ascending}else{checkKey=keyIsBeforeCurrentEntry;sortDirection=descending}set.sort(rangeSorter)};c._addAlgorithm(function(cursor,advance,resolve){var key=cursor.key;while(checkKey(key)){++i;if(i===set.length){advance(resolve);return false}}if(keyWithinCurrentRange(key)){return true}else if(cmp(key,set[i][1])===0||cmp(key,set[i][0])===0){return false}else{advance(function(){if(sortDirection===ascending)cursor.continue(set[i][0]);else cursor.continue(set[i][1])});return false}});return c},startsWithAnyOf:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(!set.every(function(s){return typeof s==="string"})){return fail(this,"startsWithAnyOf() only works with strings")}if(set.length===0)return emptyCollection(this);return this.inAnyRange(set.map(function(str){return[str,str+maxString]}))}}});function Collection(whereClause,keyRangeGenerator){var keyRange=null,error=null;if(keyRangeGenerator)try{keyRange=keyRangeGenerator()}catch(ex){error=ex}var whereCtx=whereClause._ctx,table=whereCtx.table;this._ctx={table:table,index:whereCtx.index,isPrimKey:!whereCtx.index||table.schema.primKey.keyPath&&whereCtx.index===table.schema.primKey.name,range:keyRange,keysOnly:false,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:true,isMatch:null,offset:0,limit:Infinity,error:error,or:whereCtx.or,valueMapper:table.hook.reading.fire}}function isPlainKeyRange(ctx,ignoreLimitFilter){return!(ctx.filter||ctx.algorithm||ctx.or)&&(ignoreLimitFilter?ctx.justLimit:!ctx.replayFilter)}props(Collection.prototype,function(){function addFilter(ctx,fn){ctx.filter=combine(ctx.filter,fn)}function addReplayFilter(ctx,factory,isLimitFilter){var curr=ctx.replayFilter;ctx.replayFilter=curr?function(){return combine(curr(),factory())}:factory;ctx.justLimit=isLimitFilter&&!curr}function addMatchFilter(ctx,fn){ctx.isMatch=combine(ctx.isMatch,fn)}function getIndexOrStore(ctx,store){if(ctx.isPrimKey)return store;var indexSpec=ctx.table.schema.idxByName[ctx.index];if(!indexSpec)throw new exceptions.Schema("KeyPath "+ctx.index+" on object store "+store.name+" is not indexed");return store.index(indexSpec.name)}function openCursor(ctx,store){var idxOrStore=getIndexOrStore(ctx,store);return ctx.keysOnly&&"openKeyCursor"in idxOrStore?idxOrStore.openKeyCursor(ctx.range||null,ctx.dir+ctx.unique):idxOrStore.openCursor(ctx.range||null,ctx.dir+ctx.unique)}function iter(ctx,fn,resolve,reject,idbstore){var filter=ctx.replayFilter?combine(ctx.filter,ctx.replayFilter()):ctx.filter;if(!ctx.or){iterate(openCursor(ctx,idbstore),combine(ctx.algorithm,filter),fn,resolve,reject,!ctx.keysOnly&&ctx.valueMapper)}else(function(){var set={};var resolved=0;function resolveboth(){if(++resolved===2)resolve()}function union(item,cursor,advance){if(!filter||filter(cursor,advance,resolveboth,reject)){var primaryKey=cursor.primaryKey;var key=""+primaryKey;if(key==="[object ArrayBuffer]")key=""+new Uint8Array(primaryKey);if(!hasOwn(set,key)){set[key]=true;fn(item,cursor,advance)}}}ctx.or._iterate(union,resolveboth,reject,idbstore);iterate(openCursor(ctx,idbstore),ctx.algorithm,union,resolveboth,reject,!ctx.keysOnly&&ctx.valueMapper)})()}return{_read:function(fn,cb){var ctx=this._ctx;return ctx.error?ctx.table._trans(null,rejection.bind(null,ctx.error)):ctx.table._idbstore(READONLY,fn).then(cb)},_write:function(fn){var ctx=this._ctx;return ctx.error?ctx.table._trans(null,rejection.bind(null,ctx.error)):ctx.table._idbstore(READWRITE,fn,"locked")},_addAlgorithm:function(fn){var ctx=this._ctx;ctx.algorithm=combine(ctx.algorithm,fn)},_iterate:function(fn,resolve,reject,idbstore){return iter(this._ctx,fn,resolve,reject,idbstore)},clone:function(props$$1){var rv=Object.create(this.constructor.prototype),ctx=Object.create(this._ctx);if(props$$1)extend(ctx,props$$1);rv._ctx=ctx;return rv},raw:function(){this._ctx.valueMapper=null;return this},each:function(fn){var ctx=this._ctx;return this._read(function(resolve,reject,idbstore){iter(ctx,fn,resolve,reject,idbstore)})},count:function(cb){var ctx=this._ctx;if(isPlainKeyRange(ctx,true)){return this._read(function(resolve,reject,idbstore){var idx=getIndexOrStore(ctx,idbstore);var req=ctx.range?idx.count(ctx.range):idx.count();req.onerror=eventRejectHandler(reject);req.onsuccess=function(e){resolve(Math.min(e.target.result,ctx.limit))}},cb)}else{var count=0;return this._read(function(resolve,reject,idbstore){iter(ctx,function(){++count;return false},function(){resolve(count)},reject,idbstore)},cb)}},sortBy:function(keyPath,cb){var parts=keyPath.split(".").reverse(),lastPart=parts[0],lastIndex=parts.length-1;function getval(obj,i){if(i)return getval(obj[parts[i]],i-1);return obj[lastPart]}var order=this._ctx.dir==="next"?1:-1;function sorter(a,b){var aVal=getval(a,lastIndex),bVal=getval(b,lastIndex);return aVal<bVal?-order:aVal>bVal?order:0}return this.toArray(function(a){return a.sort(sorter)}).then(cb)},toArray:function(cb){var ctx=this._ctx;return this._read(function(resolve,reject,idbstore){if(hasGetAll&&ctx.dir==="next"&&isPlainKeyRange(ctx,true)&&ctx.limit>0){var readingHook=ctx.table.hook.reading.fire;var idxOrStore=getIndexOrStore(ctx,idbstore);var req=ctx.limit<Infinity?idxOrStore.getAll(ctx.range,ctx.limit):idxOrStore.getAll(ctx.range);req.onerror=eventRejectHandler(reject);req.onsuccess=readingHook===mirror?eventSuccessHandler(resolve):eventSuccessHandler(function(res){try{resolve(res.map(readingHook))}catch(e){reject(e)}})}else{var a=[];iter(ctx,function(item){a.push(item)},function arrayComplete(){resolve(a)},reject,idbstore)}},cb)},offset:function(offset){var ctx=this._ctx;if(offset<=0)return this;ctx.offset+=offset;if(isPlainKeyRange(ctx)){addReplayFilter(ctx,function(){var offsetLeft=offset;return function(cursor,advance){if(offsetLeft===0)return true;if(offsetLeft===1){--offsetLeft;return false}advance(function(){cursor.advance(offsetLeft);offsetLeft=0});return false}})}else{addReplayFilter(ctx,function(){var offsetLeft=offset;return function(){return--offsetLeft<0}})}return this},limit:function(numRows){this._ctx.limit=Math.min(this._ctx.limit,numRows);addReplayFilter(this._ctx,function(){var rowsLeft=numRows;return function(cursor,advance,resolve){if(--rowsLeft<=0)advance(resolve);return rowsLeft>=0}},true);return this},until:function(filterFunction,bIncludeStopEntry){addFilter(this._ctx,function(cursor,advance,resolve){if(filterFunction(cursor.value)){advance(resolve);return bIncludeStopEntry}else{return true}});return this},first:function(cb){return this.limit(1).toArray(function(a){return a[0]}).then(cb)},last:function(cb){return this.reverse().first(cb)},filter:function(filterFunction){addFilter(this._ctx,function(cursor){return filterFunction(cursor.value)});addMatchFilter(this._ctx,filterFunction);return this},and:function(filterFunction){return this.filter(filterFunction)},or:function(indexName){return new WhereClause(this._ctx.table,indexName,this)},reverse:function(){this._ctx.dir=this._ctx.dir==="prev"?"next":"prev";if(this._ondirectionchange)this._ondirectionchange(this._ctx.dir);return this},desc:function(){return this.reverse()},eachKey:function(cb){var ctx=this._ctx;ctx.keysOnly=!ctx.isMatch;return this.each(function(val,cursor){cb(cursor.key,cursor)})},eachUniqueKey:function(cb){this._ctx.unique="unique";return this.eachKey(cb)},eachPrimaryKey:function(cb){var ctx=this._ctx;ctx.keysOnly=!ctx.isMatch;return this.each(function(val,cursor){cb(cursor.primaryKey,cursor)})},keys:function(cb){var ctx=this._ctx;ctx.keysOnly=!ctx.isMatch;var a=[];return this.each(function(item,cursor){a.push(cursor.key)}).then(function(){return a}).then(cb)},primaryKeys:function(cb){var ctx=this._ctx;if(hasGetAll&&ctx.dir==="next"&&isPlainKeyRange(ctx,true)&&ctx.limit>0){return this._read(function(resolve,reject,idbstore){var idxOrStore=getIndexOrStore(ctx,idbstore);var req=ctx.limit<Infinity?idxOrStore.getAllKeys(ctx.range,ctx.limit):idxOrStore.getAllKeys(ctx.range);req.onerror=eventRejectHandler(reject);req.onsuccess=eventSuccessHandler(resolve)}).then(cb)}ctx.keysOnly=!ctx.isMatch;var a=[];return this.each(function(item,cursor){a.push(cursor.primaryKey)}).then(function(){return a}).then(cb)},uniqueKeys:function(cb){this._ctx.unique="unique";return this.keys(cb)},firstKey:function(cb){return this.limit(1).keys(function(a){return a[0]}).then(cb)},lastKey:function(cb){return this.reverse().firstKey(cb)},distinct:function(){var ctx=this._ctx,idx=ctx.index&&ctx.table.schema.idxByName[ctx.index];if(!idx||!idx.multi)return this;var set={};addFilter(this._ctx,function(cursor){var strKey=cursor.primaryKey.toString();var found=hasOwn(set,strKey);set[strKey]=true;return!found});return this},modify:function(changes){var self=this,ctx=this._ctx,hook=ctx.table.hook,updatingHook=hook.updating.fire,deletingHook=hook.deleting.fire;return this._write(function(resolve,reject,idbstore,trans){var modifyer;if(typeof changes==="function"){if(updatingHook===nop&&deletingHook===nop){modifyer=changes}else{modifyer=function(item){var origItem=deepClone(item);if(changes.call(this,item,this)===false)return false;if(!hasOwn(this,"value")){deletingHook.call(this,this.primKey,item,trans)}else{var objectDiff=getObjectDiff(origItem,this.value);var additionalChanges=updatingHook.call(this,objectDiff,this.primKey,origItem,trans);if(additionalChanges){item=this.value;keys(additionalChanges).forEach(function(keyPath){setByKeyPath(item,keyPath,additionalChanges[keyPath])})}}}}}else if(updatingHook===nop){var keyPaths=keys(changes);var numKeys=keyPaths.length;modifyer=function(item){var anythingModified=false;for(var i=0;i<numKeys;++i){var keyPath=keyPaths[i],val=changes[keyPath];if(getByKeyPath(item,keyPath)!==val){setByKeyPath(item,keyPath,val);anythingModified=true}}return anythingModified}}else{var origChanges=changes;changes=shallowClone(origChanges);modifyer=function(item){var anythingModified=false;var additionalChanges=updatingHook.call(this,changes,this.primKey,deepClone(item),trans);if(additionalChanges)extend(changes,additionalChanges);keys(changes).forEach(function(keyPath){var val=changes[keyPath];if(getByKeyPath(item,keyPath)!==val){setByKeyPath(item,keyPath,val);anythingModified=true}});if(additionalChanges)changes=shallowClone(origChanges);return anythingModified}}var count=0;var successCount=0;var iterationComplete=false;var failures=[];var failKeys=[];var currentKey=null;function modifyItem(item,cursor){currentKey=cursor.primaryKey;var thisContext={primKey:cursor.primaryKey,value:item,onsuccess:null,onerror:null};function onerror(e){failures.push(e);failKeys.push(thisContext.primKey);checkFinished();return true}if(modifyer.call(thisContext,item,thisContext)!==false){var bDelete=!hasOwn(thisContext,"value");++count;tryCatch(function(){var req=bDelete?cursor.delete():cursor.update(thisContext.value);req._hookCtx=thisContext;req.onerror=hookedEventRejectHandler(onerror);req.onsuccess=hookedEventSuccessHandler(function(){++successCount;checkFinished()})},onerror)}else if(thisContext.onsuccess){thisContext.onsuccess(thisContext.value)}}function doReject(e){if(e){failures.push(e);failKeys.push(currentKey)}return reject(new ModifyError("Error modifying one or more objects",failures,successCount,failKeys))}function checkFinished(){if(iterationComplete&&successCount+failures.length===count){if(failures.length>0)doReject();else resolve(successCount)}}self.clone().raw()._iterate(modifyItem,function(){iterationComplete=true;checkFinished()},doReject,idbstore)})},delete:function(){var _this=this;var ctx=this._ctx,range=ctx.range,deletingHook=ctx.table.hook.deleting.fire,hasDeleteHook=deletingHook!==nop;if(!hasDeleteHook&&isPlainKeyRange(ctx)&&(ctx.isPrimKey&&!hangsOnDeleteLargeKeyRange||!range)){return this._write(function(resolve,reject,idbstore){var onerror=eventRejectHandler(reject),countReq=range?idbstore.count(range):idbstore.count();countReq.onerror=onerror;countReq.onsuccess=function(){var count=countReq.result;tryCatch(function(){var delReq=range?idbstore.delete(range):idbstore.clear();delReq.onerror=onerror;delReq.onsuccess=function(){return resolve(count)}},function(err){return reject(err)})}})}var CHUNKSIZE=hasDeleteHook?2e3:1e4;return this._write(function(resolve,reject,idbstore,trans){var totalCount=0;var collection=_this.clone({keysOnly:!ctx.isMatch&&!hasDeleteHook}).distinct().limit(CHUNKSIZE).raw();var keysOrTuples=[];var nextChunk=function(){return collection.each(hasDeleteHook?function(val,cursor){keysOrTuples.push([cursor.primaryKey,cursor.value])}:function(val,cursor){keysOrTuples.push(cursor.primaryKey)}).then(function(){hasDeleteHook?keysOrTuples.sort(function(a,b){return ascending(a[0],b[0])}):keysOrTuples.sort(ascending);return bulkDelete(idbstore,trans,keysOrTuples,hasDeleteHook,deletingHook)}).then(function(){var count=keysOrTuples.length;totalCount+=count;keysOrTuples=[];return count<CHUNKSIZE?totalCount:nextChunk()})};resolve(nextChunk())})}}});function lowerVersionFirst(a,b){return a._cfg.version-b._cfg.version}function setApiOnPlace(objs,tableNames,dbschema){tableNames.forEach(function(tableName){var schema=dbschema[tableName];objs.forEach(function(obj){if(!(tableName in obj)){if(obj===Transaction.prototype||obj instanceof Transaction){setProp(obj,tableName,{get:function(){return this.table(tableName)}})}else{obj[tableName]=new Table(tableName,schema)}}})})}function removeTablesApi(objs){objs.forEach(function(obj){for(var key in obj){if(obj[key]instanceof Table)delete obj[key]}})}function iterate(req,filter,fn,resolve,reject,valueMapper){var mappedFn=valueMapper?function(x,c,a){return fn(valueMapper(x),c,a)}:fn;var wrappedFn=wrap(mappedFn,reject);if(!req.onerror)req.onerror=eventRejectHandler(reject);if(filter){req.onsuccess=trycatcher(function filter_record(){var cursor=req.result;if(cursor){var c=function(){cursor.continue()};if(filter(cursor,function(advancer){c=advancer},resolve,reject))wrappedFn(cursor.value,cursor,function(advancer){c=advancer});c()}else{resolve()}},reject)}else{req.onsuccess=trycatcher(function filter_record(){var cursor=req.result;if(cursor){var c=function(){cursor.continue()};wrappedFn(cursor.value,cursor,function(advancer){c=advancer});c()}else{resolve()}},reject)}}function parseIndexSyntax(indexes){var rv=[];indexes.split(",").forEach(function(index){index=index.trim();var name=index.replace(/([&*]|\+\+)/g,"");var keyPath=/^\[/.test(name)?name.match(/^\[(.*)\]$/)[1].split("+"):name;rv.push(new IndexSpec(name,keyPath||null,/\&/.test(index),/\*/.test(index),/\+\+/.test(index),isArray(keyPath),/\./.test(index)))});return rv}function cmp(key1,key2){return indexedDB.cmp(key1,key2)}function min(a,b){return cmp(a,b)<0?a:b}function max(a,b){return cmp(a,b)>0?a:b}function ascending(a,b){return indexedDB.cmp(a,b)}function descending(a,b){return indexedDB.cmp(b,a)}function simpleCompare(a,b){return a<b?-1:a===b?0:1}function simpleCompareReverse(a,b){return a>b?-1:a===b?0:1}function combine(filter1,filter2){return filter1?filter2?function(){return filter1.apply(this,arguments)&&filter2.apply(this,arguments)}:filter1:filter2}function readGlobalSchema(){db.verno=idbdb.version/10;db._dbSchema=globalSchema={};dbStoreNames=slice(idbdb.objectStoreNames,0);if(dbStoreNames.length===0)return;var trans=idbdb.transaction(safariMultiStoreFix(dbStoreNames),"readonly");dbStoreNames.forEach(function(storeName){var store=trans.objectStore(storeName),keyPath=store.keyPath,dotted=keyPath&&typeof keyPath==="string"&&keyPath.indexOf(".")!==-1;var primKey=new IndexSpec(keyPath,keyPath||"",false,false,!!store.autoIncrement,keyPath&&typeof keyPath!=="string",dotted);var indexes=[];for(var j=0;j<store.indexNames.length;++j){var idbindex=store.index(store.indexNames[j]);keyPath=idbindex.keyPath;dotted=keyPath&&typeof keyPath==="string"&&keyPath.indexOf(".")!==-1;var index=new IndexSpec(idbindex.name,keyPath,!!idbindex.unique,!!idbindex.multiEntry,false,keyPath&&typeof keyPath!=="string",dotted);indexes.push(index)}globalSchema[storeName]=new TableSchema(storeName,primKey,indexes,{})});setApiOnPlace([allTables],keys(globalSchema),globalSchema)}function adjustToExistingIndexNames(schema,idbtrans){var storeNames=idbtrans.db.objectStoreNames;for(var i=0;i<storeNames.length;++i){var storeName=storeNames[i];var store=idbtrans.objectStore(storeName);hasGetAll="getAll"in store;for(var j=0;j<store.indexNames.length;++j){var indexName=store.indexNames[j];var keyPath=store.index(indexName).keyPath;var dexieName=typeof keyPath==="string"?keyPath:"["+slice(keyPath).join("+")+"]";if(schema[storeName]){var indexSpec=schema[storeName].idxByName[dexieName];if(indexSpec)indexSpec.name=indexName}}}if(/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&_global.WorkerGlobalScope&&_global instanceof _global.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604){hasGetAll=false}}function fireOnBlocked(ev){db.on("blocked").fire(ev);connections.filter(function(c){return c.name===db.name&&c!==db&&!c._vcFired}).map(function(c){return c.on("versionchange").fire(ev)})}extend(this,{Collection:Collection,Table:Table,Transaction:Transaction,Version:Version,WhereClause:WhereClause});init();addons.forEach(function(fn){fn(db)})}function parseType(type){if(typeof type==="function"){return new type}else if(isArray(type)){return[parseType(type[0])]}else if(type&&typeof type==="object"){var rv={};applyStructure(rv,type);return rv}else{return type}}function applyStructure(obj,structure){keys(structure).forEach(function(member){var value=parseType(structure[member]);obj[member]=value});return obj}function hookedEventSuccessHandler(resolve){return wrap(function(event){var req=event.target,ctx=req._hookCtx,result=ctx.value||req.result,hookSuccessHandler=ctx&&ctx.onsuccess;hookSuccessHandler&&hookSuccessHandler(result);resolve&&resolve(result)},resolve)}function eventRejectHandler(reject){return wrap(function(event){preventDefault(event);reject(event.target.error);return false})}function eventSuccessHandler(resolve){return wrap(function(event){resolve(event.target.result)})}function hookedEventRejectHandler(reject){return wrap(function(event){var req=event.target,err=req.error,ctx=req._hookCtx,hookErrorHandler=ctx&&ctx.onerror;hookErrorHandler&&hookErrorHandler(err);preventDefault(event);reject(err);return false})}function preventDefault(event){if(event.stopPropagation)event.stopPropagation();if(event.preventDefault)event.preventDefault()}function awaitIterator(iterator){var callNext=function(result){return iterator.next(result)},doThrow=function(error){return iterator.throw(error)},onSuccess=step(callNext),onError=step(doThrow);function step(getNext){return function(val){var next=getNext(val),value=next.value;return next.done?value:!value||typeof value.then!=="function"?isArray(value)?Promise.all(value).then(onSuccess,onError):onSuccess(value):value.then(onSuccess,onError)}}return step(callNext)()}function IndexSpec(name,keyPath,unique,multi,auto,compound,dotted){this.name=name;this.keyPath=keyPath;this.unique=unique;this.multi=multi;this.auto=auto;this.compound=compound;this.dotted=dotted;var keyPathSrc=typeof keyPath==="string"?keyPath:keyPath&&"["+[].join.call(keyPath,"+")+"]";this.src=(unique?"&":"")+(multi?"*":"")+(auto?"++":"")+keyPathSrc}function TableSchema(name,primKey,indexes,instanceTemplate){this.name=name;this.primKey=primKey||new IndexSpec;this.indexes=indexes||[new IndexSpec];this.instanceTemplate=instanceTemplate;this.mappedClass=null;this.idxByName=arrayToObject(indexes,function(index){return[index.name,index]})}function safariMultiStoreFix(storeNames){return storeNames.length===1?storeNames[0]:storeNames}function getNativeGetDatabaseNamesFn(indexedDB){var fn=indexedDB&&(indexedDB.getDatabaseNames||indexedDB.webkitGetDatabaseNames);return fn&&fn.bind(indexedDB)}props(Dexie,fullNameExceptions);props(Dexie,{delete:function(databaseName){var db=new Dexie(databaseName),promise=db.delete();promise.onblocked=function(fn){db.on("blocked",fn);return this};return promise},exists:function(name){return new Dexie(name).open().then(function(db){db.close();return true}).catch(Dexie.NoSuchDatabaseError,function(){return false})},getDatabaseNames:function(cb){var getDatabaseNames=getNativeGetDatabaseNamesFn(Dexie.dependencies.indexedDB);return getDatabaseNames?new Promise(function(resolve,reject){var req=getDatabaseNames();req.onsuccess=function(event){resolve(slice(event.target.result,0))};req.onerror=eventRejectHandler(reject)}).then(cb):dbNamesDB.dbnames.toCollection().primaryKeys(cb)},defineClass:function(){function Class(properties){if(properties)extend(this,properties)}return Class},applyStructure:applyStructure,ignoreTransaction:function(scopeFunc){return PSD.trans?usePSD(PSD.transless,scopeFunc):scopeFunc()},vip:function(fn){return newScope(function(){PSD.letThrough=true;return fn()})},async:function(generatorFn){return function(){try{var rv=awaitIterator(generatorFn.apply(this,arguments));if(!rv||typeof rv.then!=="function")return Promise.resolve(rv);return rv}catch(e){return rejection(e)}}},spawn:function(generatorFn,args,thiz){try{var rv=awaitIterator(generatorFn.apply(thiz,args||[]));if(!rv||typeof rv.then!=="function")return Promise.resolve(rv);return rv}catch(e){return rejection(e)}},currentTransaction:{get:function(){return PSD.trans||null}},waitFor:function(promiseOrFunction,optionalTimeout){var promise=Promise.resolve(typeof promiseOrFunction==="function"?Dexie.ignoreTransaction(promiseOrFunction):promiseOrFunction).timeout(optionalTimeout||6e4);return PSD.trans?PSD.trans.waitFor(promise):promise},Promise:Promise,debug:{get:function(){return debug},set:function(value){setDebug(value,value==="dexie"?function(){return true}:dexieStackFrameFilter)}},derive:derive,extend:extend,props:props,override:override,Events:Events,getByKeyPath:getByKeyPath,setByKeyPath:setByKeyPath,delByKeyPath:delByKeyPath,shallowClone:shallowClone,deepClone:deepClone,getObjectDiff:getObjectDiff,asap:asap,maxKey:maxKey,minKey:minKey,addons:[],connections:connections,MultiModifyError:exceptions.Modify,errnames:errnames,IndexSpec:IndexSpec,TableSchema:TableSchema,dependencies:function(){try{return{indexedDB:_global.indexedDB||_global.mozIndexedDB||_global.webkitIndexedDB||_global.msIndexedDB,IDBKeyRange:_global.IDBKeyRange||_global.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:DEXIE_VERSION,version:DEXIE_VERSION.split(".").map(function(n){return parseInt(n)}).reduce(function(p,c,i){return p+c/Math.pow(10,i*2)}),default:Dexie,Dexie:Dexie});Promise.rejectionMapper=mapError;dbNamesDB=new Dexie("__dbnames");dbNamesDB.version(1).stores({dbnames:"name"});(function(){var DBNAMES="Dexie.DatabaseNames";try{if(typeof localStorage!==undefined&&_global.document!==undefined){JSON.parse(localStorage.getItem(DBNAMES)||"[]").forEach(function(name){return dbNamesDB.dbnames.put({name:name}).catch(nop)});localStorage.removeItem(DBNAMES)}}catch(_e){}})();return Dexie})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("timers").setImmediate)},{timers:5}],42:[function(require,module,exports){(function(global){var ws=null;if(typeof WebSocket!=="undefined"){ws=WebSocket}else if(typeof MozWebSocket!=="undefined"){ws=MozWebSocket}else if(typeof global!=="undefined"){ws=global.WebSocket||global.MozWebSocket}else if(typeof window!=="undefined"){ws=window.WebSocket||window.MozWebSocket}else if(typeof self!=="undefined"){ws=self.WebSocket||self.MozWebSocket}module.exports=ws}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],43:[function(require,module,exports){(function(){function Async(params){var PodSocketClass,PodUtility;if(typeof require!=="undefined"&&typeof exports!=="undefined"){PodSocketClass=require("./socket.js");PodUtility=require("../utility/utility.js")}else{PodSocketClass=POD.Socket;PodUtility=POD.AsyncUtility}var Utility=new PodUtility;var protocol=params.protocol||"websocket",appId=params.appId||"PodChat",deviceId=params.deviceId,eventCallbacks={connect:{},disconnect:{},reconnect:{},message:{},asyncReady:{},stateChange:{},error:{}},ackCallback={},socket,asyncMessageType={PING:0,SERVER_REGISTER:1,DEVICE_REGISTER:2,MESSAGE:3,MESSAGE_ACK_NEEDED:4,MESSAGE_SENDER_ACK_NEEDED:5,ACK:6,GET_REGISTERED_PEERS:7,PEER_REMOVED:-3,REGISTER_QUEUE:-2,NOT_REGISTERED:-1,ERROR_MESSAGE:-99},socketStateType={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},isNode=Utility.isNode(),isSocketOpen=false,isDeviceRegister=false,isServerRegister=false,socketState=socketStateType.CONNECTING,asyncState="",registerServerTimeoutId,registerDeviceTimeoutId,checkIfSocketHasOpennedTimeoutId,asyncReadyTimeoutId,pushSendDataQueue=[],oldPeerId,peerId=params.peerId,lastMessageId=0,messageTtl=params.messageTtl||86400,serverName=params.serverName||"oauth-wire",serverRegisteration=typeof params.serverRegisteration==="boolean"?params.serverRegisteration:true,connectionRetryInterval=params.connectionRetryInterval||5e3,socketReconnectRetryInterval,socketReconnectCheck,retryStep=4,reconnectOnClose=typeof params.reconnectOnClose==="boolean"?params.reconnectOnClose:true,asyncLogging=params.asyncLogging&&typeof params.asyncLogging.onFunction==="boolean"?params.asyncLogging.onFunction:false,onReceiveLogging=params.asyncLogging&&typeof params.asyncLogging.onMessageReceive==="boolean"?params.asyncLogging.onMessageReceive:false,onSendLogging=params.asyncLogging&&typeof params.asyncLogging.onMessageSend==="boolean"?params.asyncLogging.onMessageSend:false,workerId=params.asyncLogging&&typeof parseInt(params.asyncLogging.workerId)==="number"?params.asyncLogging.workerId:0;var init=function(){switch(protocol){case"websocket":initSocket();break}},asyncLogger=function(type,msg){Utility.asyncLogger({protocol:protocol,workerId:workerId,type:type,msg:msg,peerId:peerId,deviceId:deviceId,isSocketOpen:isSocketOpen,isDeviceRegister:isDeviceRegister,isServerRegister:isServerRegister,socketState:socketState,pushSendDataQueue:pushSendDataQueue})},initSocket=function(){socket=new PodSocketClass({socketAddress:params.socketAddress,wsConnectionWaitTime:params.wsConnectionWaitTime,connectionCheckTimeout:params.connectionCheckTimeout,connectionCheckTimeoutThreshold:params.connectionCheckTimeoutThreshold});checkIfSocketHasOpennedTimeoutId=setTimeout(function(){if(!isSocketOpen){fireEvent("error",{errorCode:4001,errorMessage:"Can not open Socket!"})}},65e3);socket.on("open",function(){checkIfSocketHasOpennedTimeoutId&&clearTimeout(checkIfSocketHasOpennedTimeoutId);socketReconnectRetryInterval&&clearTimeout(socketReconnectRetryInterval);socketReconnectCheck&&clearTimeout(socketReconnectCheck);isSocketOpen=true;retryStep=4;socketState=socketStateType.OPEN;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId})});socket.on("message",function(msg){handleSocketMessage(msg);if(onReceiveLogging){asyncLogger("Receive",msg)}});socket.on("close",function(event){isSocketOpen=false;isDeviceRegister=false;oldPeerId=peerId;socketState=socketStateType.CLOSED;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});fireEvent("disconnect",event);if(reconnectOnClose){if(asyncLogging){if(workerId>0){Utility.asyncStepLogger(workerId+"\t Reconnecting after "+retryStep+"s")}else{Utility.asyncStepLogger("Reconnecting after "+retryStep+"s")}}socketState=socketStateType.CLOSED;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:1e3*retryStep,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});socketReconnectRetryInterval&&clearTimeout(socketReconnectRetryInterval);socketReconnectRetryInterval=setTimeout(function(){socket.connect()},1e3*retryStep);if(retryStep<64){retryStep*=2}}else{socketReconnectRetryInterval&&clearTimeout(socketReconnectRetryInterval);socketReconnectCheck&&clearTimeout(socketReconnectCheck);fireEvent("error",{errorCode:4005,errorMessage:"Socket Closed!"});socketState=socketStateType.CLOSED;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId})}});socket.on("customError",function(error){fireEvent("error",{errorCode:error.errorCode,errorMessage:error.errorMessage,errorEvent:error.errorEvent})});socket.on("error",function(error){fireEvent("error",{errorCode:"",errorMessage:"",errorEvent:error})})},handleSocketMessage=function(msg){var ack;if(msg.type===asyncMessageType.MESSAGE_ACK_NEEDED||msg.type===asyncMessageType.MESSAGE_SENDER_ACK_NEEDED){ack=function(){pushSendData({type:asyncMessageType.ACK,content:{messageId:msg.id}})}}switch(msg.type){case asyncMessageType.PING:handlePingMessage(msg);break;case asyncMessageType.SERVER_REGISTER:handleServerRegisterMessage(msg);break;case asyncMessageType.DEVICE_REGISTER:handleDeviceRegisterMessage(msg.content);break;case asyncMessageType.MESSAGE:fireEvent("message",msg);break;case asyncMessageType.MESSAGE_ACK_NEEDED:case asyncMessageType.MESSAGE_SENDER_ACK_NEEDED:ack();fireEvent("message",msg);break;case asyncMessageType.ACK:fireEvent("message",msg);if(ackCallback[msg.senderMessageId]=="function"){ackCallback[msg.senderMessageId]();delete ackCallback[msg.senderMessageId]}break;case asyncMessageType.ERROR_MESSAGE:fireEvent("error",{errorCode:4002,errorMessage:"Async Error!",errorEvent:msg});break}},handlePingMessage=function(msg){if(msg.content){if(deviceId===undefined){deviceId=msg.content;registerDevice()}else{registerDevice()}}else{if(onReceiveLogging){if(workerId>0){Utility.asyncStepLogger(workerId+"\t Ping Response at ("+new Date+")")}else{Utility.asyncStepLogger("Ping Response at ("+new Date+")")}}}},registerDevice=function(isRetry){if(asyncLogging){if(workerId>0){Utility.asyncStepLogger(workerId+"\t Registering Device")}else{Utility.asyncStepLogger("Registering Device")}}var content={appId:appId,deviceId:deviceId};if(peerId!==undefined){content.refresh=true}else{content.renew=true}pushSendData({type:asyncMessageType.DEVICE_REGISTER,content:content})},handleDeviceRegisterMessage=function(recievedPeerId){if(!isDeviceRegister){if(registerDeviceTimeoutId){clearTimeout(registerDeviceTimeoutId)}isDeviceRegister=true;peerId=recievedPeerId}if(serverRegisteration){if(isServerRegister&&peerId===oldPeerId){fireEvent("asyncReady");isServerRegister=true;pushSendDataQueueHandler();socketState=socketStateType.OPEN;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId})}else{socketState=socketStateType.OPEN;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});registerServer()}}else{fireEvent("asyncReady");isServerRegister="Not Needed";pushSendDataQueueHandler();if(asyncLogging){if(workerId>0){Utility.asyncStepLogger(workerId+"\t Async is Ready")}else{Utility.asyncStepLogger("Async is Ready")}}socketState=socketStateType.OPEN;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId})}},registerServer=function(){if(asyncLogging){if(workerId>0){Utility.asyncStepLogger(workerId+"\t Registering Server")}else{Utility.asyncStepLogger("Registering Server")}}var content={name:serverName};pushSendData({type:asyncMessageType.SERVER_REGISTER,content:content});registerServerTimeoutId=setTimeout(function(){if(!isServerRegister){registerServer()}},connectionRetryInterval)},handleServerRegisterMessage=function(msg){if(msg.senderName&&msg.senderName===serverName){isServerRegister=true;if(registerServerTimeoutId){clearTimeout(registerServerTimeoutId)}socketState=socketStateType.OPEN;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});fireEvent("asyncReady");pushSendDataQueueHandler();if(asyncLogging){if(workerId>0){Utility.asyncStepLogger(workerId+"\t Async is Ready")}else{Utility.asyncStepLogger("Async is Ready")}}}else{isServerRegister=false}},pushSendData=function(msg){if(onSendLogging){asyncLogger("Send",msg)}switch(protocol){case"websocket":if(socketState===socketStateType.OPEN){socket.emit(msg)}else{pushSendDataQueue.push(msg)}break}},clearTimeouts=function(){registerDeviceTimeoutId&&clearTimeout(registerDeviceTimeoutId);registerServerTimeoutId&&clearTimeout(registerServerTimeoutId);checkIfSocketHasOpennedTimeoutId&&clearTimeout(checkIfSocketHasOpennedTimeoutId);socketReconnectCheck&&clearTimeout(socketReconnectCheck)},pushSendDataQueueHandler=function(){while(pushSendDataQueue.length>0&&socketState===socketStateType.OPEN){var msg=pushSendDataQueue.splice(0,1)[0];pushSendData(msg)}},fireEvent=function(eventName,param,ack){try{if(ack){for(var id in eventCallbacks[eventName]){eventCallbacks[eventName][id](param,ack)}}else{for(var id in eventCallbacks[eventName]){eventCallbacks[eventName][id](param)}}}catch(e){fireEvent("error",{errorCode:999,errorMessage:"Unknown ERROR!",errorEvent:e})}};this.on=function(eventName,callback){if(eventCallbacks[eventName]){var id=Utility.generateUUID();eventCallbacks[eventName][id]=callback;return id}if(eventName==="connect"&&socketState===socketStateType.OPEN){callback(peerId)}};this.send=function(params,callback){var messageType=typeof params.type==="number"?params.type:callback?asyncMessageType.MESSAGE_SENDER_ACK_NEEDED:asyncMessageType.MESSAGE;var socketData={type:messageType,content:params.content};if(params.trackerId){socketData.trackerId=params.trackerId}lastMessageId+=1;var messageId=lastMessageId;if(messageType===asyncMessageType.MESSAGE_SENDER_ACK_NEEDED||messageType===asyncMessageType.MESSAGE_ACK_NEEDED){ackCallback[messageId]=function(){callback&&callback()}}socketData.content.messageId=messageId;socketData.content.ttl=messageTtl;pushSendData(socketData)};this.getAsyncState=function(){return socketState};this.getSendQueue=function(){return pushSendDataQueue};this.getPeerId=function(){return peerId};this.getServerName=function(){return serverName};this.setServerName=function(newServerName){serverName=newServerName};this.setDeviceId=function(newDeviceId){deviceId=newDeviceId};this.close=function(){oldPeerId=peerId;isDeviceRegister=false;isSocketOpen=false;clearTimeouts();switch(protocol){case"websocket":socketState=socketStateType.CLOSED;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});socketReconnectRetryInterval&&clearTimeout(socketReconnectRetryInterval);socket.close();break}};this.logout=function(){oldPeerId=peerId;peerId=undefined;isServerRegister=false;isDeviceRegister=false;isSocketOpen=false;deviceId=undefined;pushSendDataQueue=[];ackCallback={};clearTimeouts();switch(protocol){case"websocket":socketState=socketStateType.CLOSED;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});reconnectOnClose=false;socket.close();break}};this.reconnectSocket=function(){oldPeerId=peerId;isDeviceRegister=false;isSocketOpen=false;clearTimeouts();socketState=socketStateType.CLOSED;fireEvent("stateChange",{socketState:socketState,timeUntilReconnect:0,deviceRegister:isDeviceRegister,serverRegister:isServerRegister,peerId:peerId});socketReconnectRetryInterval&&clearTimeout(socketReconnectRetryInterval);socket.close();socketReconnectRetryInterval=setTimeout(function(){retryStep=4;socket.connect()},2e3)};this.generateUUID=Utility.generateUUID;init()}if(typeof module!=="undefined"&&typeof module.exports!="undefined"){module.exports=Async}else{if(!window.POD){window.POD={}}window.POD.Async=Async}})()},{"../utility/utility.js":45,"./socket.js":44}],44:[function(require,module,exports){(function(){function Socket(params){if(typeof WebSocket==="undefined"&&typeof require!=="undefined"&&typeof exports!=="undefined"){WebSocket=require("isomorphic-ws")}var address=params.socketAddress,wsConnectionWaitTime=params.wsConnectionWaitTime||500,connectionCheckTimeout=params.connectionCheckTimeout||1e4,eventCallback={},socket,waitForSocketToConnectTimeoutId,forceCloseSocket=false,forceCloseSocketTimeout,socketRealTimeStatusInterval,sendPingTimeout,socketCloseTimeout,forceCloseTimeout;var init=function(){connect()},connect=function(){try{if(socket&&socket.readyState==1){return}socket=new WebSocket(address,[]);socketRealTimeStatusInterval&&clearInterval(socketRealTimeStatusInterval);socketRealTimeStatusInterval=setInterval(function(){switch(socket.readyState){case 2:onCloseHandler(null);break;case 3:socketRealTimeStatusInterval&&clearInterval(socketRealTimeStatusInterval);break}},5e3);socket.onopen=function(event){waitForSocketToConnect(function(){eventCallback["open"]()})};socket.onmessage=function(event){var messageData=JSON.parse(event.data);eventCallback["message"](messageData);forceCloseSocket=false;socketCloseTimeout&&clearTimeout(socketCloseTimeout);forceCloseTimeout&&clearTimeout(forceCloseTimeout);socketCloseTimeout=setTimeout(function(){ping();forceCloseSocket=true;forceCloseTimeout=setTimeout(function(){if(forceCloseSocket){socket.close()}},connectionCheckTimeout)},connectionCheckTimeout*1.5)};socket.onclose=function(event){onCloseHandler(event)};socket.onerror=function(event){eventCallback["error"](event)}}catch(error){eventCallback["customError"]({errorCode:4e3,errorMessage:"ERROR in WEBSOCKET!",errorEvent:error})}},onCloseHandler=function(event){sendPingTimeout&&clearTimeout(sendPingTimeout);socketCloseTimeout&&clearTimeout(socketCloseTimeout);forceCloseTimeout&&clearTimeout(forceCloseTimeout);eventCallback["close"](event)},ping=function(){sendData({type:0})},waitForSocketToConnect=function(callback){waitForSocketToConnectTimeoutId&&clearTimeout(waitForSocketToConnectTimeoutId);if(socket.readyState===1){callback()}else{waitForSocketToConnectTimeoutId=setTimeout(function(){if(socket.readyState===1){callback()}else{waitForSocketToConnect(callback)}},wsConnectionWaitTime)}},sendData=function(params){var data={type:params.type};if(params.trackerId){data.trackerId=params.trackerId}sendPingTimeout&&clearTimeout(sendPingTimeout);sendPingTimeout=setTimeout(function(){ping()},connectionCheckTimeout);try{if(params.content){data.content=JSON.stringify(params.content)}if(socket.readyState===1){socket.send(JSON.stringify(data))}}catch(error){eventCallback["customError"]({errorCode:4004,errorMessage:"Error in Socket sendData!",errorEvent:error})}};this.on=function(messageName,callback){eventCallback[messageName]=callback};this.emit=sendData;this.connect=function(){connect()};this.close=function(){sendPingTimeout&&clearTimeout(sendPingTimeout);socketCloseTimeout&&clearTimeout(socketCloseTimeout);forceCloseTimeout&&clearTimeout(forceCloseTimeout);socket.close()};init()}if(typeof module!=="undefined"&&typeof module.exports!="undefined"){module.exports=Socket}else{if(!window.POD){window.POD={}}window.POD.Socket=Socket}})()},{"isomorphic-ws":42}],45:[function(require,module,exports){(function(global){(function(){function Utility(){this.isNode=function(){return typeof global!=="undefined"&&{}.toString.call(global)==="[object global]"};this.generateUUID=function(sectionCount){var d=(new Date).getTime();var textData="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(sectionCount==1){textData="xxxxxxxx"}if(sectionCount==2){textData="xxxxxxxx-xxxx"}if(sectionCount==3){textData="xxxxxxxx-xxxx-4xxx"}if(sectionCount==4){textData="xxxxxxxx-xxxx-4xxx-yxxx"}var uuid=textData.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&7|8).toString(16)});return uuid};this.asyncLogger=function(params){var type=params.type,msg=params.msg,peerId=params.peerId,deviceId=params.deviceId,isSocketOpen=params.isSocketOpen,isDeviceRegister=params.isDeviceRegister,isServerRegister=params.isServerRegister,socketState=params.socketState,pushSendDataQueue=params.pushSendDataQueue,workerId=params.workerId,protocol=params.protocol||"websocket",BgColor;switch(type){case"Send":BgColor=44;FgColor=34;ColorCSS="#4c8aff";break;case"Receive":BgColor=45;FgColor=35;ColorCSS="#aa386d";break;case"Error":BgColor=41;FgColor=31;ColorCSS="#ff0043";break;default:BgColor=45;ColorCSS="#212121";break}switch(protocol){case"websocket":if(typeof global!=="undefined"&&{}.toString.call(global)==="[object global]"){console.log("\n");console.log("["+BgColor+"m[8m%s[0m","################################################################");console.log("["+BgColor+"m[8m##################[0m[37m["+BgColor+"m S O C K E T    S T A T U S [0m["+BgColor+"m[8m##################[0m");console.log("["+BgColor+"m[8m%s[0m","################################################################");console.log("["+BgColor+"m[8m##[0m \t\t\t\t\t\t\t      ["+BgColor+"m[8m##[0m");console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," PEER ID\t\t",peerId);if(workerId>0){console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," WORKER ID\t\t",workerId)}console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," DEVICE ID\t\t",deviceId);console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," IS SOCKET OPEN\t",isSocketOpen);console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," DEVICE REGISTER\t",isDeviceRegister);console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," SERVER REGISTER\t",isServerRegister);console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," SOCKET STATE\t",socketState);console.log("["+BgColor+"m[8m##[0m [2m%s[0m ["+FgColor+"m%s[0m "," CURRENT MESSAGE\t",type);console.log("["+BgColor+"m[8m##[0m");Object.keys(msg).forEach(function(key){if(typeof msg[key]==="object"){console.log("["+BgColor+"m[8m##[0m \t [1m-[0m [35m%s[0m",key);Object.keys(msg[key]).forEach(function(k){console.log("["+BgColor+"m[8m##[0m \t   [1m[0m [35m%s[0m : [33m%s[0m",k,msg[key][k])})}else{console.log("["+BgColor+"m[8m##[0m \t [1m[0m [35m%s[0m : [33m%s[0m",key,msg[key])}});console.log("["+BgColor+"m[8m##[0m");if(pushSendDataQueue.length>0){console.log("["+BgColor+"m[8m##[0m [2m%s[0m"," SEND QUEUE");console.log("["+BgColor+"m[8m##[0m");Object.keys(pushSendDataQueue).forEach(function(key){if(typeof pushSendDataQueue[key]==="object"){console.log("["+BgColor+"m[8m##[0m \t [1m-[0m [35m%s[0m",key);Object.keys(pushSendDataQueue[key]).forEach(function(k){console.log("["+BgColor+"m[8m##[0m \t   [1m[0m [35m%s[0m : [36m%s[0m",k,JSON.stringify(pushSendDataQueue[key][k]))})}else{console.log("["+BgColor+"m[8m##[0m \t [1m[0m [35m%s[0m : [33m%s[0m",key,pushSendDataQueue[key])}})}else{console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m "," SEND QUEUE\t\t","Empty")}console.log("["+BgColor+"m[8m##[0m \t\t\t\t\t\t\t      ["+BgColor+"m[8m##[0m");console.log("["+BgColor+"m[8m%s[0m","################################################################");console.log("\n")}else{console.log("\n");console.log("%cS O C K E T    S T A T U S","background: "+ColorCSS+"; padding: 10px 142px; font-weight: bold; font-size: 18px; color: #fff;");console.log("\n");console.log("%c   PEER ID\t\t %c"+peerId,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   DEVICE ID\t\t %c"+deviceId,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   IS SOCKET OPEN\t %c"+isSocketOpen,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   DEVICE REGISTER\t %c"+isDeviceRegister,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   SERVER REGISTER\t %c"+isServerRegister,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   SOCKET STATE\t\t %c"+socketState,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   CURRENT MESSAGE\t %c"+type,"color: #444","color: #aa386d; font-weight: bold");console.log("\n");Object.keys(msg).forEach(function(key){if(typeof msg[key]==="object"){console.log("%c \t-"+key,"color: #777");Object.keys(msg[key]).forEach(function(k){console.log("%c \t  "+k+" : %c"+msg[key][k],"color: #777","color: #f23; font-weight: bold")})}else{console.log("%c \t"+key+" : %c"+msg[key],"color: #777","color: #f23; font-weight: bold")}});console.log("\n");if(pushSendDataQueue.length>0){console.log("%c   SEND QUEUE","color: #444");console.log("\n");Object.keys(pushSendDataQueue).forEach(function(key){if(typeof pushSendDataQueue[key]==="object"){console.log("%c \t-"+key,"color: #777");Object.keys(pushSendDataQueue[key]).forEach(function(k){console.log("%c \t  "+k+" : %c"+JSON.stringify(pushSendDataQueue[key][k]),"color: #777","color: #999; font-weight: bold")})}else{console.log("%c \t"+key+" : %c"+pushSendDataQueue[key],"color: #777","color: #999; font-weight: bold")}})}else{console.log("%c   SEND QUEUE\t\t %cEmpty","color: #444","color: #000; font-weight: bold")}console.log("\n");console.log("%c ","font-weight: bold; font-size: 3px; border-left: solid 540px "+ColorCSS+";");console.log("\n")}break;case"queue":if(typeof global!=="undefined"&&{}.toString.call(global)==="[object global]"){console.log("\n");console.log("["+BgColor+"m[8m%s[0m","################################################################");console.log("["+BgColor+"m[8m##################[0m[37m["+BgColor+"m Q U E U E      S T A T U S [0m["+BgColor+"m[8m##################[0m");console.log("["+BgColor+"m[8m%s[0m","################################################################");console.log("["+BgColor+"m[8m##[0m \t\t\t\t\t\t\t      ["+BgColor+"m[8m##[0m");console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m"," QUEUE STATE\t\t",socketState);console.log("["+BgColor+"m[8m##[0m [2m%s[0m ["+FgColor+"m%s[0m "," CURRENT MESSAGE\t",type);console.log("["+BgColor+"m[8m##[0m");Object.keys(msg).forEach(function(key){if(typeof msg[key]==="object"){console.log("["+BgColor+"m[8m##[0m \t [1m-[0m [35m%s[0m",key);Object.keys(msg[key]).forEach(function(k){console.log("["+BgColor+"m[8m##[0m \t   [1m[0m [35m%s[0m : [33m%s[0m",k,msg[key][k])})}else{console.log("["+BgColor+"m[8m##[0m \t [1m[0m [35m%s[0m : [33m%s[0m",key,msg[key])}});console.log("["+BgColor+"m[8m##[0m");if(pushSendDataQueue.length>0){console.log("["+BgColor+"m[8m##[0m [2m%s[0m"," SEND QUEUE");console.log("["+BgColor+"m[8m##[0m");Object.keys(pushSendDataQueue).forEach(function(key){if(typeof pushSendDataQueue[key]==="object"){console.log("["+BgColor+"m[8m##[0m \t [1m-[0m [35m%s[0m",key);Object.keys(pushSendDataQueue[key]).forEach(function(k){console.log("["+BgColor+"m[8m##[0m \t   [1m[0m [35m%s[0m : [36m%s[0m",k,JSON.stringify(pushSendDataQueue[key][k]))})}else{console.log("["+BgColor+"m[8m##[0m \t [1m[0m [35m%s[0m : [33m%s[0m",key,pushSendDataQueue[key])}})}else{console.log("["+BgColor+"m[8m##[0m [2m%s[0m [1m%s[0m "," SEND QUEUE\t\t","Empty")}console.log("["+BgColor+"m[8m##[0m \t\t\t\t\t\t\t      ["+BgColor+"m[8m##[0m");console.log("["+BgColor+"m[8m%s[0m","################################################################");console.log("\n")}else{console.log("\n");console.log("%cQ U E U E      S T A T U S","background: "+ColorCSS+"; padding: 10px 142px; font-weight: bold; font-size: 18px; color: #fff;");console.log("\n");console.log("%c   QUEUE STATE\t\t %c"+socketState,"color: #444","color: #ffac28; font-weight: bold");console.log("%c   CURRENT MESSAGE\t %c"+type,"color: #444","color: #aa386d; font-weight: bold");console.log("\n");Object.keys(msg).forEach(function(key){if(typeof msg[key]==="object"){console.log("%c \t-"+key,"color: #777");Object.keys(msg[key]).forEach(function(k){console.log("%c \t  "+k+" : %c"+msg[key][k],"color: #777","color: #f23; font-weight: bold")})}else{console.log("%c \t"+key+" : %c"+msg[key],"color: #777","color: #f23; font-weight: bold")}});console.log("\n");if(pushSendDataQueue.length>0){console.log("%c   SEND QUEUE","color: #444");console.log("\n");Object.keys(pushSendDataQueue).forEach(function(key){if(typeof pushSendDataQueue[key]==="object"){console.log("%c \t-"+key,"color: #777");Object.keys(pushSendDataQueue[key]).forEach(function(k){console.log("%c \t  "+k+" : %c"+JSON.stringify(pushSendDataQueue[key][k]),"color: #777","color: #999; font-weight: bold")})}else{console.log("%c \t"+key+" : %c"+pushSendDataQueue[key],"color: #777","color: #999; font-weight: bold")}})}else{console.log("%c   SEND QUEUE\t\t %cEmpty","color: #444","color: #000; font-weight: bold")}console.log("\n");console.log("%c ","font-weight: bold; font-size: 3px; border-left: solid 540px "+ColorCSS+";");console.log("\n")}break}};this.asyncStepLogger=function(message){if(typeof navigator=="undefined"){console.log("[90m     [0m[90m%s[0m",message)}else{console.log("%c   "+message,"border-left: solid #666 10px; color: #666;")}}}if(typeof module!=="undefined"&&typeof module.exports!="undefined"){module.exports=Utility}else{if(!window.POD){window.POD={}}window.POD.AsyncUtility=Utility}})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],46:[function(require,module,exports){(function(){var Async,ChatUtility,Dexie;function Chat(params){if(typeof require!=="undefined"&&typeof exports!=="undefined"){Async=require("podasync-ws-only"),ChatUtility=require("./utility/utility.js"),Dexie=require("dexie").default||require("dexie");var QueryString=require("querystring")}else{Async=window.POD.Async,ChatUtility=window.POD.ChatUtility,Dexie=window.Dexie}var Utility=new ChatUtility;var asyncClient,peerId,oldPeerId,userInfo,token=params.token,generalTypeCode=params.typeCode||"default",mapApiKey=params.mapApiKey||"8b77db18704aa646ee5aaea13e7370f4f88b9e8c",deviceId,productEnv=typeof navigator!="undefined"?navigator.product:"undefined",db,queueDb,hasCache=productEnv!="ReactNative"&&typeof Dexie!="undefined",enableCache=params.enableCache&&typeof params.enableCache==="boolean"?params.enableCache:false,canUseCache=hasCache&&enableCache,isCacheReady=false,cacheDeletingInProgress=false,cacheExpireTime=params.cacheExpireTime||2*24*60*60*1e3,cacheSecret="",cacheSyncWorker,grantDeviceIdFromSSO=params.grantDeviceIdFromSSO&&typeof params.grantDeviceIdFromSSO==="boolean"?params.grantDeviceIdFromSSO:false,eventCallbacks={connect:{},disconnect:{},reconnect:{},messageEvents:{},threadEvents:{},contactEvents:{},botEvents:{},fileUploadEvents:{},systemEvents:{},chatReady:{},error:{},chatState:{}},messagesCallbacks={},sendMessageCallbacks={},threadCallbacks={},chatMessageVOTypes={CREATE_THREAD:1,MESSAGE:2,SENT:3,DELIVERY:4,SEEN:5,PING:6,BLOCK:7,UNBLOCK:8,LEAVE_THREAD:9,ADD_PARTICIPANT:11,GET_STATUS:12,GET_CONTACTS:13,GET_THREADS:14,GET_HISTORY:15,CHANGE_TYPE:16,REMOVED_FROM_THREAD:17,REMOVE_PARTICIPANT:18,MUTE_THREAD:19,UNMUTE_THREAD:20,UPDATE_THREAD_INFO:21,FORWARD_MESSAGE:22,USER_INFO:23,USER_STATUS:24,GET_BLOCKED:25,RELATION_INFO:26,THREAD_PARTICIPANTS:27,EDIT_MESSAGE:28,DELETE_MESSAGE:29,THREAD_INFO_UPDATED:30,LAST_SEEN_UPDATED:31,GET_MESSAGE_DELEVERY_PARTICIPANTS:32,GET_MESSAGE_SEEN_PARTICIPANTS:33,BOT_MESSAGE:40,SPAM_PV_THREAD:41,SET_ROLE_TO_USER:42,CLEAR_HISTORY:44,SYSTEM_MESSAGE:46,GET_NOT_SEEN_DURATION:47,LOGOUT:100,ERROR:999},inviteeVOidTypes={TO_BE_USER_SSO_ID:1,TO_BE_USER_CONTACT_ID:2,TO_BE_USER_CELLPHONE_NUMBER:3,TO_BE_USER_USERNAME:4,TO_BE_USER_ID:5},createThreadTypes={NORMAL:0,OWNER_GROUP:1,PUBLIC_GROUP:2,CHANNEL_GROUP:4,CHANNEL:8,NOTIFICATION_CHANNEL:16},systemMessageTypes={IS_TYPING:"1",RECORD_VOICE:"2",UPLOAD_PICTURE:"3",UPLOAD_VIDEO:"4",UPLOAD_SOUND:"5",UPLOAD_FILE:"6"},systemMessageIntervalPitch=params.systemMessageIntervalPitch||1e3,isTypingInterval,recordingVoiceInterval,upoadingInterval,protocol=params.protocol||"websocket",queueHost=params.queueHost,queuePort=params.queuePort,queueUsername=params.queueUsername,queuePassword=params.queuePassword,queueReceive=params.queueReceive,queueSend=params.queueSend,queueConnectionTimeout=params.queueConnectionTimeout,socketAddress=params.socketAddress,serverName=params.serverName||"",wsConnectionWaitTime=params.wsConnectionWaitTime,connectionRetryInterval=params.connectionRetryInterval,msgPriority=params.msgPriority||1,messageTtl=params.messageTtl||1e4,reconnectOnClose=params.reconnectOnClose,asyncLogging=params.asyncLogging,chatPingMessageInterval=2e4,sendPingTimeout,getUserInfoTimeout,config={getHistoryCount:50},SERVICE_ADDRESSES={SSO_ADDRESS:params.ssoHost||"http://172.16.110.76",PLATFORM_ADDRESS:params.platformHost||"http://172.16.106.26:8080/hamsam",FILESERVER_ADDRESS:params.fileServer||"http://172.16.106.26:8080/hamsam",POD_DRIVE_ADDRESS:params.podDrive||"http://172.16.106.26:8080/hamsam",MAP_ADDRESS:params.mapServer||"https://api.neshan.org/v1"},SERVICES_PATH={SSO_DEVICES:"/oauth2/grants/devices",SSO_GENERATE_KEY:"/handshake/users/",SSO_GET_KEY:"/handshake/keys/",ADD_CONTACTS:"/nzh/addContacts",UPDATE_CONTACTS:"/nzh/updateContacts",REMOVE_CONTACTS:"/nzh/removeContacts",SEARCH_CONTACTS:"/nzh/listContacts",UPLOAD_IMAGE:"/nzh/uploadImage",GET_IMAGE:"/nzh/image/",UPLOAD_FILE:"/nzh/uploadFile",GET_FILE:"/nzh/file/",DRIVE_UPLOAD_FILE:"/nzh/drive/uploadFile",DRIVE_UPLOAD_FILE_FROM_URL:"/nzh/drive/uploadFileFromUrl",DRIVE_UPLOAD_IMAGE:"/nzh/drive/uploadImage",DRIVE_DOWNLOAD_FILE:"/nzh/drive/downloadFile",DRIVE_DOWNLOAD_IMAGE:"/nzh/drive/downloadImage",REVERSE:"/reverse",SEARCH:"/search",ROUTING:"/routing",STATIC_IMAGE:"/static"},imageMimeTypes=["image/bmp","image/png","image/tiff","image/gif","image/x-icon","image/jpeg","image/webp"],imageExtentions=["bmp","png","tiff","tiff2","gif","ico","jpg","jpeg","webp"],CHAT_ERRORS={6e3:"No Active Device found for this Token!",6001:"Invalid Token!",6002:"User not found!",6100:"Cant get UserInfo!",6101:"Getting User Info Retry Count exceeded 5 times; Connection Can Not Been Estabilished!",6200:"Network Error",6201:"URL is not clarified!",6300:"Error in uploading File!",6301:"Not an image!",6302:"No file has been selected!",6303:"File upload has been canceled!",6600:"Your Environment doesn't have Databse compatibility",6601:"Database is not defined! (missing db)",6602:"Database Error",6700:'You should Enter a Center Location like {lat: " ", lng: " "}'},getUserInfoRetry=5,getUserInfoRetryCount=0,asyncStateTypes={0:"CONNECTING",1:"CONNECTED",2:"CLOSING",3:"CLOSED"},chatState=false,chatFullStateObject={},httpRequestObject={},connectionCheckTimeout=params.connectionCheckTimeout,connectionCheckTimeoutThreshold=params.connectionCheckTimeoutThreshold,httpRequestTimeout=params.httpRequestTimeout||2e4,actualTimingLog=params.asyncLogging.actualTiming&&typeof params.asyncLogging.actualTiming==="boolean"?params.asyncLogging.actualTiming:false,minIntegerValue=Number.MAX_SAFE_INTEGER*-1,maxIntegerValue=Number.MAX_SAFE_INTEGER*1,chatSendQueue=[],chatWaitQueue=[],chatUploadQueue=[],chatSendQueueHandlerTimeout,fullResponseObject=params.fullResponseObject||false;var init=function(){startCacheDatabases(function(){if(grantDeviceIdFromSSO){var getDeviceIdWithTokenTime=(new Date).getTime();getDeviceIdWithToken(function(retrievedDeviceId){if(actualTimingLog){Utility.chatStepLogger("Get Device ID ",(new Date).getTime()-getDeviceIdWithTokenTime)}deviceId=retrievedDeviceId;initAsync()})}else{initAsync()}})},initAsync=function(){var asyncGetReadyTime=(new Date).getTime();asyncClient=new Async({protocol:protocol,queueHost:queueHost,queuePort:queuePort,queueUsername:queueUsername,queuePassword:queuePassword,queueReceive:queueReceive,queueSend:queueSend,queueConnectionTimeout:queueConnectionTimeout,socketAddress:socketAddress,serverName:serverName,deviceId:deviceId,wsConnectionWaitTime:wsConnectionWaitTime,connectionRetryInterval:connectionRetryInterval,connectionCheckTimeout:connectionCheckTimeout,connectionCheckTimeoutThreshold:connectionCheckTimeoutThreshold,messageTtl:messageTtl,reconnectOnClose:reconnectOnClose,asyncLogging:asyncLogging});asyncClient.on("asyncReady",function(){if(actualTimingLog){Utility.chatStepLogger("Async Connection ",(new Date).getTime()-asyncGetReadyTime)}peerId=asyncClient.getPeerId();if(!userInfo){var getUserInfoTime=(new Date).getTime();getUserInfo(function(userInfoResult){if(actualTimingLog){Utility.chatStepLogger("Get User Info ",(new Date).getTime()-getUserInfoTime)}if(!userInfoResult.hasError){userInfo=userInfoResult.result.user;getAllThreadList({summary:true,cache:false});if(canUseCache){if(db){db.users.where("id").equals(parseInt(userInfo.id)).toArray().then(function(users){if(users.length>0&&typeof users[0].keyId!="undefined"){var user=users[0];getEncryptionKey({keyId:user.keyId},function(result){if(!result.hasError){cacheSecret=result.secretKey;chatState=true;fireEvent("chatReady");chatSendQueueHandler()}else{if(result.message!=""){try{var response=JSON.parse(result.message);if(response.error=="invalid_param"){generateEncryptionKey({keyAlgorithm:"AES",keySize:256})}}catch(e){console.log(e)}}}})}else{generateEncryptionKey({keyAlgorithm:"AES",keySize:256},function(){chatState=true;fireEvent("chatReady");chatSendQueueHandler()})}}).catch(function(error){fireEvent("error",{code:error.errorCode,message:error.errorMessage,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}else{chatState=true;fireEvent("chatReady");chatSendQueueHandler()}}})}else if(userInfo.id>0){chatState=true;fireEvent("chatReady");chatSendQueueHandler()}});asyncClient.on("stateChange",function(state){fireEvent("chatState",state);chatFullStateObject=state;switch(state.socketState){case 1:if(state.deviceRegister&&state.serverRegister){chatState=true;ping()}break;case 0:case 2:case 3:chatState=false;break}});asyncClient.on("connect",function(newPeerId){asyncGetReadyTime=(new Date).getTime();peerId=newPeerId;fireEvent("connect");ping()});asyncClient.on("disconnect",function(event){oldPeerId=peerId;peerId=undefined;fireEvent("disconnect",event)});asyncClient.on("reconnect",function(newPeerId){peerId=newPeerId;fireEvent("reconnect")});asyncClient.on("message",function(params,ack){receivedAsyncMessageHandler(params);ack&&ack()});asyncClient.on("error",function(error){fireEvent("error",{code:error.errorCode,message:error.errorMessage,error:error.errorEvent})})},getDeviceIdWithToken=function(callback){var deviceId;var params={url:SERVICE_ADDRESSES.SSO_ADDRESS+SERVICES_PATH.SSO_DEVICES,method:"GET",headers:{Authorization:"Bearer "+token}};httpRequest(params,function(result){if(!result.hasError){var devices=JSON.parse(result.result.responseText).devices;if(devices&&devices.length>0){for(var i=0;i<devices.length;i++){if(devices[i].current){deviceId=devices[i].uid;break}}if(!deviceId){fireEvent("error",{code:6e3,message:CHAT_ERRORS[6e3],error:null})}else{callback(deviceId)}}else{fireEvent("error",{code:6001,message:CHAT_ERRORS[6001],error:null})}}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})},generateEncryptionKey=function(params,callback){var data={validity:10*365*24*60*60,renew:false,keyAlgorithm:"aes",keySize:256};if(params){if(params.keyAlgorithm!="undefined"){data.keyAlgorithm=params.keyAlgorithm}if(parseInt(params.keySize)>0){data.keySize=params.keySize}}var httpRequestParams={url:SERVICE_ADDRESSES.SSO_ADDRESS+SERVICES_PATH.SSO_GENERATE_KEY,method:"POST",data:data,headers:{Authorization:"Bearer "+token}};httpRequest(httpRequestParams,function(result){if(!result.hasError){try{var response=JSON.parse(result.result.responseText)}catch(e){console.log(e)}if(canUseCache){if(db){db.users.update(userInfo.id,{keyId:response.keyId}).then(function(){getEncryptionKey({keyId:response.keyId},function(result){if(!result.hasError){cacheSecret=result.secretKey;callback&&callback()}})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}else{fireEvent("error",{code:result.error,message:result.error_description,error:result})}})},getEncryptionKey=function(params,callback){var keyId;if(params){if(params.keyId!="undefined"){keyId=params.keyId;var httpRequestParams={url:SERVICE_ADDRESSES.SSO_ADDRESS+SERVICES_PATH.SSO_GET_KEY+keyId,method:"GET",headers:{Authorization:"Bearer "+token}};httpRequest(httpRequestParams,function(result){if(!result.hasError){try{var response=JSON.parse(result.result.responseText)}catch(e){console.log(e)}callback&&callback({hasError:false,secretKey:response.secretKey})}else{callback&&callback({hasError:true,code:result.errorCode,message:result.errorMessage});fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})}}},httpRequest=function(params,callback){var url=params.url,fileSize,originalFileName,threadId,fileUniqueId,fileObject,data=params.data,method=typeof params.method=="string"?params.method:"GET",fileUploadUniqueId=typeof params.uniqueId=="string"?params.uniqueId:"uniqueId",hasError=false;if(!url){callback({hasError:true,errorCode:6201,errorMessage:CHAT_ERRORS[6201]});return}var hasFile=false;httpRequestObject[eval("fileUploadUniqueId")]=new XMLHttpRequest,settings=params.settings;httpRequestObject[eval("fileUploadUniqueId")].timeout=settings&&typeof parseInt(settings.timeout)>0&&settings.timeout>0?settings.timeout:httpRequestTimeout;httpRequestObject[eval("fileUploadUniqueId")].addEventListener("error",function(event){if(callback){if(hasFile){hasError=true;fireEvent("fileUploadEvents",{threadId:threadId,uniqueId:fileUniqueId,state:"UPLOAD_ERROR",progress:0,fileInfo:{fileName:originalFileName,fileSize:fileSize},fileObject:fileObject,errorCode:6200,errorMessage:CHAT_ERRORS[6200]+" (XMLHttpRequest Error Event Listener)"})}callback({hasError:true,errorCode:6200,errorMessage:CHAT_ERRORS[6200]+" (XMLHttpRequest Error Event Listener)"})}},false);httpRequestObject[eval("fileUploadUniqueId")].addEventListener("abort",function(event){if(callback){if(hasFile){hasError=true;fireEvent("fileUploadEvents",{threadId:threadId,uniqueId:fileUniqueId,state:"UPLOAD_CANCELED",progress:0,fileInfo:{fileName:originalFileName,fileSize:fileSize},fileObject:fileObject,errorCode:6303,errorMessage:CHAT_ERRORS[6303]})}callback({hasError:true,errorCode:6303,errorMessage:CHAT_ERRORS[6303]})}},false);try{if(method=="GET"){if(typeof data==="object"&&data!==null){var keys=Object.keys(data);if(keys.length>0){url+="?";for(var i=0;i<keys.length;i++){var key=keys[i];url+=key+"="+data[key];if(i<keys.length-1){url+="&"}}}}else if(typeof data==="string"&&data!==null){url+="?"+data}httpRequestObject[eval("fileUploadUniqueId")].open(method,url,true);if(typeof params.headers==="object"){for(var key in params.headers){httpRequestObject[eval("fileUploadUniqueId")].setRequestHeader(key,params.headers[key])}}httpRequestObject[eval("fileUploadUniqueId")].send()}if(method==="POST"&&data){httpRequestObject[eval("fileUploadUniqueId")].open(method,url,true);if(typeof params.headers==="object"){for(var key in params.headers){httpRequestObject[eval("fileUploadUniqueId")].setRequestHeader(key,params.headers[key])}}if(typeof data=="object"){if(data.hasOwnProperty("image")||data.hasOwnProperty("file")){hasFile=true;var formData=new FormData;for(var key in data){formData.append(key,data[key])}fileSize=data.fileSize;originalFileName=data.originalFileName;threadId=data.threadId;fileUniqueId=data.uniqueId;fileObject=data["image"]?data["image"]:data["file"];httpRequestObject[eval("fileUploadUniqueId")].upload.onprogress=function(event){if(event.lengthComputable&&!hasError){fireEvent("fileUploadEvents",{threadId:threadId,uniqueId:fileUniqueId,state:"UPLOADING",progress:Math.round(event.loaded/event.total*100),fileInfo:{fileName:originalFileName,fileSize:fileSize},fileObject:fileObject})}};httpRequestObject[eval("fileUploadUniqueId")].send(formData)}else{httpRequestObject[eval("fileUploadUniqueId")].setRequestHeader("Content-Type","application/x-www-form-urlencoded");var keys=Object.keys(data);if(keys.length>0){sendData="";for(var i=0;i<keys.length;i++){var key=keys[i];sendData+=key+"="+data[key];if(i<keys.length-1){sendData+="&"}}}httpRequestObject[eval("fileUploadUniqueId")].send(sendData)}}else{httpRequestObject[eval("fileUploadUniqueId")].send(data)}}}catch(e){callback&&callback({hasError:true,cache:false,errorCode:6200,errorMessage:CHAT_ERRORS[6200]+" (Request Catch Error)"+e})}httpRequestObject[eval("fileUploadUniqueId")].onreadystatechange=function(){if(httpRequestObject[eval("fileUploadUniqueId")].readyState==4){if(httpRequestObject[eval("fileUploadUniqueId")].status==200){if(hasFile){hasError=false;fireEvent("fileUploadEvents",{threadId:threadId,uniqueId:fileUniqueId,state:"UPLOADED",progress:100,fileInfo:{fileName:originalFileName,fileSize:fileSize},fileObject:fileObject})}callback&&callback({hasError:false,cache:false,result:{responseText:httpRequestObject[eval("fileUploadUniqueId")].responseText,responseHeaders:httpRequestObject[eval("fileUploadUniqueId")].getAllResponseHeaders()}})}else{if(hasFile){hasError=true;fireEvent("fileUploadEvents",{threadId:threadId,uniqueId:fileUniqueId,state:"UPLOAD_ERROR",progress:0,fileInfo:{fileName:originalFileName,fileSize:fileSize},fileObject:fileObject,errorCode:6200,errorMessage:CHAT_ERRORS[6200]+" (Request Status != 200)",statusCode:httpRequestObject[eval("fileUploadUniqueId")].status})}callback&&callback({hasError:true,errorMessage:httpRequestObject[eval("fileUploadUniqueId")].responseText,errorCode:httpRequestObject[eval("fileUploadUniqueId")].status})}}}},getUserInfo=function getUserInfoRecursive(callback){getUserInfoRetryCount++;if(getUserInfoRetryCount>getUserInfoRetry){getUserInfoTimeout&&clearTimeout(getUserInfoTimeout);getUserInfoRetryCount=0;fireEvent("error",{code:6101,message:CHAT_ERRORS[6101],error:null})}else{getUserInfoTimeout&&clearTimeout(getUserInfoTimeout);getUserInfoTimeout=setTimeout(function(){getUserInfoRecursive(callback)},getUserInfoRetryCount*1e4);return sendMessage({chatMessageVOType:chatMessageVOTypes.USER_INFO,typeCode:params.typeCode},{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){getUserInfoTimeout&&clearTimeout(getUserInfoTimeout);var messageContent=result.result;var currentUser=formatDataToMakeUser(messageContent);if(canUseCache){if(db){db.users.where("id").equals(parseInt(currentUser.id)).toArray().then(function(users){if(users.length>0&&users[0].id>0){db.users.update(currentUser.id,{cellphoneNumber:currentUser.cellphoneNumber,email:currentUser.email,image:currentUser.image,name:currentUser.name}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{db.users.put(currentUser).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}resultData={user:currentUser};returnData.result=resultData;getUserInfoRetryCount=0;callback&&callback(returnData);callback=undefined}}})}},sendMessage=function(params,callbacks,recursiveCallback){var asyncPriority=params.asyncPriority>0?params.asyncPriority:msgPriority;var messageVO={type:params.chatMessageVOType,token:token,tokenIssuer:1};var threadId=params.subjectId;if(params.typeCode){messageVO.typeCode=params.typeCode}else if(generalTypeCode){messageVO.typeCode=generalTypeCode}if(params.messageType){messageVO.messageType=params.messageType}if(params.subjectId){messageVO.subjectId=params.subjectId}if(params.content){if(typeof params.content=="object"){messageVO.content=JSON.stringify(params.content)}else{messageVO.content=params.content}}if(params.metadata){messageVO.metadata=params.metadata}if(params.systemMetadata){messageVO.systemMetadata=params.systemMetadata}if(params.repliedTo){messageVO.repliedTo=params.repliedTo}var uniqueId;if(typeof params.uniqueId!="undefined"){uniqueId=params.uniqueId}else if(params.chatMessageVOType!==chatMessageVOTypes.PING){uniqueId=Utility.generateUUID()}if(Array.isArray(uniqueId)){messageVO.uniqueId=JSON.stringify(uniqueId)}else{messageVO.uniqueId=uniqueId}if(typeof callbacks=="object"){if(callbacks.onSeen||callbacks.onDeliver||callbacks.onSent){if(!threadCallbacks[threadId]){threadCallbacks[threadId]={}}threadCallbacks[threadId][uniqueId]={};sendMessageCallbacks[uniqueId]={};if(callbacks.onSent){sendMessageCallbacks[uniqueId].onSent=callbacks.onSent;threadCallbacks[threadId][uniqueId].onSent=false;threadCallbacks[threadId][uniqueId].uniqueId=uniqueId}if(callbacks.onSeen){sendMessageCallbacks[uniqueId].onSeen=callbacks.onSeen;threadCallbacks[threadId][uniqueId].onSeen=false}if(callbacks.onDeliver){sendMessageCallbacks[uniqueId].onDeliver=callbacks.onDeliver;threadCallbacks[threadId][uniqueId].onDeliver=false}}else if(callbacks.onResult){messagesCallbacks[uniqueId]=callbacks.onResult}}else if(typeof callbacks=="function"){messagesCallbacks[uniqueId]=callbacks}var data={type:parseInt(params.pushMsgType)>0?params.pushMsgType:3,content:{peerName:serverName,priority:asyncPriority,content:JSON.stringify(messageVO),ttl:params.messageTtl>0?params.messageTtl:messageTtl}};asyncClient.send(data,function(res){if(res.hasError&&callbacks){if(typeof callbacks=="function"){callbacks(res)}else if(typeof callbacks=="object"&&typeof callbacks.onResult=="function"){callbacks.onResult(res)}if(messagesCallbacks[uniqueId]){delete messagesCallbacks[uniqueId]}}});sendPingTimeout&&clearTimeout(sendPingTimeout);sendPingTimeout=setTimeout(function(){ping()},chatPingMessageInterval);recursiveCallback&&recursiveCallback();return{uniqueId:uniqueId,threadId:threadId,participant:userInfo,content:params.content}},sendSystemMessage=function(params){return sendMessage({chatMessageVOType:chatMessageVOTypes.SYSTEM_MESSAGE,subjectId:params.subjectId,content:params.content,uniqueId:params.uniqueId,pushMsgType:4})},chatSendQueueHandler=function(){chatSendQueueHandlerTimeout&&clearTimeout(chatSendQueueHandlerTimeout);if(chatSendQueue.length){var messageToBeSend=chatSendQueue[0];if(chatState){getChatSendQueue(0,function(chatSendQueue){deleteFromChatSentQueue(messageToBeSend,function(){sendMessage(messageToBeSend.message,messageToBeSend.callbacks,function(){if(chatSendQueue.length){chatSendQueueHandler()}})})})}}},ping=function(){if(chatState&&userInfo!==undefined){sendMessage({chatMessageVOType:chatMessageVOTypes.PING,pushMsgType:5})}else{sendPingTimeout&&clearTimeout(sendPingTimeout)}},clearChatServerCaches=function(){sendMessage({chatMessageVOType:chatMessageVOTypes.LOGOUT,pushMsgType:4})},receivedAsyncMessageHandler=function(asyncMessage){var content=JSON.parse(asyncMessage.content);chatMessageHandler(content)},chatMessageHandler=function(chatMessage){var threadId=chatMessage.subjectId,type=chatMessage.type,messageContent=typeof chatMessage.content==="string"?JSON.parse(chatMessage.content):{},contentCount=chatMessage.contentCount,uniqueId=chatMessage.uniqueId;switch(type){case chatMessageVOTypes.CREATE_THREAD:messageContent.uniqueId=uniqueId;createThread(messageContent,true);if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.MESSAGE:newMessageHandler(threadId,messageContent);break;case chatMessageVOTypes.SENT:if(sendMessageCallbacks[uniqueId]&&sendMessageCallbacks[uniqueId].onSent){sendMessageCallbacks[uniqueId].onSent({uniqueId:uniqueId});delete sendMessageCallbacks[uniqueId].onSent;threadCallbacks[threadId][uniqueId].onSent=true}break;case chatMessageVOTypes.DELIVERY:if(fullResponseObject){getHistory({offset:0,threadId:threadId,id:messageContent.messageId,cache:false},function(result){if(!result.hasError){fireEvent("messageEvents",{type:"MESSAGE_DELIVERY",result:{message:result.result.history[0],threadId:threadId,senderId:messageContent.participantId}})}})}else{fireEvent("messageEvents",{type:"MESSAGE_DELIVERY",result:{message:messageContent.messageId,threadId:threadId,senderId:messageContent.participantId}})}sendMessageCallbacksHandler(chatMessageVOTypes.DELIVERY,threadId,uniqueId);break;case chatMessageVOTypes.SEEN:if(fullResponseObject){getHistory({offset:0,threadId:threadId,id:messageContent.messageId,cache:false},function(result){if(!result.hasError){fireEvent("messageEvents",{type:"MESSAGE_SEEN",result:{message:result.result.history[0],threadId:threadId,senderId:messageContent.participantId}})}})}else{fireEvent("messageEvents",{type:"MESSAGE_SEEN",result:{message:messageContent.messageId,threadId:threadId,senderId:messageContent.participantId}})}sendMessageCallbacksHandler(chatMessageVOTypes.SEEN,threadId,uniqueId);break;case chatMessageVOTypes.PING:break;case chatMessageVOTypes.BLOCK:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.UNBLOCK:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.LEAVE_THREAD:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}if(canUseCache){if(db){db.participants.where("threadId").equals(parseInt(threadId)).and(function(participant){return participant.id==messageContent.id||participant.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})});if(messageContent.id==userInfo.id){db.threads.where("[owner+id]").equals([userInfo.id,threadId]).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})});db.messages.where("threadId").equals(parseInt(threadId)).and(function(message){return message.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}if(fullResponseObject){getThreads({threadIds:[threadId]},function(threadsResult){if(!threadsResult.cache){var threads=threadsResult.result.threads;if(threads.length>0){fireEvent("threadEvents",{type:"THREAD_LEAVE_PARTICIPANT",result:{thread:threads[0],participant:formatDataToMakeParticipant(messageContent,threadId)}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threads[0]}})}else{fireEvent("threadEvents",{type:"THREAD_LEAVE_PARTICIPANT",result:{threadId:threadId,participant:formatDataToMakeParticipant(messageContent,threadId)}})}}})}else{fireEvent("threadEvents",{type:"THREAD_LEAVE_PARTICIPANT",result:{thread:threadId,participant:formatDataToMakeParticipant(messageContent,threadId)}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threadId}})}break;case chatMessageVOTypes.ADD_PARTICIPANT:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<messageContent.participants.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=messageContent.participants[i].id;tempData.owner=userInfo.id;tempData.threadId=messageContent.id;tempData.notSeenDuration=messageContent.participants[i].notSeenDuration;tempData.admin=messageContent.participants[i].admin;tempData.name=Utility.crypt(messageContent.participants[i].name,cacheSecret,salt);tempData.contactName=Utility.crypt(messageContent.participants[i].contactName,cacheSecret,salt);tempData.email=Utility.crypt(messageContent.participants[i].email,cacheSecret,salt);tempData.expireTime=(new Date).getTime()+cacheExpireTime;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(messageContent.participants[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.participants.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}if(fullResponseObject){getThreads({threadIds:[messageContent.id]},function(threadsResult){var threads=threadsResult.result.threads;if(!threadsResult.cache){fireEvent("threadEvents",{type:"THREAD_ADD_PARTICIPANTS",result:{thread:threads[0]}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threads[0]}})}})}else{fireEvent("threadEvents",{type:"THREAD_ADD_PARTICIPANTS",result:{thread:messageContent.id}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:messageContent.id}})}break;case chatMessageVOTypes.GET_CONTACTS:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.GET_THREADS:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.GET_HISTORY:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.REMOVED_FROM_THREAD:fireEvent("threadEvents",{type:"THREAD_REMOVED_FROM",result:{thread:threadId}});if(canUseCache){if(db){db.threads.where("[owner+id]").equals([userInfo.id,threadId]).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})});db.messages.where("threadId").equals(parseInt(threadId)).and(function(message){return message.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})});db.participants.where("threadId").equals(parseInt(threadId)).and(function(participant){return participant.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}break;case chatMessageVOTypes.REMOVE_PARTICIPANT:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}if(canUseCache){if(db){for(var i=0;i<messageContent.length;i++){db.participants.where("id").equals(parseInt(messageContent[i].id)).and(function(participants){return participants.threadId==threadId}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}if(fullResponseObject){getThreads({threadIds:[threadId]},function(threadsResult){var threads=threadsResult.result.threads;if(!threadsResult.cache){fireEvent("threadEvents",{type:"THREAD_REMOVE_PARTICIPANTS",result:{thread:threads[0]}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threads[0]}})}})}else{fireEvent("threadEvents",{type:"THREAD_REMOVE_PARTICIPANTS",result:{thread:threadId}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threadId}})}break;case chatMessageVOTypes.MUTE_THREAD:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}if(fullResponseObject){getThreads({threadIds:[threadId]},function(threadsResult){var thread=threadsResult.result.threads[0];thread.mute=true;fireEvent("threadEvents",{type:"THREAD_MUTE",result:{thread:thread}})})}else{fireEvent("threadEvents",{type:"THREAD_MUTE",result:{thread:threadId}})}break;case chatMessageVOTypes.UNMUTE_THREAD:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}if(fullResponseObject){getThreads({threadIds:[threadId]},function(threadsResult){var thread=threadsResult.result.threads[0];thread.mute=false;fireEvent("threadEvents",{type:"THREAD_UNMUTE",result:{thread:thread}})})}else{fireEvent("threadEvents",{type:"THREAD_UNMUTE",result:{thread:threadId}})}break;case chatMessageVOTypes.UPDATE_THREAD_INFO:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}if(fullResponseObject){getThreads({threadIds:[messageContent.id],cache:false},function(threadsResult){var thread=formatDataToMakeConversation(threadsResult.result.threads[0]);if(canUseCache&&cacheSecret.length>0){if(db){var tempData={};try{var salt=Utility.generateUUID();tempData.id=thread.id;tempData.owner=userInfo.id;tempData.title=Utility.crypt(thread.title,cacheSecret,salt);tempData.time=thread.time;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(thread)),cacheSecret,salt);tempData.salt=salt}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}db.threads.put(tempData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}fireEvent("threadEvents",{type:"THREAD_INFO_UPDATED",result:{thread:thread}})})}else{fireEvent("threadEvents",{type:"THREAD_INFO_UPDATED",result:{thread:messageContent.id}})}break;case chatMessageVOTypes.FORWARD_MESSAGE:newMessageHandler(threadId,messageContent);break;case chatMessageVOTypes.USER_INFO:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.GET_BLOCKED:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.THREAD_PARTICIPANTS:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.EDIT_MESSAGE:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}chatEditMessageHandler(threadId,messageContent);break;case chatMessageVOTypes.DELETE_MESSAGE:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}if(canUseCache&&cacheSecret.length>0){if(db){db.messages.where("id").equals(messageContent).and(function(message){return message.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:6602,message:CHAT_ERRORS[6602],error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}fireEvent("messageEvents",{type:"MESSAGE_DELETE",result:{message:{id:messageContent,threadId:threadId}}});break;case chatMessageVOTypes.THREAD_INFO_UPDATED:var thread=formatDataToMakeConversation(messageContent);if(canUseCache&&cacheSecret.length>0){if(db){var tempData={};try{var salt=Utility.generateUUID();tempData.id=thread.id;tempData.owner=userInfo.id;tempData.title=Utility.crypt(thread.title,cacheSecret,salt);tempData.time=thread.time;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(thread)),cacheSecret,salt);tempData.salt=salt}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}db.threads.put(tempData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}fireEvent("threadEvents",{type:"THREAD_INFO_UPDATED",result:{thread:thread}});break;case chatMessageVOTypes.LAST_SEEN_UPDATED:if(fullResponseObject){getThreads({threadIds:[messageContent.conversationId]},function(threadsResult){var threads=threadsResult.result.threads;if(!threadsResult.cache){fireEvent("threadEvents",{type:"THREAD_UNREAD_COUNT_UPDATED",result:{thread:threads[0],messageId:messageContent.messageId,senderId:messageContent.participantId}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threads[0]}})}})}else{fireEvent("threadEvents",{type:"THREAD_UNREAD_COUNT_UPDATED",result:{thread:threadId,messageId:messageContent.messageId,senderId:messageContent.participantId}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threadId}})}break;case chatMessageVOTypes.GET_MESSAGE_DELEVERY_PARTICIPANTS:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.GET_MESSAGE_SEEN_PARTICIPANTS:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent,contentCount))}break;case chatMessageVOTypes.BOT_MESSAGE:fireEvent("botEvents",{type:"BOT_MESSAGE",result:{bot:messageContent}});break;case chatMessageVOTypes.SPAM_PV_THREAD:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.SET_ROLE_TO_USER:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.CLEAR_HISTORY:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.SYSTEM_MESSAGE:fireEvent("systemEvents",{type:"IS_TYPING",result:{thread:threadId,user:messageContent}});break;case chatMessageVOTypes.GET_NOT_SEEN_DURATION:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(false,"",0,messageContent))}break;case chatMessageVOTypes.ERROR:if(messagesCallbacks[uniqueId]){messagesCallbacks[uniqueId](Utility.createReturnData(true,messageContent.message,messageContent.code,messageContent,0))}if(messageContent.code==21){}fireEvent("error",{code:messageContent.code,message:messageContent.message,error:messageContent});break}},sendMessageCallbacksHandler=function(actionType,threadId,uniqueId){switch(actionType){case chatMessageVOTypes.DELIVERY:if(threadCallbacks[threadId]){var lastThreadCallbackIndex=Object.keys(threadCallbacks[threadId]).indexOf(uniqueId);if(lastThreadCallbackIndex!==undefined){while(lastThreadCallbackIndex>-1){var tempUniqueId=Object.entries(threadCallbacks[threadId])[lastThreadCallbackIndex][0];if(sendMessageCallbacks[tempUniqueId]&&sendMessageCallbacks[tempUniqueId].onDeliver){if(threadCallbacks[threadId][tempUniqueId]&&threadCallbacks[threadId][tempUniqueId].onSent){sendMessageCallbacks[tempUniqueId].onDeliver({uniqueId:tempUniqueId});delete sendMessageCallbacks[tempUniqueId].onDeliver;threadCallbacks[threadId][tempUniqueId].onDeliver=true}}lastThreadCallbackIndex-=1}}}break;case chatMessageVOTypes.SEEN:if(threadCallbacks[threadId]){var lastThreadCallbackIndex=Object.keys(threadCallbacks[threadId]).indexOf(uniqueId);if(lastThreadCallbackIndex!==undefined){while(lastThreadCallbackIndex>-1){var tempUniqueId=Object.entries(threadCallbacks[threadId])[lastThreadCallbackIndex][0];if(sendMessageCallbacks[tempUniqueId]&&sendMessageCallbacks[tempUniqueId].onSeen){if(threadCallbacks[threadId][tempUniqueId]&&threadCallbacks[threadId][tempUniqueId].onSent){if(!threadCallbacks[threadId][tempUniqueId].onDeliver){sendMessageCallbacks[tempUniqueId].onDeliver({uniqueId:tempUniqueId});delete sendMessageCallbacks[tempUniqueId].onDeliver;threadCallbacks[threadId][tempUniqueId].onDeliver=true}sendMessageCallbacks[tempUniqueId].onSeen({uniqueId:tempUniqueId});delete sendMessageCallbacks[tempUniqueId].onSeen;threadCallbacks[threadId][tempUniqueId].onSeen=true;if(threadCallbacks[threadId][tempUniqueId].onSent&&threadCallbacks[threadId][tempUniqueId].onDeliver&&threadCallbacks[threadId][tempUniqueId].onSeen){delete threadCallbacks[threadId][tempUniqueId];delete sendMessageCallbacks[tempUniqueId]}}}lastThreadCallbackIndex-=1}}}break;default:break}},newMessageHandler=function(threadId,messageContent){var message=formatDataToMakeMessage(threadId,messageContent);deliver({messageId:message.id,ownerId:message.participant.id});if(canUseCache&&cacheSecret.length>0){if(db){var tempData={};try{var salt=Utility.generateUUID();tempData.id=parseInt(message.id);tempData.owner=parseInt(userInfo.id);tempData.threadId=parseInt(message.threadId);tempData.time=message.time;tempData.message=Utility.crypt(message.message,cacheSecret,salt);tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(message)),cacheSecret,salt);tempData.salt=salt;tempData.sendStatus="sent"}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}db.messages.put(tempData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}fireEvent("messageEvents",{type:"MESSAGE_NEW",cache:false,result:{message:message}});if(fullResponseObject){getThreads({threadIds:[threadId]},function(threadsResult){var threads=threadsResult.result.threads;fireEvent("threadEvents",{type:"THREAD_UNREAD_COUNT_UPDATED",result:{thread:threads[0],messageId:messageContent.id,senderId:messageContent.participant.id}});fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threads[0]}})})}else{fireEvent("threadEvents",{type:"THREAD_LAST_ACTIVITY_TIME",result:{thread:threadId}});fireEvent("threadEvents",{type:"THREAD_UNREAD_COUNT_UPDATED",result:{thread:threadId}})}if(hasCache&&typeof queueDb=="object"){queueDb.waitQ.where("uniqueId").equals(message.uniqueId).and(function(item){return item.owner==parseInt(userInfo.id)}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{for(var i=0;i<chatSendQueue.length;i++){if(chatSendQueue[i].uniqueId==message.uniqueId){chatSendQueue.splice(i,1)}}}},chatEditMessageHandler=function(threadId,messageContent){var message=formatDataToMakeMessage(threadId,messageContent);if(canUseCache&&cacheSecret.length>0){if(db){try{var tempData={},salt=Utility.generateUUID();tempData.id=parseInt(message.id);tempData.owner=parseInt(userInfo.id);tempData.threadId=parseInt(message.threadId);tempData.time=message.time;tempData.message=Utility.crypt(message.message,cacheSecret,salt);tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(message)),cacheSecret,salt);tempData.salt=salt;db.messages.put(tempData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}fireEvent("messageEvents",{type:"MESSAGE_EDIT",result:{message:message}})},createThread=function(messageContent,addFromService){var threadData=formatDataToMakeConversation(messageContent);if(addFromService){fireEvent("threadEvents",{type:"THREAD_NEW",result:{thread:threadData}});if(canUseCache&&cacheSecret.length>0){if(db){var tempData={};try{var salt=Utility.generateUUID();tempData.id=threadData.id;tempData.owner=userInfo.id;tempData.title=Utility.crypt(threadData.title,cacheSecret,salt);tempData.time=threadData.time;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(threadData)),cacheSecret,salt);tempData.salt=salt}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}db.threads.put(tempData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}return threadData},formatDataToMakeLinkedUser=function(messageContent){var linkedUser={coreUserId:messageContent.coreUserId,username:messageContent.username,nickname:messageContent.nickname,name:messageContent.name,image:messageContent.image};return linkedUser},formatDataToMakeContact=function(messageContent){var contact={id:messageContent.id,blocked:messageContent.blocked!==undefined?messageContent.blocked:false,userId:messageContent.userId,firstName:messageContent.firstName,lastName:messageContent.lastName,image:messageContent.profileImage,email:messageContent.email,cellphoneNumber:messageContent.cellphoneNumber,uniqueId:messageContent.uniqueId,notSeenDuration:messageContent.notSeenDuration,hasUser:messageContent.hasUser,linkedUser:undefined};if(messageContent.linkedUser!==undefined){contact.linkedUser=formatDataToMakeLinkedUser(messageContent.linkedUser)}return contact},formatDataToMakeUser=function(messageContent){var user={id:messageContent.id,name:messageContent.name,email:messageContent.email,cellphoneNumber:messageContent.cellphoneNumber,image:messageContent.image,lastSeen:messageContent.lastSeen,sendEnable:messageContent.sendEnable,receiveEnable:messageContent.receiveEnable};return user},formatDataToMakeBlockedUser=function(messageContent){var blockedUser={blockId:messageContent.id,firstName:messageContent.firstName,lastName:messageContent.lastName,nickName:messageContent.nickName,profileImage:messageContent.profileImage};return blockedUser},formatDataToMakeInvitee=function(messageContent){var inviteeData={id:messageContent.id,idType:inviteeVOidTypes[messageContent.idType]};return inviteeData},formatDataToMakeParticipant=function(messageContent,threadId){var participant={id:messageContent.id,coreUserId:messageContent.coreUserId,threadId:threadId,sendEnable:messageContent.sendEnable,receiveEnable:messageContent.receiveEnable,firstName:messageContent.firstName,lastName:messageContent.lastName,name:messageContent.name,cellphoneNumber:messageContent.cellphoneNumber,email:messageContent.email,image:messageContent.image,myFriend:messageContent.myFriend,online:messageContent.online,notSeenDuration:messageContent.notSeenDuration,contactId:messageContent.contactId,contactName:messageContent.contactName,contactFirstName:messageContent.contactFirstName,contactLastName:messageContent.contactLastName,blocked:messageContent.blocked,admin:messageContent.admin,keyId:messageContent.keyId,roles:messageContent.roles};return participant},formatDataToMakeConversation=function(messageContent){var conversation={id:messageContent.id,joinDate:messageContent.joinDate,title:messageContent.title,inviter:undefined,participants:undefined,time:messageContent.time,lastMessage:messageContent.lastMessage,lastParticipantName:messageContent.lastParticipantName,group:messageContent.group,partner:messageContent.partner,lastParticipantImage:messageContent.lastParticipantImage,image:messageContent.image,description:messageContent.description,unreadCount:messageContent.unreadCount,lastSeenMessageId:messageContent.lastSeenMessageId,lastSeenMessageTime:messageContent.lastSeenMessageNanos?parseInt(parseInt(messageContent.lastSeenMessageTime)/1e3)*1e9+parseInt(messageContent.lastSeenMessageNanos):parseInt(messageContent.lastSeenMessageTime),lastMessageVO:undefined,partnerLastSeenMessageId:messageContent.partnerLastSeenMessageId,partnerLastSeenMessageTime:messageContent.partnerLastSeenMessageNanos?parseInt(parseInt(messageContent.partnerLastSeenMessageTime)/1e3)*1e9+parseInt(messageContent.partnerLastSeenMessageNanos):parseInt(messageContent.partnerLastSeenMessageTime),partnerLastDeliveredMessageId:messageContent.partnerLastDeliveredMessageId,partnerLastDeliveredMessageTime:messageContent.partnerLastDeliveredMessageNanos?parseInt(parseInt(messageContent.partnerLastDeliveredMessageTime)/1e3)*1e9+parseInt(messageContent.partnerLastDeliveredMessageNanos):parseInt(messageContent.partnerLastDeliveredMessageTime),type:messageContent.type,metadata:messageContent.metadata,mute:messageContent.mute,participantCount:messageContent.participantCount,canEditInfo:messageContent.canEditInfo,canSpam:messageContent.canSpam,admin:messageContent.admin};if(messageContent.inviter){conversation.inviter=formatDataToMakeParticipant(messageContent.inviter,messageContent.id)}if(messageContent.participants&&Array.isArray(messageContent.participants)){conversation.participants=[];for(var i=0;i<messageContent.participants.length;i++){var participantData=formatDataToMakeParticipant(messageContent.participants[i],messageContent.id);if(participantData){conversation.participants.push(participantData)}}}if(messageContent.lastMessageVO){conversation.lastMessageVO=formatDataToMakeMessage(messageContent.id,messageContent.lastMessageVO)}return conversation},formatDataToMakeReplyInfo=function(messageContent,threadId){var replyInfo={deleted:messageContent.deleted,participant:undefined,repliedToMessageId:messageContent.repliedToMessageId,repliedToMessageTime:messageContent.repliedToMessageNanos?parseInt(parseInt(messageContent.repliedToMessageTime)/1e3)*1e9+parseInt(messageContent.repliedToMessageNanos):parseInt(messageContent.repliedToMessageTime),repliedToMessageTimeMiliSeconds:parseInt(messageContent.repliedToMessageTime),repliedToMessageTimeNanos:parseInt(messageContent.repliedToMessageNanos),message:messageContent.message,deleted:messageContent.deleted,messageType:messageContent.messageType,metadata:messageContent.metadata,systemMetadata:messageContent.systemMetadata};if(messageContent.participant){replyInfo.participant=formatDataToMakeParticipant(messageContent.participant,threadId)}return replyInfo},formatDataToMakeForwardInfo=function(messageContent,threadId){var forwardInfo={participant:undefined,conversation:undefined};if(messageContent.conversation){forwardInfo.conversation=formatDataToMakeConversation(messageContent.conversation)}if(messageContent.participant){forwardInfo.participant=formatDataToMakeParticipant(messageContent.participant,threadId)}return forwardInfo},formatDataToMakeMessage=function(threadId,pushMessageVO,fromCache){if(fromCache||pushMessageVO.time.toString().length>14){var time=pushMessageVO.time,timeMiliSeconds=parseInt(pushMessageVO.time/1e6)}else{var time=pushMessageVO.timeNanos?parseInt(parseInt(pushMessageVO.time)/1e3)*1e9+parseInt(pushMessageVO.timeNanos):parseInt(pushMessageVO.time),timeMiliSeconds=parseInt(pushMessageVO.time)}var message={id:pushMessageVO.id,threadId:threadId,ownerId:pushMessageVO.ownerId?pushMessageVO.ownerId:undefined,uniqueId:pushMessageVO.uniqueId,previousId:pushMessageVO.previousId,message:pushMessageVO.message,messageType:pushMessageVO.messageType,edited:pushMessageVO.edited,editable:pushMessageVO.editable,deletable:pushMessageVO.deletable,delivered:pushMessageVO.delivered,seen:pushMessageVO.seen,participant:undefined,conversation:undefined,replyInfo:undefined,forwardInfo:undefined,metadata:pushMessageVO.metadata,systemMetadata:pushMessageVO.systemMetadata,time:time,timeMiliSeconds:timeMiliSeconds,timeNanos:parseInt(pushMessageVO.timeNanos)};if(pushMessageVO.participant){message.ownerId=pushMessageVO.participant.id}if(pushMessageVO.conversation){message.conversation=formatDataToMakeConversation(pushMessageVO.conversation);message.threadId=pushMessageVO.conversation.id}if(pushMessageVO.replyInfoVO||pushMessageVO.replyInfo){message.replyInfo=pushMessageVO.replyInfoVO?formatDataToMakeReplyInfo(pushMessageVO.replyInfoVO,threadId):formatDataToMakeReplyInfo(pushMessageVO.replyInfo,threadId)}if(pushMessageVO.forwardInfo){message.forwardInfo=formatDataToMakeForwardInfo(pushMessageVO.forwardInfo,threadId)}if(pushMessageVO.participant){message.participant=formatDataToMakeParticipant(pushMessageVO.participant,threadId)}return message},reformatThreadHistory=function(threadId,historyContent){var returnData=[];for(var i=0;i<historyContent.length;i++){returnData.push(formatDataToMakeMessage(threadId,historyContent[i]))}return returnData},reformatThreadParticipants=function(participantsContent,threadId){var returnData=[];for(var i=0;i<participantsContent.length;i++){returnData.push(formatDataToMakeParticipant(participantsContent[i],threadId))}return returnData},unsetNotSeenDuration=function(content){var temp=cloneObject(content);if(temp.hasOwnProperty("notSeenDuration")){temp.notSeenDuration=undefined}if(temp.hasOwnProperty("inviter")){temp.inviter.notSeenDuration=undefined}if(temp.hasOwnProperty("participant")){temp.participant.notSeenDuration=undefined}return temp},cloneObject=function(original){var out,value,key;out=Array.isArray(original)?[]:{};for(key in original){value=original[key];out[key]=typeof value==="object"&&value!==null?cloneObject(value):value}return out},getThreads=function(params,callback){var count=50,offset=0,content={},whereClause={},returnCache=false;if(params){if(parseInt(params.count)>0){count=params.count}if(parseInt(params.offset)>0){offset=params.offset}if(typeof params.name==="string"){content.name=whereClause.name=params.name}if(Array.isArray(params.threadIds)){content.threadIds=whereClause.threadIds=params.threadIds}if(typeof params.new==="boolean"){content.new=params.new}if(parseInt(params.creatorCoreUserId)>0){content.creatorCoreUserId=whereClause.creatorCoreUserId=params.creatorCoreUserId}if(parseInt(params.partnerCoreUserId)>0){content.partnerCoreUserId=whereClause.partnerCoreUserId=params.partnerCoreUserId}if(parseInt(params.partnerCoreContactId)>0){content.partnerCoreContactId=whereClause.partnerCoreContactId=params.partnerCoreContactId}var functionLevelCache=typeof params.cache=="boolean"?params.cache:true}content.count=count;content.offset=offset;var sendMessageParams={chatMessageVOType:chatMessageVOTypes.GET_THREADS,typeCode:params.typeCode,content:content};if(functionLevelCache&&canUseCache&&cacheSecret.length>0){if(db){var thenAble;if(Object.keys(whereClause).length===0){thenAble=db.threads.where("[owner+time]").between([userInfo.id,minIntegerValue],[userInfo.id,maxIntegerValue*1e3]).reverse()}else{if(whereClause.hasOwnProperty("threadIds")){thenAble=db.threads.where("id").anyOf(whereClause.threadIds).and(function(thread){return thread.owner==userInfo.id})}if(whereClause.hasOwnProperty("name")){thenAble=db.threads.where("owner").equals(parseInt(userInfo.id)).filter(function(thread){var reg=new RegExp(whereClause.name);return reg.test(chatDecrypt(thread.title,cacheSecret,thread.salt))})}if(whereClause.hasOwnProperty("creatorCoreUserId")){thenAble=db.threads.where("owner").equals(parseInt(userInfo.id)).filter(function(thread){return parseInt(thread.inviter.id)==parseInt(whereClause.creatorCoreUserId)})}}thenAble.offset(offset).limit(count).toArray().then(function(threads){db.threads.where("owner").equals(parseInt(userInfo.id)).count().then(function(threadsCount){var cacheData=[];for(var i=0;i<threads.length;i++){try{var tempData={},salt=threads[i].salt;cacheData.push(createThread(JSON.parse(chatDecrypt(threads[i].data,cacheSecret,threads[i].salt)),false))}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}var returnData={hasError:false,cache:true,errorCode:0,errorMessage:"",result:{threads:cacheData,contentCount:threadsCount,hasNext:offset+count<threadsCount&&threads.length>0,nextOffset:offset+threads.length}};if(cacheData.length>0){callback&&callback(returnData);callback=undefined;returnCache=true}})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,messageLength=messageContent.length,resultData={threads:[],contentCount:result.contentCount,hasNext:offset+count<result.contentCount&&messageLength>0,nextOffset:offset+messageLength},threadData;for(var i=0;i<messageLength;i++){threadData=createThread(messageContent[i],false);if(threadData){resultData.threads.push(threadData)}}returnData.result=resultData;if(typeof Worker!=="undefined"&&productEnv!="ReactNative"&&canUseCache&&cacheSecret.length>0){if(typeof cacheSyncWorker=="undefined"){var plainWorker=function(){self.importScripts("https://npmcdn.com/dexie@2.0.4/dist/dexie.min.js");db=new Dexie("podChat");db.version(1).stores({users:"&id, name, cellphoneNumber, keyId",contacts:"[owner+id], id, owner, uniqueId, userId, cellphoneNumber, email, firstName, lastName, expireTime",threads:"[owner+id] ,id, owner, title, time, [owner+time]",participants:"[owner+id], id, owner, threadId, notSeenDuration, admin, name, contactName, email, expireTime",messages:"[owner+id], id, owner, threadId, time, [threadId+id], [threadId+owner+time]",messageGaps:"[owner+id], [owner+waitsFor], id, waitsFor, owner, threadId, time, [threadId+owner+time]",contentCount:"threadId, contentCount"});addEventListener("message",function(event){var data=JSON.parse(event.data);switch(data.type){case"getThreads":var content=JSON.parse(data.data),userId=parseInt(data.userId);for(var i=0;i<content.length;i++){var lastMessageTime=content[i].lastMessageVO?content[i].lastMessageVO.time:0,threadId=parseInt(content[i].id);if(lastMessageTime>0){db.messages.where("[threadId+owner+time]").between([threadId,userId,lastMessageTime],[threadId,userId,Number.MAX_SAFE_INTEGER*1e3],false,true).delete()}}break}},false)};var code=plainWorker.toString();code=code.substring(code.indexOf("{")+1,code.lastIndexOf("}"));var blob=new Blob([code],{type:"application/javascript"});cacheSyncWorker=new Worker(URL.createObjectURL(blob))}var workerCommand={type:"getThreads",userId:userInfo.id,data:JSON.stringify(resultData.threads)};cacheSyncWorker.postMessage(JSON.stringify(workerCommand));cacheSyncWorker.onmessage=function(event){if(event.data=="terminate"){cacheSyncWorker.terminate();cacheSyncWorker=undefined}};cacheSyncWorker.onerror=function(event){console.log(event)}}if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<resultData.threads.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=resultData.threads[i].id;tempData.owner=userInfo.id;tempData.title=Utility.crypt(resultData.threads[i].title,cacheSecret,salt);tempData.time=resultData.threads[i].time;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(resultData.threads[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.threads.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData);callback=undefined;if(!returnData.hasError&&returnCache){fireEvent("threadEvents",{type:"THREADS_LIST_CHANGE",result:returnData.result})}}})},getAllThreadList=function(params,callback){var sendMessageParams={chatMessageVOType:chatMessageVOTypes.GET_THREADS,typeCode:params.typeCode,content:{}};if(params){if(typeof params.summary=="boolean"){sendMessageParams.content.summary=params.summary}}return sendMessage(sendMessageParams,{onResult:function(result){if(!result.hasError){if(canUseCache){if(db){var allThreads=[];for(var m=0;m<result.result.length;m++){allThreads.push(result.result[m].id)}db.threads.where("owner").equals(parseInt(userInfo.id)).and(function(thread){return allThreads.indexOf(thread.id)<0}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(result)}})},getHistory=function(params,callback){var startTime=Date.now();if(parseInt(params.threadId)>0){var sendMessageParams={chatMessageVOType:chatMessageVOTypes.GET_HISTORY,typeCode:params.typeCode,content:{},subjectId:params.threadId},whereClause={},offset=parseInt(params.offset)>0?parseInt(params.offset):0,count=parseInt(params.count)>0?parseInt(params.count):config.getHistoryCount,order=typeof params.order!="undefined"?params.order.toLowerCase():"desc",functionLevelCache=typeof params.cache=="boolean"?params.cache:true,cacheResult={},serverResult={},cacheFirstMessage,cacheLastMessage,messages,returnCache,dynamicHistoryCount=params.dynamicHistoryCount&&typeof params.dynamicHistoryCount==="boolean"?params.dynamicHistoryCount:false,sendingQueue=params.queues&&typeof params.queues.sending==="boolean"?params.queues.sending:true,failedQueue=params.queues&&typeof params.queues.failed==="boolean"?params.queues.failed:true,uploadingQueue=params.queues&&typeof params.queues.uploading==="boolean"?params.queues.uploading:true,sendingQueueMessages=[],failedQueueMessages=[],uploadingQueueMessages=[];if(sendingQueue){getChatSendQueue(parseInt(params.threadId),function(sendQueueMessages){for(var i=0;i<sendQueueMessages.length;i++){var time=(new Date).getTime();sendingQueueMessages.push(formatDataToMakeMessage(sendQueueMessages[i].threadId,{uniqueId:sendQueueMessages[i].uniqueId,ownerId:userInfo.id,message:sendQueueMessages[i].content,metadata:sendQueueMessages[i].metadata,systemMetadata:sendQueueMessages[i].systemMetadata,replyInfo:sendQueueMessages[i].replyInfo,forwardInfo:sendQueueMessages[i].forwardInfo,time:time,timeNanos:time%1e3*1e6}))}})}if(uploadingQueue){getChatUploadQueue(parseInt(params.threadId),function(uploadQueueMessages){for(var i=0;i<uploadQueueMessages.length;i++){uploadQueueMessages[i].message.participant=userInfo;var time=(new Date).getTime();uploadQueueMessages[i].message.time=time;uploadQueueMessages[i].message.timeNanos=time%1e3*1e6;uploadingQueueMessages.push(formatDataToMakeMessage(params.threadId,uploadQueueMessages[i].message,false))}})}getChatWaitQueue(parseInt(params.threadId),failedQueue,function(waitQueueMessages){if(cacheSecret.length>0){for(var i=0;i<waitQueueMessages.length;i++){var decryptedEnqueuedMessage=Utility.jsonParser(chatDecrypt(waitQueueMessages[i].message,cacheSecret));var time=(new Date).getTime();waitQueueMessages[i]=formatDataToMakeMessage(waitQueueMessages[i].threadId,{uniqueId:decryptedEnqueuedMessage.uniqueId,ownerId:userInfo.id,message:decryptedEnqueuedMessage.content,metadata:decryptedEnqueuedMessage.metadata,systemMetadata:decryptedEnqueuedMessage.systemMetadata,replyInfo:decryptedEnqueuedMessage.replyInfo,forwardInfo:decryptedEnqueuedMessage.forwardInfo,participant:userInfo,time:time,timeNanos:time%1e3*1e6})}failedQueueMessages=waitQueueMessages}else{failedQueueMessages=[]}if(dynamicHistoryCount){var tempCount=count-(sendingQueueMessages.length+failedQueueMessages.length+uploadingQueueMessages.length);sendMessageParams.content.count=tempCount>0?tempCount:0}else{sendMessageParams.content.count=count}sendMessageParams.content.offset=offset;sendMessageParams.content.order=order;if(parseInt(params.id)>0){sendMessageParams.content.id=whereClause.id=params.id}if(Array.isArray(params.uniqueIds)){sendMessageParams.content.uniqueIds=params.uniqueIds}if(parseInt(params.fromTimeFull)>0&&params.fromTimeFull.toString().length==19){sendMessageParams.content.fromTime=whereClause.fromTime=parseInt(params.fromTimeFull.toString().substring(0,13));sendMessageParams.content.fromTimeNanos=whereClause.fromTimeNanos=parseInt(params.fromTimeFull.toString().substring(10,19))}else{if(parseInt(params.fromTime)>0&&parseInt(params.fromTime)<9999999999999){sendMessageParams.content.fromTime=whereClause.fromTime=parseInt(params.fromTime)}if(parseInt(params.fromTimeNanos)>0&&parseInt(params.fromTimeNanos)<999999999){sendMessageParams.content.fromTimeNanos=whereClause.fromTimeNanos=parseInt(params.fromTimeNanos)}}if(parseInt(params.toTimeFull)>0&&params.toTimeFull.toString().length==19){sendMessageParams.content.toTime=whereClause.toTime=parseInt(params.toTimeFull.toString().substring(0,13));sendMessageParams.content.toTimeNanos=whereClause.toTimeNanos=parseInt(params.toTimeFull.toString().substring(10,19))}else{if(parseInt(params.toTime)>0&&parseInt(params.toTime)<9999999999999){sendMessageParams.content.toTime=whereClause.toTime=parseInt(params.toTime)}if(parseInt(params.toTimeNanos)>0&&parseInt(params.toTimeNanos)<999999999){sendMessageParams.content.toTimeNanos=whereClause.toTimeNanos=parseInt(params.toTimeNanos)}}if(typeof params.query!="undefined"){sendMessageParams.content.query=whereClause.query=params.query}if(typeof params.metadataCriteria=="object"&&params.metadataCriteria.hasOwnProperty("field")){sendMessageParams.content.metadataCriteria=whereClause.metadataCriteria=params.metadataCriteria}if(functionLevelCache&&canUseCache&&cacheSecret.length>0&&!whereClause.hasOwnProperty("metadataCriteria")&&order.toLowerCase()!="asc"){if(db){var table=db.messages,collection;returnCache=true;if(whereClause.hasOwnProperty("id")&&whereClause.id>0){collection=table.where("id").equals(parseInt(params.id)).and(function(message){return message.owner==userInfo.id}).reverse()}else{collection=table.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),minIntegerValue],[parseInt(params.threadId),parseInt(userInfo.id),maxIntegerValue*1e3]).reverse()}collection.toArray().then(function(resultMessages){messages=resultMessages.sort(Utility.dynamicSort("time",!(order==="asc")));if(whereClause.hasOwnProperty("fromTime")){var fromTime=whereClause.hasOwnProperty("fromTimeNanos")?Math.floor(whereClause.fromTime/1e3)*1e9+whereClause.fromTimeNanos:whereClause.fromTime*1e6;messages=messages.filter(function(message){return message.time>=fromTime})}if(whereClause.hasOwnProperty("toTime")){var toTime=whereClause.hasOwnProperty("toTimeNanos")?Math.floor(whereClause.toTime/1e3)*1e9+whereClause.toTimeNanos:whereClause.toTime*1e6;messages=messages.filter(function(message){return message.time<=toTime})}if(whereClause.hasOwnProperty("query")&&typeof whereClause.query=="string"){messages=messages.filter(function(message){var reg=new RegExp(whereClause.query);return reg.test(chatDecrypt(message.message,cacheSecret,message.salt))})}if(offset>0){if(typeof messages[offset-1]=="object"&&messages[offset-1].hasGap){returnCache=false}}if(returnCache){messages=messages.slice(offset,offset+count);if(messages.length==0){returnCache=false}cacheFirstMessage=messages[0];cacheLastMessage=messages[messages.length-1];if(cacheFirstMessage&&cacheFirstMessage.time>0){db.messageGaps.where("time").above(cacheFirstMessage.time).toArray().then(function(gaps){if(gaps.length>0){returnCache=false}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}if(returnCache){collection.count().then(function(collectionContentCount){var contentCount=0;var cacheData=[];for(var i=0;i<messages.length;i++){if(i!=0&&i!=messages.length-1&&messages[i].hasGap){returnCache=false;break}try{var tempData={},salt=messages[i].salt;var tempMessage=formatDataToMakeMessage(messages[i].threadId,JSON.parse(chatDecrypt(messages[i].data,cacheSecret,messages[i].salt)),true);cacheData.push(tempMessage);cacheResult[tempMessage.id]={index:i,messageId:tempMessage.id,threadId:tempMessage.threadId,data:Utility.MD5(JSON.stringify([tempMessage.id,tempMessage.message,tempMessage.metadata,tempMessage.systemMetadata]))}}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}if(returnCache){db.contentCount.where("threadId").equals(parseInt(params.threadId)).toArray().then(function(res){var hasNext=true;if(res[0].threadId==parseInt(params.threadId)){contentCount=res[0].contentCount;hasNext=offset+count<res[0].contentCount&&messages.length>0}else{contentCount=collectionContentCount}var returnData={hasError:false,cache:true,errorCode:0,errorMessage:"",result:{history:cacheData,contentCount:contentCount,hasNext:hasNext,nextOffset:offset+messages.length}};if(sendingQueue){returnData.result.sending=sendingQueueMessages}if(uploadingQueue){returnData.result.uploading=uploadingQueueMessages}if(failedQueue){returnData.result.failed=failedQueueMessages}callback&&callback(returnData);callback=undefined}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode},resultMessagesId=[];if(!returnData.hasError){var messageContent=result.result,messageLength=messageContent.length;var history=reformatThreadHistory(params.threadId,messageContent);if(messageLength>0){var lastMessage=history[messageContent.length-1],firstMessage=history[0];if(lastMessage.id>0&&!lastMessage.delivered){deliver({messageId:lastMessage.id,ownerId:lastMessage.participant.id})}}if(canUseCache&&cacheSecret.length>0){if(db){if(Object.keys(cacheResult).length>0&&!whereClause.hasOwnProperty("metadataCriteria")){if(!whereClause||Object.keys(whereClause).length==0){if(messageLength==0){if(order=="asc"){var finalMessageTime=cacheFirstMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),finalMessageTime],[parseInt(params.threadId),parseInt(userInfo.id),maxIntegerValue*1e3],true,false).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{var finalMessageTime=cacheFirstMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),0],[parseInt(params.threadId),parseInt(userInfo.id),finalMessageTime],true,true).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}else{if(firstMessage.previousId==undefined||lastMessage.previousId==undefined){var finalMessageTime=lastMessage.previousId==undefined?lastMessage.time:firstMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),0],[parseInt(params.threadId),parseInt(userInfo.id),finalMessageTime],true,false).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}if(offset==0){if(order==="asc"){var finalMessageTime=firstMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),0],[parseInt(params.threadId),parseInt(userInfo.id),finalMessageTime],true,false).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{var finalMessageTime=firstMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),finalMessageTime],[parseInt(params.threadId),parseInt(userInfo.id),maxIntegerValue*1e3],false,true).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}var boundryStartMessageTime=firstMessage.time<lastMessage.time?firstMessage.time:lastMessage.time,boundryEndMessageTime=firstMessage.time>lastMessage.time?firstMessage.time:lastMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),boundryStartMessageTime],[parseInt(params.threadId),parseInt(userInfo.id),boundryEndMessageTime],true,true).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}else{if(whereClause.hasOwnProperty("id")&&whereClause.id>0){db.messages.where("id").equals(parseInt(whereClause.id)).and(function(message){return message.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}if(whereClause.hasOwnProperty("query")&&typeof whereClause.query=="string"){db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),minIntegerValue],[parseInt(params.threadId),parseInt(userInfo.id),maxIntegerValue*1e3]).and(function(message){var reg=new RegExp(whereClause.query);return reg.test(chatDecrypt(message.message,cacheSecret,message.salt))}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}if(whereClause.hasOwnProperty("fromTime")||whereClause.hasOwnProperty("toTime")){if(messageLength==0){if(whereClause.hasOwnProperty("fromTime")&&whereClause.hasOwnProperty("toTime")){var fromTime=whereClause.hasOwnProperty("fromTimeNanos")?whereClause.fromTime/1e3*1e9+whereClause.fromTimeNanos:whereClause.fromTime*1e6,toTime=whereClause.hasOwnProperty("toTimeNanos")?(whereClause.toTime/1e3+1)*1e9+whereClause.toTimeNanos:(whereClause.toTime+1)*1e6;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),fromTime],[parseInt(params.threadId),parseInt(userInfo.id),toTime],true,true).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else if(whereClause.hasOwnProperty("fromTime")){var fromTime=whereClause.hasOwnProperty("fromTimeNanos")?whereClause.fromTime/1e3*1e9+whereClause.fromTimeNanos:whereClause.fromTime*1e6;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),fromTime],[parseInt(params.threadId),parseInt(userInfo.id),maxIntegerValue*1e3],true,false).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{var toTime=whereClause.hasOwnProperty("toTimeNanos")?(whereClause.toTime/1e3+1)*1e9+whereClause.toTimeNanos:(whereClause.toTime+1)*1e6;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),minIntegerValue],[parseInt(params.threadId),parseInt(userInfo.id),toTime],true,true).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}else{var boundryStartMessageTime=firstMessage.time<lastMessage.time?firstMessage.time:lastMessage.time,boundryEndMessageTime=firstMessage.time>lastMessage.time?firstMessage.time:lastMessage.time;db.messages.where("[threadId+owner+time]").between([parseInt(params.threadId),parseInt(userInfo.id),boundryStartMessageTime],[parseInt(params.threadId),parseInt(userInfo.id),boundryEndMessageTime],true,true).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}}}var cacheData=[];for(var i=0;i<history.length;i++){serverResult[history[i].id]={index:i,data:Utility.MD5(JSON.stringify([history[i].id,history[i].message,history[i].metadata,history[i].systemMetadata]))};try{var tempData={},salt=Utility.generateUUID();tempData.id=parseInt(history[i].id);tempData.owner=parseInt(userInfo.id);tempData.threadId=parseInt(history[i].threadId);tempData.time=history[i].time;tempData.message=Utility.crypt(history[i].message,cacheSecret,salt);tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(history[i])),cacheSecret,salt);tempData.salt=salt;tempData.sendStatus="sent";tempData.hasGap=false;cacheData.push(tempData);resultMessagesId.push(history[i].id)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.messages.bulkPut(cacheData).then(function(){if(typeof lastMessage=="object"&&lastMessage!=null&&lastMessage.id>0&&lastMessage.previousId>0){db.messages.where("[owner+id]").between([userInfo.id,lastMessage.previousId],[userInfo.id,lastMessage.previousId],true,true).toArray().then(function(messages){if(messages.length==0){db.messageGaps.put({id:parseInt(lastMessage.id),owner:parseInt(userInfo.id),waitsFor:parseInt(lastMessage.previousId),threadId:parseInt(lastMessage.threadId),time:lastMessage.time}).then(function(){db.messages.update([userInfo.id,lastMessage.id],{hasGap:true}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}db.messageGaps.where("waitsFor").anyOf(resultMessagesId).and(function(messages){return messages.owner==userInfo.id}).toArray().then(function(needsToBeDeleted){var messagesToBeDeleted=needsToBeDeleted.map(function(msg){db.messages.update([userInfo.id,msg.id],{hasGap:false}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})});return[userInfo.id,msg.id]});db.messageGaps.bulkDelete(messagesToBeDeleted)}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})});if(Object.keys(whereClause).length===0){db.contentCount.put({threadId:parseInt(params.threadId),contentCount:result.contentCount}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}var resultData={history:history,contentCount:result.contentCount,hasNext:sendMessageParams.content.offset+sendMessageParams.content.count<result.contentCount&&messageLength>0,nextOffset:sendMessageParams.content.offset+messageLength};returnData.result=resultData;if(sendingQueue){returnData.result.sending=sendingQueueMessages}if(uploadingQueue){returnData.result.uploading=uploadingQueueMessages}if(failedQueue){returnData.result.failed=failedQueueMessages}if(returnCache){for(var key in cacheResult){if(!serverResult.hasOwnProperty(key)){fireEvent("messageEvents",{type:"MESSAGE_DELETE",result:{message:{id:cacheResult[key].messageId,threadId:cacheResult[key].threadId}}})}}for(var key in serverResult){if(cacheResult.hasOwnProperty(key)){if(cacheResult[key].data!=serverResult[key].data){fireEvent("messageEvents",{type:"MESSAGE_EDIT",result:{message:history[serverResult[key].index]}})}}else{fireEvent("messageEvents",{type:"MESSAGE_NEW",cache:true,result:{message:history[serverResult[key].index]}})}}}else{callback&&callback(returnData);callback=undefined}}}})})}return},updateThreadInfo=function(params,callback){var updateThreadInfoData={chatMessageVOType:chatMessageVOTypes.UPDATE_THREAD_INFO,typeCode:params.typeCode,subjectId:params.threadId,content:{},pushMsgType:4,token:token};if(params){if(parseInt(params.threadId)>0){updateThreadInfoData.subjectId=params.threadId}else{fireEvent("error",{code:999,message:"Thread ID is required for Updating thread info!"})}if(typeof params.image=="string"){updateThreadInfoData.content.image=params.image}if(typeof params.description=="string"){updateThreadInfoData.content.description=params.description}if(typeof params.title=="string"){updateThreadInfoData.content.name=params.title}if(typeof params.metadata=="object"){updateThreadInfoData.content.metadata=JSON.stringify(params.metadata)}else if(typeof params.metadata=="string"){updateThreadInfoData.content.metadata=params.metadata}}return sendMessage(updateThreadInfoData,{onResult:function(result){callback&&callback(result)}})},getThreadParticipants=function(params,callback){var sendMessageParams={chatMessageVOType:chatMessageVOTypes.THREAD_PARTICIPANTS,typeCode:params.typeCode,content:{},subjectId:params.threadId},whereClause={},returnCache=false;var offset=parseInt(params.offset)>0?parseInt(params.offset):0,count=parseInt(params.count)>0?parseInt(params.count):config.getHistoryCount;sendMessageParams.content.count=count;sendMessageParams.content.offset=offset;if(typeof params.name==="string"){sendMessageParams.content.name=whereClause.name=params.name}if(typeof params.admin==="boolean"){sendMessageParams.content.admin=params.admin}var functionLevelCache=typeof params.cache=="boolean"?params.cache:true;if(functionLevelCache&&canUseCache&&cacheSecret.length>0){if(db){db.participants.where("expireTime").below((new Date).getTime()).delete().then(function(){var thenAble;if(Object.keys(whereClause).length===0){thenAble=db.participants.where("threadId").equals(parseInt(params.threadId)).and(function(participant){return participant.owner==userInfo.id})}else{if(whereClause.hasOwnProperty("name")){thenAble=db.participants.where("threadId").equals(parseInt(params.threadId)).and(function(participant){return participant.owner==userInfo.id}).filter(function(contact){var reg=new RegExp(whereClause.name);return reg.test(chatDecrypt(contact.contactName,cacheSecret,contact.salt)+" "+chatDecrypt(contact.name,cacheSecret,contact.salt)+" "+chatDecrypt(contact.email,cacheSecret,contact.salt))})}}thenAble.offset(offset).limit(count).reverse().toArray().then(function(participants){db.participants.where("threadId").equals(parseInt(params.threadId)).and(function(participant){return participant.owner==userInfo.id}).count().then(function(participantsCount){var cacheData=[];for(var i=0;i<participants.length;i++){try{var tempData={},salt=participants[i].salt;cacheData.push(formatDataToMakeParticipant(JSON.parse(chatDecrypt(participants[i].data,cacheSecret,participants[i].salt)),participants[i].threadId))}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}var returnData={hasError:false,cache:true,errorCode:0,errorMessage:"",result:{participants:cacheData,contentCount:participantsCount,hasNext:offset+count<participantsCount&&participants.length>0,nextOffset:offset+participants.length}};if(cacheData.length>0){callback&&callback(returnData);callback=undefined;returnCache=true}})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,messageLength=messageContent.length,resultData={participants:reformatThreadParticipants(messageContent,params.threadId),contentCount:result.contentCount,hasNext:sendMessageParams.content.offset+sendMessageParams.content.count<result.contentCount&&messageLength>0,nextOffset:sendMessageParams.content.offset+messageLength};returnData.result=resultData;if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<resultData.participants.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=parseInt(resultData.participants[i].id);tempData.owner=parseInt(userInfo.id);tempData.threadId=parseInt(resultData.participants[i].threadId);tempData.notSeenDuration=resultData.participants[i].notSeenDuration;tempData.admin=resultData.participants[i].admin;tempData.name=Utility.crypt(resultData.participants[i].name,cacheSecret,salt);tempData.contactName=Utility.crypt(resultData.participants[i].contactName,cacheSecret,salt);tempData.email=Utility.crypt(resultData.participants[i].email,cacheSecret,salt);tempData.expireTime=(new Date).getTime()+cacheExpireTime;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(resultData.participants[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.participants.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData);callback=undefined;if(!returnData.hasError&&returnCache){fireEvent("threadEvents",{type:"THREAD_PARTICIPANTS_LIST_CHANGE",threadId:params.threadId,result:returnData.result})}}})},deliver=function(params){if(userInfo&&params.ownerId!==userInfo.id){return sendMessage({chatMessageVOType:chatMessageVOTypes.DELIVERY,typeCode:params.typeCode,content:params.messageId,pushMsgType:3})}},getImage=function(params,callback){getImageData={};if(params){if(parseInt(params.imageId)>0){getImageData.imageId=params.imageId}if(typeof params.hashCode=="string"){getImageData.hashCode=params.hashCode}if(parseInt(params.width)>0){getImageData.width=params.width}if(parseInt(params.height)>0){getImageData.height=params.height}if(parseInt(params.actual)>0){getImageData.actual=params.actual}if(parseInt(params.downloadable)>0){getImageData.downloadable=params.downloadable}}httpRequest({url:SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_IMAGE,method:"GET",data:getImageData},function(result){if(!result.hasError){var queryString="?";for(var i in params){queryString+=i+"="+params[i]+"&"}queryString=queryString.slice(0,-1);var image=SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_IMAGE+queryString;callback({hasError:result.hasError,result:image})}else{callback({hasError:true})}})},getFile=function(params,callback){getFileData={};if(params){if(typeof params.fileId!="undefined"){getFileData.fileId=params.fileId}if(typeof params.hashCode=="string"){getFileData.hashCode=params.hashCode}if(typeof params.downloadable=="boolean"){getFileData.downloadable=params.downloadable}}httpRequest({url:SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_FILE,method:"GET",data:getFileData},function(result){if(!result.hasError){var queryString="?";for(var i in params){queryString+=i+"="+params[i]+"&"}queryString=queryString.slice(0,-1);var file=SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_FILE+queryString;callback({hasError:result.hasError,result:file})}else{callback({hasError:true})}})},uploadFile=function(params,callback){var fileName,fileType,fileSize,fileExtension,uploadUniqueId,uploadThreadId;fileName=params.file.name;fileType=params.file.type;fileSize=params.file.size;fileExtension=params.file.name.split(".").pop();var uploadFileData={};if(params){if(typeof params.file!=="undefined"){uploadFileData.file=params.file}if(typeof params.fileName=="string"){uploadFileData.fileName=params.fileName}else{uploadFileData.fileName=Utility.generateUUID()+"."+fileExtension}uploadFileData.fileSize=fileSize;if(parseInt(params.threadId)>0){uploadThreadId=params.threadId;uploadFileData.threadId=params.threadId}else{uploadThreadId=0;uploadFileData.threadId=0}if(typeof params.uniqueId=="string"){uploadUniqueId=params.uniqueId;uploadFileData.uniqueId=params.uniqueId}else{uploadUniqueId=Utility.generateUUID();uploadFileData.uniqueId=uploadUniqueId}if(typeof params.originalFileName=="string"){uploadFileData.originalFileName=params.originalFileName}else{uploadFileData.originalFileName=fileName}}httpRequest({url:SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.UPLOAD_FILE,method:"POST",headers:{_token_:token,_token_issuer_:1},data:uploadFileData,uniqueId:uploadUniqueId},function(result){if(!result.hasError){try{var response=typeof result.result.responseText=="string"?JSON.parse(result.result.responseText):result.result.responseText;callback({hasError:response.hasError,result:response.result})}catch(e){callback({hasError:true,errorCode:999,errorMessage:"Problem in Parsing result"})}}else{callback({hasError:true,errorCode:result.errorCode,errorMessage:result.errorMessage})}});return{uniqueId:uploadUniqueId,threadId:uploadThreadId,participant:userInfo,content:{caption:params.content,file:{uniqueId:uploadUniqueId,fileName:fileName,fileSize:fileSize,fileObject:params.file}}}},uploadFileFromUrl=function(params,callback){var uploadUniqueId,uploadThreadId;var uploadFileData={},fileExtension;if(params){if(typeof params.fileUrl!=="undefined"){uploadFileData.url=params.fileUrl}if(typeof params.fileExtension!=="undefined"){fileExtension=params.fileExtension}else{fileExtension="png"}if(typeof params.fileName=="string"){uploadFileData.filename=params.fileName}else{uploadFileData.filename=Utility.generateUUID()+"."+fileExtension}if(typeof params.uniqueId=="string"){uploadUniqueId=params.uniqueId}else{uploadUniqueId=Utility.generateUUID()}if(parseInt(params.threadId)>0){uploadThreadId=params.threadId}else{uploadThreadId=0}uploadFileData.isPublic=true}httpRequest({url:SERVICE_ADDRESSES.POD_DRIVE_ADDRESS+SERVICES_PATH.DRIVE_UPLOAD_FILE_FROM_URL,method:"POST",headers:{_token_:token,_token_issuer_:1},data:uploadFileData,uniqueId:uploadUniqueId},function(result){if(!result.hasError){try{var response=typeof result.result.responseText=="string"?JSON.parse(result.result.responseText):result.result.responseText;callback({hasError:response.hasError,result:response.result})}catch(e){callback({hasError:true,errorCode:999,errorMessage:"Problem in Parsing result",error:e})}}else{callback({hasError:true,errorCode:result.errorCode,errorMessage:result.errorMessage})}});return{uniqueId:uploadUniqueId,threadId:uploadThreadId,participant:userInfo,content:{file:{uniqueId:uploadUniqueId,fileUrl:params.fileUrl}}}},uploadImage=function(params,callback){var fileName,fileType,fileSize,fileExtension,uploadUniqueId,uploadThreadId;fileName=params.image.name;fileType=params.image.type;fileSize=params.image.size;fileExtension=params.image.name.split(".").pop();if(imageMimeTypes.indexOf(fileType)>0||imageExtentions.indexOf(fileExtension)>0){uploadImageData={};if(params){if(typeof params.image!=="undefined"){uploadImageData.image=params.image;uploadImageData.file=params.image}if(typeof params.fileName=="string"){uploadImageData.fileName=params.fileName}else{uploadImageData.fileName=Utility.generateUUID()+"."+fileExtension}uploadImageData.fileSize=fileSize;if(parseInt(params.threadId)>0){uploadThreadId=params.threadId;uploadImageData.threadId=params.threadId}else{uploadThreadId=0;uploadImageData.threadId=0}if(typeof params.uniqueId=="string"){uploadUniqueId=params.uniqueId;uploadImageData.uniqueId=params.uniqueId}else{uploadUniqueId=Utility.generateUUID();uploadImageData.uniqueId=uploadUniqueId}if(typeof params.originalFileName=="string"){uploadImageData.originalFileName=params.originalFileName}else{uploadImageData.originalFileName=fileName}if(parseInt(params.xC)>0){uploadImageData.xC=params.xC}if(parseInt(params.yC)>0){uploadImageData.yC=params.yC}if(parseInt(params.hC)>0){uploadImageData.hC=params.hC}if(parseInt(params.wC)>0){uploadImageData.wC=params.wC}}httpRequest({url:SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.UPLOAD_IMAGE,method:"POST",headers:{_token_:token,_token_issuer_:1},data:uploadImageData,uniqueId:uploadUniqueId},function(result){if(!result.hasError){try{var response=typeof result.result.responseText=="string"?JSON.parse(result.result.responseText):result.result.responseText;if(typeof response.hasError!=="undefined"&&!response.hasError){callback({hasError:response.hasError,result:response.result})}else{callback({hasError:true,errorCode:response.errorCode,errorMessage:response.message})}}catch(e){callback({hasError:true,errorCode:6300,errorMessage:CHAT_ERRORS[6300]})}}else{callback({hasError:true,errorCode:result.errorCode,errorMessage:result.errorMessage})}});return{uniqueId:uploadUniqueId,threadId:uploadThreadId,participant:userInfo,content:{caption:params.content,file:{uniqueId:uploadUniqueId,fileName:fileName,fileSize:fileSize,fileObject:params.file}}}}else{callback({hasError:true,errorCode:6301,errorMessage:CHAT_ERRORS[6301]})}},fireEvent=function(eventName,param){if(eventName=="chatReady"){if(typeof navigator=="undefined"){console.log("[90m     [0m[90m%s[0m","Chat is Ready ")}else{console.log("%c   Chat is Ready ","border-left: solid #666 10px; color: #666;")}}for(var id in eventCallbacks[eventName]){eventCallbacks[eventName][id](param)}},deleteCacheDatabases=function(){if(db){db.close()}if(queueDb){queueDb.close()}var chatCacheDB=new Dexie("podChat");if(chatCacheDB){chatCacheDB.delete().then(function(){console.log("PodChat Database successfully deleted!");var queueDb=new Dexie("podQueues");if(queueDb){queueDb.delete().then(function(){console.log("PodQueues Database successfully deleted!");startCacheDatabases()}).catch(function(err){console.log(err)})}}).catch(function(err){console.log(err)})}},clearCacheDatabasesOfUser=function(callback){if(db&&!cacheDeletingInProgress){cacheDeletingInProgress=true;db.threads.where("owner").equals(parseInt(userInfo.id)).delete().then(function(){console.log("Threads table deleted");db.contacts.where("owner").equals(parseInt(userInfo.id)).delete().then(function(){console.log("Contacts table deleted");db.messages.where("owner").equals(parseInt(userInfo.id)).delete().then(function(){console.log("Messages table deleted");db.participants.where("owner").equals(parseInt(userInfo.id)).delete().then(function(){console.log("Participants table deleted");db.messageGaps.where("owner").equals(parseInt(userInfo.id)).delete().then(function(){console.log("MessageGaps table deleted");cacheDeletingInProgress=false;callback&&callback()})})})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}},startCacheDatabases=function(callback){if(hasCache){queueDb=new Dexie("podQueues");queueDb.version(1).stores({waitQ:"[owner+threadId+uniqueId], owner, threadId, uniqueId, message"});if(enableCache){db=new Dexie("podChat");db.version(1).stores({users:"&id, name, cellphoneNumber, keyId",contacts:"[owner+id], id, owner, uniqueId, userId, cellphoneNumber, email, firstName, lastName, expireTime",threads:"[owner+id] ,id, owner, title, time, [owner+time]",participants:"[owner+id], id, owner, threadId, notSeenDuration, admin, name, contactName, email, expireTime",messages:"[owner+id], id, owner, threadId, time, [threadId+id], [threadId+owner+time]",messageGaps:"[owner+id], [owner+waitsFor], id, waitsFor, owner, threadId, time, [threadId+owner+time]",contentCount:"threadId, contentCount"});db.open().catch(function(e){console.log("Open failed: "+e.stack)});db.on("ready",function(){isCacheReady=true;callback&&callback()},true);db.on("versionchange",function(event){window.location.reload()})}else{callback&&callback()}}else{console.log(CHAT_ERRORS[6600])}},getChatSendQueue=function(threadId,callback){if(threadId){var tempSendQueue=[];for(var i=0;i<chatSendQueue.length;i++){if(chatSendQueue[i].threadId==threadId){tempSendQueue.push(chatSendQueue[i])}}callback&&callback(tempSendQueue)}else{callback&&callback(chatSendQueue)}},getChatWaitQueue=function(threadId,active,callback){if(active&&threadId>0){if(hasCache&&typeof queueDb=="object"){queueDb.waitQ.where("threadId").equals(threadId).and(function(item){return item.owner==parseInt(userInfo.id)}).toArray().then(function(waitQueueOnCache){var uniqueIds=[];for(var i=0;i<waitQueueOnCache.length;i++){uniqueIds.push(waitQueueOnCache[i].uniqueId)}if(uniqueIds.length&&chatState){sendMessage({chatMessageVOType:chatMessageVOTypes.GET_HISTORY,content:{uniqueIds:uniqueIds},subjectId:threadId},{onResult:function(result){if(!result.hasError){var messageContent=result.result;for(var i=0;i<messageContent.length;i++){for(var j=0;j<uniqueIds.length;j++){if(uniqueIds[j]==messageContent[i].uniqueId){deleteFromChatWaitQueue(messageContent[i],function(){});uniqueIds.splice(j,1);waitQueueOnCache.splice(j,1)}}}for(var i=0;i<chatSendQueue.length;i++){for(var j=0;j<uniqueIds.length;j++){if(uniqueIds[j]==chatSendQueue[i].message.uniqueId){deleteFromChatWaitQueue(chatSendQueue[i].message,function(){});uniqueIds.splice(j,1);waitQueueOnCache.splice(j,1)}}}callback&&callback(waitQueueOnCache)}}})}else{callback&&callback(waitQueueOnCache)}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{var uniqueIds=[];for(var i=0;i<chatWaitQueue.length;i++){uniqueIds.push(chatWaitQueue[i].uniqueId)}if(uniqueIds.length){sendMessage({chatMessageVOType:chatMessageVOTypes.GET_HISTORY,content:{uniqueIds:uniqueIds},subjectId:threadId},{onResult:function(result){if(!result.hasError){var messageContent=result.result;for(var i=0;i<messageContent.length;i++){for(var j=0;j<uniqueIds.length;j++){if(uniqueIds[j]==messageContent[i].uniqueId){uniqueIds.splice(j,1);chatWaitQueue.splice(j,1)}}}callback&&callback(chatWaitQueue)}}})}else{callback&&callback([])}}}else{callback&&callback([])}},getChatUploadQueue=function(threadId,callback){var uploadQ=[];for(var i=0;i<chatUploadQueue.length;i++){if(parseInt(chatUploadQueue[i].message.subjectId)==threadId){uploadQ.push(chatUploadQueue[i])}}callback&&callback(uploadQ)},deleteFromChatSentQueue=function(item,callback){for(var i=0;i<chatSendQueue.length;i++){if(chatSendQueue[i].message.uniqueId==item.message.uniqueId){chatSendQueue.splice(i,1)}}callback&&callback()},deleteFromChatWaitQueue=function(item,callback){if(hasCache&&typeof queueDb=="object"){queueDb.waitQ.where("uniqueId").equals(item.uniqueId).and(function(item){return item.owner==parseInt(userInfo.id)}).delete().then(function(){callback&&callback()}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{for(var i=0;i<chatWaitQueue.length;i++){if(chatWaitQueue[i].uniqueId==item.uniqueId){chatWaitQueue.splice(i,1)}}callback&&callback()}},deleteFromChatUploadQueue=function(item,callback){for(var i=0;i<chatUploadQueue.length;i++){if(chatUploadQueue[i].message.uniqueId==item.message.uniqueId){chatUploadQueue.splice(i,1)}}callback&&callback()},putInChatSendQueue=function(params,callback){chatSendQueue.push(params);putInChatWaitQueue(params.message,function(){callback&&callback()})},putInChatWaitQueue=function(item,callback){if(item.uniqueId!=""){var waitQueueUniqueId=typeof item.uniqueId=="string"?item.uniqueId:Array.isArray(item.uniqueId)?item.uniqueId[0]:null;if(waitQueueUniqueId!=null){if(hasCache&&typeof queueDb=="object"){queueDb.waitQ.put({threadId:parseInt(item.subjectId),uniqueId:waitQueueUniqueId,owner:parseInt(userInfo.id),message:Utility.crypt(item,cacheSecret)}).then(function(){callback&&callback()}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{item.uniqueId=waitQueueUniqueId;chatWaitQueue.push(item);callback&&callback()}}}},putInChatUploadQueue=function(params,callback){chatUploadQueue.push(params);callback&&callback()},transferFromUploadQToSendQ=function(threadId,uniqueId,metadata,callback){getChatUploadQueue(threadId,function(uploadQueue){for(var i=0;i<uploadQueue.length;i++){if(uploadQueue[i].message.uniqueId==uniqueId){try{var message=uploadQueue[i].message,callbacks=uploadQueue[i].callbacks;message.metadata=metadata}catch(e){console.log(e)}deleteFromChatUploadQueue(uploadQueue[i],function(){putInChatSendQueue({message:message,callbacks:callbacks},function(){callback&&callback()})});break}}})},chatDecrypt=function(string,secret,salt){var decryptedString=Utility.decrypt(string,secret,salt);if(!decryptedString.hasError){return decryptedString.result}else{if(secret!="undefined"&&secret!=""){if(db){db.threads.where("owner").equals(parseInt(userInfo.id)).count().then(function(threadsCount){if(threadsCount>0){clearCacheDatabasesOfUser(function(){console.log("All cache databases have been cleared.")})}}).catch(function(e){console.log(e)})}}return"{}"}};this.on=function(eventName,callback){if(eventCallbacks[eventName]){var id=Utility.generateUUID();eventCallbacks[eventName][id]=callback;return id}};this.getPeerId=function(){return peerId};this.getCurrentUser=function(){return userInfo};this.getUserInfo=getUserInfo;this.getThreads=getThreads;this.getAllThreadList=getAllThreadList;this.getHistory=getHistory;this.getContacts=function(params,callback){var count=50,offset=0,content={},whereClause={},returnCache=false;if(params){if(parseInt(params.count)>0){count=params.count}if(parseInt(params.offset)>0){offset=params.offset}if(typeof params.query==="string"){content.query=whereClause.query=params.query}var functionLevelCache=typeof params.cache=="boolean"?params.cache:true}content.size=count;content.offset=offset;var sendMessageParams={chatMessageVOType:chatMessageVOTypes.GET_CONTACTS,typeCode:params.typeCode,content:content};if(functionLevelCache&&canUseCache&&cacheSecret.length>0){if(db){db.contacts.where("expireTime").below((new Date).getTime()).delete().then(function(){var thenAble;if(Object.keys(whereClause).length===0){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id))}else{if(whereClause.hasOwnProperty("query")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).filter(function(contact){var reg=new RegExp(whereClause.query);return reg.test(chatDecrypt(contact.firstName,cacheSecret,contact.salt)+" "+chatDecrypt(contact.lastName,cacheSecret,contact.salt)+" "+chatDecrypt(contact.email,cacheSecret,contact.salt))})}}thenAble.reverse().offset(offset).limit(count).toArray().then(function(contacts){db.contacts.where("owner").equals(parseInt(userInfo.id)).count().then(function(contactsCount){var cacheData=[];for(var i=0;i<contacts.length;i++){try{var tempData={},salt=contacts[i].salt;cacheData.push(formatDataToMakeContact(JSON.parse(chatDecrypt(contacts[i].data,cacheSecret,contacts[i].salt))))}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}var returnData={hasError:false,cache:true,errorCode:0,errorMessage:"",result:{contacts:cacheData,contentCount:contactsCount,hasNext:offset+count<contactsCount&&contacts.length>0,nextOffset:offset+contacts.length}};if(cacheData.length>0){callback&&callback(returnData);callback=undefined;returnCache=true}})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,messageLength=messageContent.length,resultData={contacts:[],contentCount:result.contentCount,hasNext:offset+count<result.contentCount&&messageLength>0,nextOffset:offset+messageLength},contactData;for(var i=0;i<messageLength;i++){contactData=formatDataToMakeContact(messageContent[i]);if(contactData){resultData.contacts.push(contactData)}}returnData.result=resultData;if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<resultData.contacts.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=resultData.contacts[i].id;tempData.owner=userInfo.id;tempData.uniqueId=resultData.contacts[i].uniqueId;tempData.userId=Utility.crypt(resultData.contacts[i].userId,cacheSecret,salt);tempData.cellphoneNumber=Utility.crypt(resultData.contacts[i].cellphoneNumber,cacheSecret,salt);tempData.email=Utility.crypt(resultData.contacts[i].email,cacheSecret,salt);tempData.firstName=Utility.crypt(resultData.contacts[i].firstName,cacheSecret,salt);tempData.lastName=Utility.crypt(resultData.contacts[i].lastName,cacheSecret,salt);tempData.expireTime=(new Date).getTime()+cacheExpireTime;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(resultData.contacts[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.contacts.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData);callback=undefined;if(!returnData.hasError&&returnCache){fireEvent("contactEvents",{type:"CONTACTS_LIST_CHANGE",result:returnData.result})}}})};this.getThreadParticipants=getThreadParticipants;this.getThreadAdmins=function(params,callback){getThreadParticipants({threadId:params.threadId,admin:true,cache:false},callback)};this.addParticipants=function(params,callback){var sendMessageParams={chatMessageVOType:chatMessageVOTypes.ADD_PARTICIPANT,typeCode:params.typeCode};if(params){if(parseInt(params.threadId)>0){sendMessageParams.subjectId=params.threadId}if(Array.isArray(params.contacts)){sendMessageParams.content=params.contacts}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={thread:createThread(messageContent)};returnData.result=resultData}callback&&callback(returnData)}})};this.removeParticipants=function(params,callback){var sendMessageParams={chatMessageVOType:chatMessageVOTypes.REMOVE_PARTICIPANT,typeCode:params.typeCodes};if(params){if(parseInt(params.threadId)>0){sendMessageParams.subjectId=params.threadId}if(Array.isArray(params.participants)){sendMessageParams.content=params.participants}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={thread:createThread(messageContent)};returnData.result=resultData}callback&&callback(returnData)}})};this.leaveThread=function(params,callback){var sendMessageParams={chatMessageVOType:chatMessageVOTypes.LEAVE_THREAD,typeCode:params.typeCode};if(params){if(parseInt(params.threadId)>0){sendMessageParams.subjectId=params.threadId}}return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={thread:createThread(messageContent)};returnData.result=resultData}callback&&callback(returnData)}})};this.createThread=function(params,callback){var content={};if(params){if(typeof params.title==="string"){content.title=params.title}if(typeof params.type==="string"){var threadType=params.type;content.type=createThreadTypes[threadType]}if(Array.isArray(params.invitees)){var tempInvitee;content.invitees=[];for(var i=0;i<params.invitees.length;i++){var tempInvitee=formatDataToMakeInvitee(params.invitees[i]);if(tempInvitee){content.invitees.push(tempInvitee)}}}if(typeof params.image==="string"){content.image=params.image}if(typeof params.description==="string"){content.description=params.description}if(typeof params.metadata==="string"){content.metadata=params.metadata}else if(typeof params.metadata==="object"){try{content.metadata=JSON.stringify(params.metadata)}catch(e){console.log(e)}}if(typeof params.message=="object"){content.message={};if(typeof params.message.text==="string"){content.message.text=params.message.text}if(typeof params.message.uniqueId==="string"){content.message.uniqueId=params.message.uniqueId}if(typeof params.message.type>0){content.message.type=params.message.type}if(typeof params.message.repliedTo>0){content.message.repliedTo=params.message.repliedTo}if(typeof params.message.metadata==="string"){content.message.metadata=params.message.metadata}else if(typeof params.message.metadata==="object"){content.message.metadata=JSON.stringify(params.message.metadata)}if(typeof params.message.systemMetadata==="string"){content.message.systemMetadata=params.message.systemMetadata}else if(typeof params.message.systemMetadata==="object"){content.message.systemMetadata=JSON.stringify(params.message.systemMetadata)}if(Array.isArray(params.message.forwardedMessageIds)){content.message.forwardedMessageIds=params.message.forwardedMessageIds;content.message.forwardedUniqueIds=[];for(var i=0;i<params.message.forwardedMessageIds.length;i++){content.message.forwardedUniqueIds.push(Utility.generateUUID())}}}}var sendMessageParams={chatMessageVOType:chatMessageVOTypes.CREATE_THREAD,content:content};return sendMessage(sendMessageParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={thread:createThread(messageContent)};returnData.result=resultData}callback&&callback(returnData)}})};this.sendTextMessage=function(params,callbacks){var metadata={},uniqueId;if(typeof params.uniqueId!="undefined"){uniqueId=params.uniqueId}else{uniqueId=Utility.generateUUID()}putInChatSendQueue({message:{chatMessageVOType:chatMessageVOTypes.MESSAGE,typeCode:params.typeCode,messageType:params.messageType,subjectId:params.threadId,repliedTo:params.repliedTo,content:params.content,uniqueId:uniqueId,systemMetadata:JSON.stringify(params.systemMetadata),metadata:JSON.stringify(metadata),pushMsgType:5},callbacks:callbacks},function(){chatSendQueueHandler()});return{uniqueId:uniqueId,threadId:params.threadId,participant:userInfo,content:params.content}};this.sendBotMessage=function(params,callbacks){var metadata={};return sendMessage({chatMessageVOType:chatMessageVOTypes.BOT_MESSAGE,typeCode:params.typeCode,subjectId:params.messageId,repliedTo:params.repliedTo,content:params.content,uniqueId:params.uniqueId,receiver:params.receiver,systemMetadata:JSON.stringify(params.systemMetadata),metadata:JSON.stringify(metadata),pushMsgType:4},callbacks)};this.sendFileMessage=function(params,callbacks){var metadata={},fileUploadParams={},fileUniqueId=Utility.generateUUID();if(params){if(typeof params.file!="undefined"){var fileName,fileType,fileSize,fileExtension;fileName=params.file.name;fileType=params.file.type;fileSize=params.file.size;fileExtension=params.file.name.split(".").pop();fireEvent("fileUploadEvents",{threadId:params.threadId,uniqueId:fileUniqueId,state:"NOT_STARTED",progress:0,fileInfo:{fileName:fileName,fileSize:fileSize},fileObject:params.file});if(imageMimeTypes.indexOf(fileType)>0||imageExtentions.indexOf(fileExtension)>0){fileUploadParams.image=params.file;if(typeof params.xC=="string"){fileUploadParams.xC=params.xC}if(typeof params.yC=="string"){fileUploadParams.yC=params.yC}if(typeof params.hC=="string"){fileUploadParams.hC=params.hC}if(typeof params.wC=="string"){fileUploadParams.wC=params.wC}}else{fileUploadParams.file=params.file}metadata["file"]={};metadata["file"]["originalName"]=fileName;metadata["file"]["mimeType"]=fileType;metadata["file"]["size"]=fileSize;if(typeof params.fileName=="string"){fileUploadParams.fileName=params.fileName.split(".")[0]+"."+fileExtension}else{fileUploadParams.fileName=fileUniqueId+"."+fileExtension}fileUploadParams.threadId=params.threadId;fileUploadParams.uniqueId=fileUniqueId;fileUploadParams.fileObject=params.file;fileUploadParams.originalFileName=fileName;putInChatUploadQueue({message:{chatMessageVOType:chatMessageVOTypes.MESSAGE,typeCode:params.typeCode,messageType:params.messageType,subjectId:params.threadId,repliedTo:params.repliedTo,content:params.content,metadata:JSON.stringify(metadata),systemMetadata:JSON.stringify(params.systemMetadata),uniqueId:fileUniqueId,pushMsgType:4},callbacks:callbacks},function(){if(imageMimeTypes.indexOf(fileType)>0||imageExtentions.indexOf(fileExtension)>0){uploadImage(fileUploadParams,function(result){if(!result.hasError){metadata["file"]["actualHeight"]=result.result.actualHeight;metadata["file"]["actualWidth"]=result.result.actualWidth;metadata["file"]["height"]=result.result.height;metadata["file"]["width"]=result.result.width;metadata["file"]["name"]=result.result.name;metadata["file"]["hashCode"]=result.result.hashCode;metadata["file"]["id"]=result.result.id;metadata["file"]["link"]=SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_IMAGE+"?imageId="+result.result.id+"&hashCode="+result.result.hashCode;transferFromUploadQToSendQ(parseInt(params.threadId),fileUniqueId,JSON.stringify(metadata),function(){chatSendQueueHandler()})}else{deleteFromChatUploadQueue({message:{uniqueId:fileUniqueId}})}})}else{uploadFile(fileUploadParams,function(result){if(!result.hasError){metadata["file"]["name"]=result.result.name;metadata["file"]["hashCode"]=result.result.hashCode;metadata["file"]["id"]=result.result.id;metadata["file"]["link"]=SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_FILE+"?fileId="+result.result.id+"&hashCode="+result.result.hashCode;transferFromUploadQToSendQ(parseInt(params.threadId),fileUniqueId,JSON.stringify(metadata),function(){chatSendQueueHandler()})}else{deleteFromChatUploadQueue({message:{uniqueId:fileUniqueId}})}})}});return{uniqueId:fileUniqueId,threadId:params.threadId,participant:userInfo,content:{caption:params.content,file:{uniqueId:fileUniqueId,fileName:fileName,fileSize:fileSize,fileObject:params.file}}}}else{fireEvent("error",{code:6302,message:CHAT_ERRORS[6302]})}}return{uniqueId:fileUniqueId,threadId:params.threadId,participant:userInfo,content:params.content}};this.sendLocationMessage=function(params,callbacks){var data={},url=SERVICE_ADDRESSES.MAP_ADDRESS+SERVICES_PATH.STATIC_IMAGE,hasError=false;if(params){if(typeof params.type==="string"){data.type=params.type}else{data.type="standard-night"}if(parseInt(params.zoom)>0){data.zoom=params.zoom}else{data.zoom=15}if(parseInt(params.width)>0){data.width=params.width}else{data.width=800}if(parseInt(params.height)>0){data.height=params.height}else{data.height=600}if(typeof params.center==="object"){if(parseFloat(params.center.lat)>0&&parseFloat(params.center.lng)){data.center=params.center.lat+","+parseFloat(params.center.lng)}else{hasError=true;fireEvent("error",{code:6700,message:CHAT_ERRORS[6700],error:undefined})}}else{hasError=true;fireEvent("error",{code:6700,message:CHAT_ERRORS[6700],error:undefined})}data.key=mapApiKey}var keys=Object.keys(data);if(keys.length>0){url+="?";for(var i=0;i<keys.length;i++){var key=keys[i];url+=key+"="+data[key];if(i<keys.length-1){url+="&"}}}if(!hasError){var metadata={},fileUploadParams={},fileUniqueId=Utility.generateUUID();if(params){if(typeof url!="undefined"){metadata["file"]={},metadata["location"]={};fileUploadParams.threadId=params.threadId;fileUploadParams.uniqueId=fileUniqueId;fileUploadParams.fileUrl=url;putInChatUploadQueue({message:{chatMessageVOType:chatMessageVOTypes.MESSAGE,typeCode:params.typeCode,messageType:params.messageType,subjectId:params.threadId,content:params.content,metadata:JSON.stringify(metadata),systemMetadata:JSON.stringify(params.systemMetadata),uniqueId:fileUniqueId,pushMsgType:4},callbacks:callbacks},function(){uploadFileFromUrl(fileUploadParams,function(result){if(!result.hasError){metadata["location"]["center"]=params.center;metadata["location"]["zoom"]=params.zoom;metadata["file"]["created"]=result.result.created;metadata["file"]["size"]=result.result.size;metadata["file"]["width"]=params.width;metadata["file"]["height"]=params.height;metadata["file"]["name"]=result.result.name;metadata["file"]["hashCode"]=result.result.hashCode;metadata["file"]["id"]=result.result.id;metadata["file"]["link"]=SERVICE_ADDRESSES.POD_DRIVE_ADDRESS+SERVICES_PATH.DRIVE_DOWNLOAD_FILE+"?hash="+result.result.hashCode;transferFromUploadQToSendQ(parseInt(params.threadId),fileUniqueId,JSON.stringify(metadata),function(){chatSendQueueHandler()})}})});return{uniqueId:fileUniqueId,threadId:params.threadId,participant:userInfo,content:{caption:params.content,file:{uniqueId:fileUniqueId,fileUrl:url}}}}else{fireEvent("error",{code:6302,message:CHAT_ERRORS[6302]})}}}return{uniqueId:fileUniqueId,threadId:params.threadId,participant:userInfo,content:params.content}};this.resendMessage=function(uniqueId,callbacks){if(hasCache&&typeof queueDb=="object"){queueDb.waitQ.where("uniqueId").equals(uniqueId).and(function(item){return item.owner==parseInt(userInfo.id)}).toArray().then(function(messages){if(messages.length){putInChatSendQueue({message:Utility.jsonParser(chatDecrypt(messages[0].message,cacheSecret)),callbacks:callbacks},function(){chatSendQueueHandler()})}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{for(var i=0;i<chatWaitQueue.length;i++){if(chatWaitQueue[i].message.uniqueId==uniqueId){putInChatSendQueue({message:chatWaitQueue[i].message,callbacks:callbacks},function(){chatSendQueueHandler()});break}}}};this.cancelMessage=function(uniqueId,callback){deleteFromChatSentQueue({message:{uniqueId:uniqueId}},function(){deleteFromChatWaitQueue({uniqueId:uniqueId},callback)})};this.clearHistory=function(params,callback){var clearHistoryParams={chatMessageVOType:chatMessageVOTypes.CLEAR_HISTORY,typeCode:params.typeCode};if(params){if(parseInt(params.threadId)>0){clearHistoryParams.subjectId=params.threadId}}return sendMessage(clearHistoryParams,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var resultData={thread:result.result};returnData.result=resultData;if(canUseCache){if(db){db.messages.where("threadId").equals(parseInt(result.result)).and(function(message){return message.owner==userInfo.id}).delete().catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData)}})};this.getImage=getImage;this.getFile=getFile;this.uploadFile=uploadFile;this.uploadImage=uploadImage;this.cancelFileUpload=function(params,callback){if(params){if(typeof params.uniqueId=="string"){var uniqueId=params.uniqueId;httpRequestObject[eval("uniqueId")]&&httpRequestObject[eval("uniqueId")].abort();httpRequestObject[eval("uniqueId")]&&delete httpRequestObject[eval("uniqueId")];deleteFromChatUploadQueue({message:{uniqueId:uniqueId}},callback)}}return};this.editMessage=function(params,callback){return sendMessage({chatMessageVOType:chatMessageVOTypes.EDIT_MESSAGE,typeCode:params.typeCode,messageType:params.messageType,subjectId:params.messageId,repliedTo:params.repliedTo,content:params.content,uniqueId:params.uniqueId,metadata:params.metadata,systemMetadata:params.systemMetadata,pushMsgType:4},{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={editedMessage:formatDataToMakeMessage(undefined,messageContent)};returnData.result=resultData;if(canUseCache&&cacheSecret.length>0){if(db){try{var tempData={},salt=Utility.generateUUID();tempData.id=parseInt(resultData.editedMessage.id);tempData.owner=parseInt(userInfo.id);tempData.threadId=parseInt(resultData.editedMessage.threadId);tempData.time=resultData.editedMessage.time;tempData.message=Utility.crypt(resultData.editedMessage.message,cacheSecret,salt);tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(resultData.editedMessage)),cacheSecret,salt);tempData.salt=salt;db.messages.put(tempData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData)}})};this.deleteMessage=function(params,callback){return sendMessage({chatMessageVOType:chatMessageVOTypes.DELETE_MESSAGE,typeCode:params.typeCode,subjectId:params.messageId,uniqueId:params.uniqueId,content:JSON.stringify({deleteForAll:params.deleteForAll}),pushMsgType:4},{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={deletedMessage:{id:result.result}};returnData.result=resultData;if(canUseCache){if(db){db.messages.where("id").equals(parseInt(result.result)).delete().catch(function(error){fireEvent("error",{code:6602,message:CHAT_ERRORS[6602],error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData)}})};this.deleteMultipleMessages=function(params,callback){var messageIdsList=params.messageIds,uniqueIdsList=[],threadId=params.threadId;for(i in messageIdsList){var messageId=messageIdsList[i];if(!threadCallbacks[threadId]){threadCallbacks[threadId]={}}var uniqueId=Utility.generateUUID();uniqueIdsList.push(uniqueId);messagesCallbacks[uniqueId]=function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,resultData={deletedMessage:{id:result.result}};returnData.result=resultData;if(canUseCache){if(db){db.messages.where("id").equals(parseInt(result.result)).delete().catch(function(error){fireEvent("error",{code:6602,message:CHAT_ERRORS[6602],error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData)}}return sendMessage({chatMessageVOType:chatMessageVOTypes.DELETE_MESSAGE,typeCode:params.typeCode,subjectId:threadId,content:{uniqueIds:uniqueIdsList,ids:messageIdsList,deleteForAll:params.deleteForAll},pushMsgType:4})};this.replyMessage=function(params,callbacks){var uniqueId;if(typeof params.uniqueId!="undefined"){uniqueId=params.uniqueId}else{uniqueId=Utility.generateUUID()}putInChatSendQueue({message:{chatMessageVOType:chatMessageVOTypes.MESSAGE,typeCode:params.typeCode,messageType:params.messageType,subjectId:params.threadId,repliedTo:params.repliedTo,content:params.content,uniqueId:uniqueId,systemMetadata:JSON.stringify(params.systemMetadata),pushMsgType:5},callbacks:callbacks},function(){chatSendQueueHandler()});return{uniqueId:uniqueId,threadId:params.threadId,participant:userInfo,content:params.content}};this.replyFileMessage=function(params,callbacks){var metadata={},fileUploadParams={},fileUniqueId=Utility.generateUUID();if(params){if(typeof params.file!="undefined"){var fileName,fileType,fileSize,fileExtension;fileName=params.file.name;fileType=params.file.type;fileSize=params.file.size;fileExtension=params.file.name.split(".").pop();fireEvent("fileUploadEvents",{threadId:params.threadId,uniqueId:fileUniqueId,state:"NOT_STARTED",progress:0,fileInfo:{fileName:fileName,fileSize:fileSize},fileObject:params.file});if(imageMimeTypes.indexOf(fileType)>0||imageExtentions.indexOf(fileExtension)>0){fileUploadParams.image=params.file;if(typeof params.xC=="string"){fileUploadParams.xC=params.xC}if(typeof params.yC=="string"){fileUploadParams.yC=params.yC}if(typeof params.hC=="string"){fileUploadParams.hC=params.hC}if(typeof params.wC=="string"){fileUploadParams.wC=params.wC}}else{fileUploadParams.file=params.file}metadata["file"]={};metadata["file"]["originalName"]=fileName;metadata["file"]["mimeType"]=fileType;metadata["file"]["size"]=fileSize;if(typeof params.fileName=="string"){fileUploadParams.fileName=params.fileName.split(".")[0]+"."+fileExtension}else{fileUploadParams.fileName=fileUniqueId+"."+fileExtension}fileUploadParams.threadId=params.threadId;fileUploadParams.uniqueId=fileUniqueId;fileUploadParams.fileObject=params.file;fileUploadParams.originalFileName=fileName;putInChatUploadQueue({message:{chatMessageVOType:chatMessageVOTypes.MESSAGE,typeCode:params.typeCode,messageType:params.messageType,subjectId:params.threadId,repliedTo:params.repliedTo,content:params.content,subjectId:params.threadId,repliedTo:params.repliedTo,content:params.content,metadata:JSON.stringify(metadata),systemMetadata:JSON.stringify(params.systemMetadata),uniqueId:fileUniqueId,pushMsgType:4},callbacks:callbacks},function(){if(imageMimeTypes.indexOf(fileType)>0||imageExtentions.indexOf(fileExtension)>0){uploadImage(fileUploadParams,function(result){if(!result.hasError){metadata["file"]["actualHeight"]=result.result.actualHeight;metadata["file"]["actualWidth"]=result.result.actualWidth;metadata["file"]["height"]=result.result.height;metadata["file"]["width"]=result.result.width;metadata["file"]["name"]=result.result.name;metadata["file"]["hashCode"]=result.result.hashCode;metadata["file"]["id"]=result.result.id;metadata["file"]["link"]=SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_IMAGE+"?imageId="+result.result.id+"&hashCode="+result.result.hashCode;transferFromUploadQToSendQ(parseInt(params.threadId),fileUniqueId,JSON.stringify(metadata),function(){chatSendQueueHandler()})}})}else{uploadFile(fileUploadParams,function(result){if(!result.hasError){metadata["file"]["name"]=result.result.name;metadata["file"]["hashCode"]=result.result.hashCode;metadata["file"]["id"]=result.result.id;metadata["file"]["link"]=SERVICE_ADDRESSES.FILESERVER_ADDRESS+SERVICES_PATH.GET_FILE+"?fileId="+result.result.id+"&hashCode="+result.result.hashCode;transferFromUploadQToSendQ(parseInt(params.threadId),fileUniqueId,JSON.stringify(metadata),function(){chatSendQueueHandler()})}})}});return{uniqueId:fileUniqueId,threadId:params.threadId,participant:userInfo,content:{caption:params.content,file:{uniqueId:fileUniqueId,fileName:fileName,fileSize:fileSize,fileObject:params.file}}}}else{fireEvent("error",{code:6302,message:CHAT_ERRORS[6302]})}}};this.forwardMessage=function(params,callbacks){var threadId=params.subjectId,messageIdsList=JSON.parse(params.content),uniqueIdsList=[];for(i in messageIdsList){var messageId=messageIdsList[i];if(!threadCallbacks[threadId]){threadCallbacks[threadId]={}}var uniqueId=Utility.generateUUID();uniqueIdsList.push(uniqueId);threadCallbacks[threadId][uniqueId]={};sendMessageCallbacks[uniqueId]={};if(callbacks.onSent){sendMessageCallbacks[uniqueId].onSent=callbacks.onSent;threadCallbacks[threadId][uniqueId].onSent=false;threadCallbacks[threadId][uniqueId].uniqueId=uniqueId}if(callbacks.onSeen){sendMessageCallbacks[uniqueId].onSeen=callbacks.onSeen;threadCallbacks[threadId][uniqueId].onSeen=false}if(callbacks.onDeliver){sendMessageCallbacks[uniqueId].onDeliver=callbacks.onDeliver;threadCallbacks[threadId][uniqueId].onDeliver=false}}putInChatSendQueue({message:{chatMessageVOType:chatMessageVOTypes.FORWARD_MESSAGE,typeCode:params.typeCode,subjectId:params.subjectId,repliedTo:params.repliedTo,content:params.content,uniqueId:uniqueIdsList,metadata:JSON.stringify(params.metadata),pushMsgType:5},callbacks:callbacks},function(){chatSendQueueHandler()})};this.deliver=deliver(params);this.seen=function(params){if(userInfo&&params.ownerId!==userInfo.id){return sendMessage({chatMessageVOType:chatMessageVOTypes.SEEN,typeCode:params.typeCode,content:params.messageId,pushMsgType:3})}};this.startTyping=function(params){var uniqueId=Utility.generateUUID();if(parseInt(params.threadId)>0){var threadId=params.threadId}isTypingInterval&&clearInterval(isTypingInterval);isTypingInterval=setInterval(function(){sendSystemMessage({content:JSON.stringify({type:systemMessageTypes.IS_TYPING}),subjectId:threadId,uniqueId:uniqueId})},systemMessageIntervalPitch)};this.stopTyping=function(){isTypingInterval&&clearInterval(isTypingInterval)};this.getMessageDeliveredList=function(params,callback){var deliveryListData={chatMessageVOType:chatMessageVOTypes.GET_MESSAGE_DELEVERY_PARTICIPANTS,typeCode:params.typeCode,content:{},pushMsgType:4,token:token,timeout:params.timeout};if(params){if(parseInt(params.messageId)>0){deliveryListData.content.messageId=params.messageId}}return sendMessage(deliveryListData,{onResult:function(result){if(typeof result.result=="object"){for(var i=0;i<result.result.length;i++){result.result[i]=formatDataToMakeUser(result.result[i])}}callback&&callback(result)}})};this.getMessageSeenList=function(params,callback){var seenListData={chatMessageVOType:chatMessageVOTypes.GET_MESSAGE_SEEN_PARTICIPANTS,typeCode:params.typeCode,content:{},pushMsgType:4,token:token,timeout:params.timeout};if(params){if(parseInt(params.messageId)>0){seenListData.content.messageId=params.messageId}}return sendMessage(seenListData,{onResult:function(result){if(typeof result.result=="object"){for(var i=0;i<result.result.length;i++){result.result[i]=formatDataToMakeUser(result.result[i])}}callback&&callback(result)}})};this.updateThreadInfo=updateThreadInfo;this.muteThread=function(params,callback){return sendMessage({chatMessageVOType:chatMessageVOTypes.MUTE_THREAD,typeCode:params.typeCode,subjectId:params.subjectId,content:{},pushMsgType:4,token:token,timeout:params.timeout},{onResult:function(result){callback&&callback(result)}})};this.unMuteThread=function(params,callback){return sendMessage({chatMessageVOType:chatMessageVOTypes.UNMUTE_THREAD,typeCode:params.typeCode,subjectId:params.subjectId,content:{},pushMsgType:4,token:token,timeout:params.timeout},{onResult:function(result){callback&&callback(result)}})};this.spamPvThread=function(params,callback){var spamData={chatMessageVOType:chatMessageVOTypes.SPAM_PV_THREAD,typeCode:params.typeCode,pushMsgType:4,token:token,timeout:params.timeout};if(params){if(parseInt(params.threadId)>0){spamData.subjectId=params.threadId}}return sendMessage(spamData,{onResult:function(result){callback&&callback(result)}})};this.block=function(params,callback){var blockData={chatMessageVOType:chatMessageVOTypes.BLOCK,typeCode:params.typeCode,content:{},pushMsgType:4,token:token,timeout:params.timeout};if(params){if(parseInt(params.contactId)>0){blockData.content.contactId=params.contactId}if(parseInt(params.threadId)>0){blockData.content.threadId=params.threadId}if(parseInt(params.userId)>0){blockData.content.userId=params.userId}}return sendMessage(blockData,{onResult:function(result){if(typeof result.result=="object"){result.result=formatDataToMakeBlockedUser(result.result)}callback&&callback(result)}})};this.unblock=function(params,callback){var unblockData={chatMessageVOType:chatMessageVOTypes.UNBLOCK,typeCode:params.typeCode,pushMsgType:4,token:token,content:{},timeout:params.timeout};if(params){if(parseInt(params.blockId)>0){unblockData.subjectId=params.blockId}if(parseInt(params.contactId)>0){unblockData.content.contactId=params.contactId}if(parseInt(params.threadId)>0){unblockData.content.threadId=params.threadId}if(parseInt(params.userId)>0){unblockData.content.userId=params.userId}}return sendMessage(unblockData,{onResult:function(result){if(typeof result.result=="object"){result.result=formatDataToMakeBlockedUser(result.result)}callback&&callback(result)}})};this.getBlocked=function(params,callback){var count=50,offset=0,content={};if(params){if(parseInt(params.count)>0){count=params.count}if(parseInt(params.offset)>0){offset=params.offset}}content.count=count;content.offset=offset;var getBlockedData={chatMessageVOType:chatMessageVOTypes.GET_BLOCKED,typeCode:params.typeCode,content:content,pushMsgType:4,token:token,timeout:params.timeout};return sendMessage(getBlockedData,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){var messageContent=result.result,messageLength=messageContent.length,resultData={blockedUsers:[],contentCount:result.contentCount,hasNext:offset+count<result.contentCount&&messageLength>0,nextOffset:offset+messageLength},blockedUser;for(var i=0;i<messageLength;i++){blockedUser=formatDataToMakeBlockedUser(messageContent[i]);if(blockedUser){resultData.blockedUsers.push(blockedUser)}}returnData.result=resultData}callback&&callback(returnData)}})};this.getNotSeenDuration=function(params,callback){var content={};if(params){if(Array.isArray(params.userIds)){content.userIds=params.userIds}}var getNotSeenDurationData={chatMessageVOType:chatMessageVOTypes.GET_NOT_SEEN_DURATION,typeCode:params.typeCode,content:content,pushMsgType:4,token:token,timeout:params.timeout};return sendMessage(getNotSeenDurationData,{onResult:function(result){var returnData={hasError:result.hasError,cache:false,errorMessage:result.errorMessage,errorCode:result.errorCode};if(!returnData.hasError){returnData.result=result.result}callback&&callback(returnData)}})};this.addContacts=function(params,callback){var data={};if(params){if(typeof params.firstName==="string"){data.firstName=params.firstName}else{data.firstName=""}if(typeof params.lastName==="string"){data.lastName=params.lastName}else{data.lastName=""}if(typeof params.cellphoneNumber==="string"){data.cellphoneNumber=params.cellphoneNumber}else{data.cellphoneNumber=""}if(typeof params.email==="string"){data.email=params.email}else{data.email=""}data.uniqueId=Utility.generateUUID()}var requestParams={url:SERVICE_ADDRESSES.PLATFORM_ADDRESS+SERVICES_PATH.ADD_CONTACTS,method:"POST",data:data,headers:{_token_:token,_token_issuer_:1}};httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:responseData.hasError,cache:false,errorMessage:responseData.message,errorCode:responseData.errorCode};if(!responseData.hasError){var messageContent=responseData.result,messageLength=responseData.result.length,resultData={contacts:[],contentCount:messageLength},contactData;for(var i=0;i<messageLength;i++){contactData=formatDataToMakeContact(messageContent[i]);if(contactData){resultData.contacts.push(contactData)}}returnData.result=resultData;if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<resultData.contacts.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=resultData.contacts[i].id;tempData.owner=userInfo.id;tempData.uniqueId=resultData.contacts[i].uniqueId;tempData.userId=Utility.crypt(resultData.contacts[i].userId,cacheSecret,salt);tempData.cellphoneNumber=Utility.crypt(resultData.contacts[i].cellphoneNumber,cacheSecret,salt);tempData.email=Utility.crypt(resultData.contacts[i].email,cacheSecret,salt);tempData.firstName=Utility.crypt(resultData.contacts[i].firstName,cacheSecret,salt);tempData.lastName=Utility.crypt(resultData.contacts[i].lastName,cacheSecret,salt);tempData.expireTime=(new Date).getTime()+cacheExpireTime;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(resultData.contacts[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.contacts.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData)}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.updateContacts=function(params,callback){var data={};if(params){if(parseInt(params.id)>0){data.id=parseInt(params.id)}else{fireEvent("error",{code:999,message:"ID is required for Updating Contact!",error:undefined})}if(typeof params.firstName==="string"){data.firstName=params.firstName}else{fireEvent("error",{code:999,message:"firstName is required for Updating Contact!"})}if(typeof params.lastName==="string"){data.lastName=params.lastName}else{fireEvent("error",{code:999,message:"lastName is required for Updating Contact!"})}if(typeof params.cellphoneNumber==="string"){data.cellphoneNumber=params.cellphoneNumber}else{fireEvent("error",{code:999,message:"cellphoneNumber is required for Updating Contact!"})}if(typeof params.email==="string"){data.email=params.email}else{fireEvent("error",{code:999,message:"email is required for Updating Contact!"})}data.uniqueId=Utility.generateUUID()}var requestParams={url:SERVICE_ADDRESSES.PLATFORM_ADDRESS+SERVICES_PATH.UPDATE_CONTACTS,method:"GET",data:data,headers:{_token_:token,_token_issuer_:1}};httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:responseData.hasError,cache:false,errorMessage:responseData.message,errorCode:responseData.errorCode};if(!responseData.hasError){var messageContent=responseData.result,messageLength=responseData.result.length,resultData={contacts:[],contentCount:messageLength},contactData;for(var i=0;i<messageLength;i++){contactData=formatDataToMakeContact(messageContent[i]);if(contactData){resultData.contacts.push(contactData)}}returnData.result=resultData;if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<resultData.contacts.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=resultData.contacts[i].id;tempData.owner=userInfo.id;tempData.uniqueId=resultData.contacts[i].uniqueId;tempData.userId=Utility.crypt(resultData.contacts[i].userId,cacheSecret,salt);tempData.cellphoneNumber=Utility.crypt(resultData.contacts[i].cellphoneNumber,cacheSecret,salt);tempData.email=Utility.crypt(resultData.contacts[i].email,cacheSecret,salt);tempData.firstName=Utility.crypt(resultData.contacts[i].firstName,cacheSecret,salt);tempData.lastName=Utility.crypt(resultData.contacts[i].lastName,cacheSecret,salt);tempData.expireTime=(new Date).getTime()+cacheExpireTime;tempData.data=Utility.crypt(JSON.stringify(unsetNotSeenDuration(resultData.contacts[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.contacts.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData)}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.removeContacts=function(params,callback){var data={};if(params){if(parseInt(params.id)>0){data.id=parseInt(params.id)}else{fireEvent("error",{code:999,message:"ID is required for Deleting Contact!",error:undefined})}}var requestParams={url:SERVICE_ADDRESSES.PLATFORM_ADDRESS+SERVICES_PATH.REMOVE_CONTACTS,method:"POST",data:data,headers:{_token_:token,_token_issuer_:1}};httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:responseData.hasError,cache:false,errorMessage:responseData.message,errorCode:responseData.errorCode};if(!responseData.hasError){returnData.result=responseData.result}if(canUseCache){if(db){db.contacts.where("id").equals(parseInt(params.id)).delete().catch(function(error){fireEvent("error",{code:6602,message:CHAT_ERRORS[6602],error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}callback&&callback(returnData)}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.searchContacts=function(params,callback){var data={size:50,offset:0},whereClause={},returnCache=false;if(params){if(typeof params.firstName==="string"){data.firstName=whereClause.firstName=params.firstName}if(typeof params.lastName==="string"){data.lastName=whereClause.lastName=params.lastName}if(parseInt(params.cellphoneNumber)>0){data.cellphoneNumber=whereClause.cellphoneNumber=params.cellphoneNumber}if(typeof params.email==="string"){data.email=whereClause.email=params.email}if(typeof params.q==="string"){data.q=whereClause.q=params.q}if(typeof params.uniqueId==="string"){data.uniqueId=whereClause.uniqueId=params.uniqueId}if(parseInt(params.id)>0){data.id=whereClause.id=params.id}if(parseInt(params.typeCode)>0){data.typeCode=whereClause.typeCode=params.typeCode}if(parseInt(params.size)>0){data.size=params.size}if(parseInt(params.offset)>0){data.offset=params.offset}var functionLevelCache=typeof params.cache=="boolean"?params.cache:true}var requestParams={url:SERVICE_ADDRESSES.PLATFORM_ADDRESS+SERVICES_PATH.SEARCH_CONTACTS,method:"POST",data:data,headers:{_token_:token,_token_issuer_:1}};if(functionLevelCache&&canUseCache&&cacheSecret.length>0){if(db){db.contacts.where("expireTime").below((new Date).getTime()).delete().then(function(){var thenAble;if(Object.keys(whereClause).length===0){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id))}else{if(whereClause.hasOwnProperty("id")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).and(function(contact){return contact.id==whereClause.id})}else if(whereClause.hasOwnProperty("uniqueId")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).and(function(contact){return contact.uniqueId==whereClause.uniqueId})}else{if(whereClause.hasOwnProperty("firstName")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).filter(function(contact){var reg=new RegExp(whereClause.firstName);return reg.test(chatDecrypt(contact.firstName,cacheSecret,contact.salt))})}if(whereClause.hasOwnProperty("lastName")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).filter(function(contact){var reg=new RegExp(whereClause.lastName);return reg.test(chatDecrypt(contact.lastName,cacheSecret,contact.salt))})}if(whereClause.hasOwnProperty("email")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).filter(function(contact){var reg=new RegExp(whereClause.email);return reg.test(chatDecrypt(contact.email,cacheSecret,contact.salt))})}if(whereClause.hasOwnProperty("q")){thenAble=db.contacts.where("owner").equals(parseInt(userInfo.id)).filter(function(contact){var reg=new RegExp(whereClause.q);return reg.test(chatDecrypt(contact.firstName,cacheSecret,contact.salt)+" "+chatDecrypt(contact.lastName,cacheSecret,contact.salt)+" "+chatDecrypt(contact.email,cacheSecret,contact.salt))})}}}thenAble.offset(data.offset).limit(data.size).toArray().then(function(contacts){db.contacts.where("owner").equals(parseInt(userInfo.id)).count().then(function(contactsCount){var cacheData=[];for(var i=0;i<contacts.length;i++){try{var tempData={},salt=contacts[i].salt;cacheData.push(formatDataToMakeContact(JSON.parse(chatDecrypt(contacts[i].data,cacheSecret,ontacts[i].salt))))}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}var returnData={hasError:false,cache:true,errorCode:0,errorMessage:"",result:{contacts:cacheData,contentCount:contactsCount,hasNext:data.offset+data.size<contactsCount&&contacts.length>0,nextOffset:data.offset+contacts.length}};if(cacheData.length>0){callback&&callback(returnData);callback=undefined;returnCache=true}}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:responseData.hasError,cache:false,errorMessage:responseData.message,errorCode:responseData.errorCode};if(!responseData.hasError){var messageContent=responseData.result,messageLength=responseData.result.length,resultData={contacts:[],contentCount:messageLength},contactData;for(var i=0;i<messageLength;i++){contactData=formatDataToMakeContact(messageContent[i]);if(contactData){resultData.contacts.push(contactData)}}returnData.result=resultData;if(canUseCache&&cacheSecret.length>0){if(db){var cacheData=[];for(var i=0;i<resultData.contacts.length;i++){try{var tempData={},salt=Utility.generateUUID();tempData.id=resultData.contacts[i].id;tempData.owner=userInfo.id;tempData.uniqueId=resultData.contacts[i].uniqueId;tempData.userId=Utility.crypt(resultData.contacts[i].userId,cacheSecret,salt);tempData.cellphoneNumber=Utility.crypt(resultData.contacts[i].cellphoneNumber,cacheSecret,salt);tempData.email=Utility.crypt(resultData.contacts[i].email,cacheSecret,salt);tempData.firstName=Utility.crypt(resultData.contacts[i].firstName,cacheSecret,salt);tempData.lastName=Utility.crypt(resultData.contacts[i].lastName,cacheSecret,salt);tempData.expireTime=(new Date).getTime()+cacheExpireTime;tempData.data=crypt(JSON.stringify(unsetNotSeenDuration(resultData.contacts[i])),cacheSecret,salt);tempData.salt=salt;cacheData.push(tempData)}catch(error){fireEvent("error",{code:error.code,message:error.message,error:error})}}db.contacts.bulkPut(cacheData).catch(function(error){fireEvent("error",{code:error.code,message:error.message,error:error})})}else{fireEvent("error",{code:6601,message:CHAT_ERRORS[6601],error:null})}}}callback&&callback(returnData);callback=undefined;if(!returnData.hasError&&returnCache){fireEvent("contactEvents",{type:"CONTACTS_SEARCH_RESULT_CHANGE",result:returnData.result})}}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.mapReverse=function(params,callback){var data={};if(params){if(parseFloat(params.lat)>0){data.lat=params.lat}if(parseFloat(params.lng)>0){data.lng=params.lng}data.uniqueId=Utility.generateUUID()}var requestParams={url:SERVICE_ADDRESSES.MAP_ADDRESS+SERVICES_PATH.REVERSE,method:"GET",data:data,headers:{"Api-Key":mapApiKey}};httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:result.hasError,cache:result.cache,errorMessage:result.message,errorCode:result.errorCode,result:responseData};callback&&callback(returnData)}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.mapSearch=function(params,callback){var data={};if(params){if(typeof params.term==="string"){data.term=params.term}if(parseFloat(params.lat)>0){data.lat=params.lat}if(parseFloat(params.lng)>0){data.lng=params.lng}data.uniqueId=Utility.generateUUID()}var requestParams={url:SERVICE_ADDRESSES.MAP_ADDRESS+SERVICES_PATH.SEARCH,method:"GET",data:data,headers:{"Api-Key":mapApiKey}};httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:result.hasError,cache:result.cache,errorMessage:result.message,errorCode:result.errorCode,result:responseData};callback&&callback(returnData)}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.mapRouting=function(params,callback){var data={};if(params){if(typeof params.alternative==="boolean"){data.alternative=params.alternative}else{data.alternative=true}if(typeof params.origin==="object"){if(parseFloat(params.origin.lat)>0&&parseFloat(params.origin.lng)){data.origin=params.origin.lat+","+parseFloat(params.origin.lng)}else{}}if(typeof params.destination==="object"){if(parseFloat(params.destination.lat)>0&&parseFloat(params.destination.lng)){data.destination=params.destination.lat+","+parseFloat(params.destination.lng)}else{}}data.uniqueId=Utility.generateUUID()}var requestParams={url:SERVICE_ADDRESSES.MAP_ADDRESS+SERVICES_PATH.ROUTING,method:"GET",data:data,headers:{"Api-Key":mapApiKey}};httpRequest(requestParams,function(result){if(!result.hasError){var responseData=JSON.parse(result.result.responseText);var returnData={hasError:result.hasError,cache:result.cache,errorMessage:result.message,errorCode:result.errorCode,result:responseData};callback&&callback(returnData)}else{fireEvent("error",{code:result.errorCode,message:result.errorMessage,error:result})}})};this.mapStaticImage=function(params,callback){var data={},url=SERVICE_ADDRESSES.MAP_ADDRESS+SERVICES_PATH.STATIC_IMAGE,hasError=false;if(params){if(typeof params.type==="string"){data.type=params.type}else{data.type="standard-night"}if(parseInt(params.zoom)>0){data.zoom=params.zoom}else{data.zoom=15}if(parseInt(params.width)>0){data.width=params.width}else{data.width=800}if(parseInt(params.height)>0){data.height=params.height}else{data.height=600}if(typeof params.center==="object"){if(parseFloat(params.center.lat)>0&&parseFloat(params.center.lng)){data.center=params.center.lat+","+parseFloat(params.center.lng)}else{hasError=true;fireEvent("error",{code:6700,message:CHAT_ERRORS[6700],error:undefined})}}else{hasError=true;fireEvent("error",{code:6700,message:CHAT_ERRORS[6700],error:undefined})}data.key=mapApiKey}var keys=Object.keys(data);if(keys.length>0){url+="?";for(var i=0;i<keys.length;i++){var key=keys[i];url+=key+"="+data[key];if(i<keys.length-1){url+="&"}}}var returnData={hasError:hasError,cache:false,errorMessage:hasError?CHAT_ERRORS[6700]:"",errorCode:hasError?6700:undefined,result:{link:!hasError?url:""}};callback&&callback(returnData)};this.setAdmin=function(params,callback){var setAdminData={chatMessageVOType:chatMessageVOTypes.SET_ROLE_TO_USER,typeCode:params.typeCode,content:[],pushMsgType:4,token:token,timeout:params.timeout};if(params){if(parseInt(params.threadId)>0){setAdminData.subjectId=params.threadId}if(params.admins&&Array.isArray(params.admins)){for(var i=0;i<params.admins.length;i++){var temp={};if(parseInt(params.admins[i].userId)>0){temp.userId=params.admins[i].userId}if(params.admins[i].roleOperation=="add"||params.admins[i].roleOperation=="remove"){temp.roleOperation=params.admins[i].roleOperation}else{temp.roleOperation="add"}temp.checkThreadMembership=true;if(Array.isArray(params.admins[i].roles)){temp.roles=params.admins[i].roles}setAdminData.content.push(temp)}setAdminData.content=JSON.stringify(setAdminData.content)}}return sendMessage(setAdminData,{onResult:function(result){callback&&callback(result)}})};this.generateUUID=Utility.generateUUID;this.logout=function(){clearChatServerCaches();asyncClient.logout()};this.clearChatServerCaches=clearChatServerCaches;this.deleteCacheDatabases=deleteCacheDatabases;this.clearCacheDatabasesOfUser=clearCacheDatabasesOfUser;this.getChatState=function(){return chatFullStateObject};this.reconnect=function(){asyncClient.reconnectSocket()};this.setToken=function(newToken){if(typeof newToken!="undefined"){token=newToken}};init()}if(typeof module!=="undefined"&&typeof module.exports!="undefined"){module.exports=Chat}else{if(!window.POD){window.POD={}}window.POD.Chat=Chat}})()},{"./utility/utility.js":47,dexie:41,"podasync-ws-only":43,querystring:4}],47:[function(require,module,exports){(function(global){(function(){var CryptoJS;function ChatUtility(){if(typeof require!=="undefined"&&typeof exports!=="undefined"){CryptoJS=require("crypto-js")}else{CryptoJS=window.CryptoJS}this.isNode=function(){return typeof global!=="undefined"&&{}.toString.call(global)==="[object global]"};this.generateUUID=function(sectionCount){var d=(new Date).getTime();var textData="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(sectionCount==1){textData="xxxxxxxx"}if(sectionCount==2){textData="xxxxxxxx-xxxx"}if(sectionCount==3){textData="xxxxxxxx-xxxx-4xxx"}if(sectionCount==4){textData="xxxxxxxx-xxxx-4xxx-yxxx"}var uuid=textData.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&7|8).toString(16)});return uuid};this.createReturnData=function(hasError,errorMessage,errorCode,result,contentCount){var returnData={hasError:hasError,errorMessage:typeof errorMessage=="string"?errorMessage:"",errorCode:typeof errorCode=="number"?errorCode:0,result:result};if(typeof contentCount=="number"){returnData.contentCount=contentCount}return returnData};this.chatStepLogger=function(title,message){if(typeof navigator=="undefined"){console.log("[90m     %s [0m [90m(%sms)[0m",title,message)}else{console.log("%c   "+title+" ("+message+"ms)","border-left: solid #666 10px; color: #666;")}};this.MD5=function(string){function RotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2)}return WordToHexValue}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,3614090360);d=FF(d,a,b,c,x[k+1],S12,3905402710);c=FF(c,d,a,b,x[k+2],S13,606105819);b=FF(b,c,d,a,x[k+3],S14,3250441966);a=FF(a,b,c,d,x[k+4],S11,4118548399);d=FF(d,a,b,c,x[k+5],S12,1200080426);c=FF(c,d,a,b,x[k+6],S13,2821735955);b=FF(b,c,d,a,x[k+7],S14,4249261313);a=FF(a,b,c,d,x[k+8],S11,1770035416);d=FF(d,a,b,c,x[k+9],S12,2336552879);c=FF(c,d,a,b,x[k+10],S13,4294925233);b=FF(b,c,d,a,x[k+11],S14,2304563134);a=FF(a,b,c,d,x[k+12],S11,1804603682);d=FF(d,a,b,c,x[k+13],S12,4254626195);c=FF(c,d,a,b,x[k+14],S13,2792965006);b=FF(b,c,d,a,x[k+15],S14,1236535329);a=GG(a,b,c,d,x[k+1],S21,4129170786);d=GG(d,a,b,c,x[k+6],S22,3225465664);c=GG(c,d,a,b,x[k+11],S23,643717713);b=GG(b,c,d,a,x[k+0],S24,3921069994);a=GG(a,b,c,d,x[k+5],S21,3593408605);d=GG(d,a,b,c,x[k+10],S22,38016083);c=GG(c,d,a,b,x[k+15],S23,3634488961);b=GG(b,c,d,a,x[k+4],S24,3889429448);a=GG(a,b,c,d,x[k+9],S21,568446438);d=GG(d,a,b,c,x[k+14],S22,3275163606);c=GG(c,d,a,b,x[k+3],S23,4107603335);b=GG(b,c,d,a,x[k+8],S24,1163531501);a=GG(a,b,c,d,x[k+13],S21,2850285829);d=GG(d,a,b,c,x[k+2],S22,4243563512);c=GG(c,d,a,b,x[k+7],S23,1735328473);b=GG(b,c,d,a,x[k+12],S24,2368359562);a=HH(a,b,c,d,x[k+5],S31,4294588738);d=HH(d,a,b,c,x[k+8],S32,2272392833);c=HH(c,d,a,b,x[k+11],S33,1839030562);b=HH(b,c,d,a,x[k+14],S34,4259657740);a=HH(a,b,c,d,x[k+1],S31,2763975236);d=HH(d,a,b,c,x[k+4],S32,1272893353);c=HH(c,d,a,b,x[k+7],S33,4139469664);b=HH(b,c,d,a,x[k+10],S34,3200236656);a=HH(a,b,c,d,x[k+13],S31,681279174);d=HH(d,a,b,c,x[k+0],S32,3936430074);c=HH(c,d,a,b,x[k+3],S33,3572445317);b=HH(b,c,d,a,x[k+6],S34,76029189);a=HH(a,b,c,d,x[k+9],S31,3654602809);d=HH(d,a,b,c,x[k+12],S32,3873151461);c=HH(c,d,a,b,x[k+15],S33,530742520);b=HH(b,c,d,a,x[k+2],S34,3299628645);a=II(a,b,c,d,x[k+0],S41,4096336452);d=II(d,a,b,c,x[k+7],S42,1126891415);c=II(c,d,a,b,x[k+14],S43,2878612391);b=II(b,c,d,a,x[k+5],S44,4237533241);a=II(a,b,c,d,x[k+12],S41,1700485571);d=II(d,a,b,c,x[k+3],S42,2399980690);c=II(c,d,a,b,x[k+10],S43,4293915773);b=II(b,c,d,a,x[k+1],S44,2240044497);a=II(a,b,c,d,x[k+8],S41,1873313359);d=II(d,a,b,c,x[k+15],S42,4264355552);c=II(c,d,a,b,x[k+6],S43,2734768916);b=II(b,c,d,a,x[k+13],S44,1309151649);a=II(a,b,c,d,x[k+4],S41,4149444226);d=II(d,a,b,c,x[k+11],S42,3174756917);c=II(c,d,a,b,x[k+2],S43,718787259);b=II(b,c,d,a,x[k+9],S44,3951481745);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD)}var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase()};this.RC4=function(key,str){var s=[],j=0,x,res="";for(var i=0;i<256;i++){s[i]=i}for(i=0;i<256;i++){j=(j+s[i]+key.charCodeAt(i%key.length))%256;x=s[i];s[i]=s[j];s[j]=x}i=0;j=0;for(var y=0;y<str.length;y++){i=(i+1)%256;j=(j+s[i])%256;x=s[i];s[i]=s[j];s[j]=x;res+=String.fromCharCode(str.charCodeAt(y)^s[(s[i]+s[j])%256])}return res};this.dynamicSort=function(property,reverse){var sortOrder=1;if(reverse){sortOrder=-1}return function(a,b){var result=a[property]<b[property]?-1:a[property]>b[property]?1:0;return result*sortOrder}};this.crypt=function(str,key,salt){if(typeof str!=="string"){str=JSON.stringify(str)}if(str==undefined||str=="undefined"){str=""}return CryptoJS.AES.encrypt(str,key+salt).toString()};this.decrypt=function(str,key,salt){var bytes=CryptoJS.AES.decrypt(str,key+salt);try{bytes=bytes.toString(CryptoJS.enc.Utf8);return{hasError:false,result:bytes}}catch(error){return{hasError:true,result:error}}};this.jsonStringify=function(json){return JSON.stringify(json,function(k,v){if(typeof v==="function"){return""+v}else{return v}})};this.jsonParser=function(string){try{return JSON.parse(string,function(k,v){if(typeof v==="string"){return v.startsWith("function")?eval("("+v+")"):v}else{return v}})}catch(e){console.log("Error happened at Utility.jsonParser function()",e)}}}if(typeof module!=="undefined"&&typeof module.exports!="undefined"){module.exports=ChatUtility}else{if(!window.POD){window.POD={}}window.POD.ChatUtility=ChatUtility}})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"crypto-js":15}]},{},[6]);